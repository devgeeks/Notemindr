var crypton={};(function(){"use strict";var MISMATCH_ERR="Server and client version mismatch";crypton.version="0.0.2";crypton.clientVersionMismatch=undefined;crypton.versionCheck=function(skip,callback){if(skip){return callback(null)}var url=crypton.url()+"/versioncheck?"+"v="+crypton.version;superagent.get(url).end(function(res){if(res.body.success!==true&&res.body.error!==undefined){crypton.clientVersionMismatch=true;return callback(res.body.error)}callback(null)})};crypton.host=location.hostname;crypton.port=443;crypton.cipherOptions={mode:"gcm"};crypton.paranoia=6;crypton.trustStateContainer="_trust_state";crypton.collectorsStarted=false;crypton.startCollectors=function(){sjcl.random.startCollectors();crypton.collectorsStarted=true};crypton.url=function(){return"https://"+crypton.host+":"+crypton.port};function randomBytes(nbytes){if(!nbytes){throw new Error("randomBytes requires input")}if(parseInt(nbytes,10)!==nbytes){throw new Error("randomBytes requires integer input")}if(nbytes<4){throw new Error("randomBytes cannot return less than 4 bytes")}if(nbytes%4!==0){throw new Error("randomBytes requires input as multiple of 4")}var nwords=nbytes/4;return sjcl.random.randomWords(nwords)}crypton.randomBytes=randomBytes;function constEqual(str1,str2){if(typeof str1!=="string"||typeof str2!=="string"){return false}var mismatch=str1.length^str2.length;var len=Math.min(str1.length,str2.length);for(var i=0;i<len;i++){mismatch|=str1.charCodeAt(i)^str2.charCodeAt(i)}return mismatch===0}crypton.constEqual=constEqual;crypton.randomBits=function(nbits){if(!nbits){throw new Error("randomBits requires input")}if(parseInt(nbits,10)!==nbits){throw new Error("randomBits requires integer input")}if(nbits<32){throw new Error("randomBits cannot return less than 32 bits")}if(nbits%32!==0){throw new Error("randomBits requires input as multiple of 32")}var nbytes=nbits/8;return crypton.randomBytes(nbytes)};crypton.hmac=function(key,data){var mac=new sjcl.misc.hmac(key);return sjcl.codec.hex.fromBits(mac.mac(data))};crypton.hmacAndCompare=function(key,data,otherMac){var ourMac=crypton.hmac(key,data);return crypton.constEqual(ourMac,otherMac)};crypton.fingerprint=function(pubKey,signKeyPub){var pubKeys=sjcl.bitArray.concat(pubKey._point.toBits(),signKeyPub._point.toBits());var pubKeyHash=sjcl.hash.sha256.hash(pubKeys);return sjcl.codec.hex.fromBits(pubKeyHash)};crypton.generateAccount=function(username,passphrase,callback,options){if(crypton.clientVersionMismatch){return callback(MISMATCH_ERR)}options=options||{};var save=typeof options.save!=="undefined"?options.save:true;crypton.versionCheck(!save,function(err){if(err){return callback(MISMATCH_ERR)}else{if(!username||!passphrase){return callback("Must supply username and passphrase")}if(!crypton.collectorsStarted){crypton.startCollectors()}var SIGN_KEY_BIT_LENGTH=384;var keypairCurve=options.keypairCurve||384;var account=new crypton.Account;var hmacKey=randomBytes(32);var keypairSalt=randomBytes(32);var keypairMacSalt=randomBytes(32);var signKeyPrivateMacSalt=randomBytes(32);var containerNameHmacKey=randomBytes(32);var keypairKey=sjcl.misc.pbkdf2(passphrase,keypairSalt);var keypairMacKey=sjcl.misc.pbkdf2(passphrase,keypairMacSalt);var signKeyPrivateMacKey=sjcl.misc.pbkdf2(passphrase,signKeyPrivateMacSalt);var keypair=sjcl.ecc.elGamal.generateKeys(keypairCurve,crypton.paranoia);var signingKeys=sjcl.ecc.ecdsa.generateKeys(SIGN_KEY_BIT_LENGTH,crypton.paranoia);var srp=new SRPClient(username,passphrase,2048,"sha-256");var srpSalt=srp.randomHexSalt();var srpVerifier=srp.calculateV(srpSalt).toString(16);account.username=username;account.keypairSalt=JSON.stringify(keypairSalt);account.keypairMacSalt=JSON.stringify(keypairMacSalt);account.signKeyPrivateMacSalt=JSON.stringify(signKeyPrivateMacSalt);account.srpVerifier=srp.nZeros(512-srpVerifier.length)+srpVerifier;account.srpSalt=srpSalt;account.pubKey=JSON.stringify(keypair.pub.serialize());account.signKeyPub=JSON.stringify(signingKeys.pub.serialize());var sessionIdentifier="dummySession";var session=new crypton.Session(sessionIdentifier);session.account=account;session.account.signKeyPrivate=signingKeys.sec;var selfPeer=new crypton.Peer({session:session,pubKey:keypair.pub});selfPeer.trusted=true;var encryptedHmacKey=selfPeer.encryptAndSign(JSON.stringify(hmacKey));if(encryptedHmacKey.error){callback(encryptedHmacKey.error,null);return}account.hmacKeyCiphertext=JSON.stringify(encryptedHmacKey);var encryptedContainerNameHmacKey=selfPeer.encryptAndSign(JSON.stringify(containerNameHmacKey));if(encryptedContainerNameHmacKey.error){callback(encryptedContainerNameHmacKey.error,null);return}account.containerNameHmacKeyCiphertext=JSON.stringify(encryptedContainerNameHmacKey);account.keypairCiphertext=sjcl.encrypt(keypairKey,JSON.stringify(keypair.sec.serialize()),crypton.cipherOptions);account.keypairMac=crypton.hmac(keypairMacKey,account.keypairCiphertext);account.signKeyPrivateCiphertext=sjcl.encrypt(keypairKey,JSON.stringify(signingKeys.sec.serialize()),crypton.cipherOptions);account.signKeyPrivateMac=crypton.hmac(signKeyPrivateMacKey,account.signKeyPrivateCiphertext);if(save){account.save(function(err){callback(err,account)});return}callback(null,account)}})};crypton.authorize=function(username,passphrase,callback,options){if(crypton.clientVersionMismatch){return callback(MISMATCH_ERR)}options=options||{};var check=typeof options.check!=="undefined"?options.check:true;crypton.versionCheck(!check,function(err){if(err){return callback(MISMATCH_ERR)}else{if(!username||!passphrase){return callback("Must supply username and passphrase")}if(!crypton.collectorsStarted){crypton.startCollectors()}var options={username:username,passphrase:passphrase};crypton.work.calculateSrpA(options,function(err,data){if(err){return callback(err)}var response={srpA:data.srpAstr};superagent.post(crypton.url()+"/account/"+username).withCredentials().send(response).end(function(res){if(!res.body||res.body.success!==true){return callback(res.body.error)}options.a=data.a;options.srpA=data.srpA;options.srpB=res.body.srpB;options.srpSalt=res.body.srpSalt;crypton.work.calculateSrpM1(options,function(err,srpM1,ourSrpM2){response={srpM1:srpM1};superagent.post(crypton.url()+"/account/"+username+"/answer").withCredentials().send(response).end(function(res){if(!res.body||res.body.success!==true){callback(res.body.error);return}if(!constEqual(res.body.srpM2,ourSrpM2)){callback("Server could not be verified");return}var sessionIdentifier=res.body.sessionIdentifier;var session=new crypton.Session(sessionIdentifier);session.account=new crypton.Account;session.account.username=username;session.account.passphrase=passphrase;session.account.challengeKey=res.body.account.challengeKey;session.account.containerNameHmacKeyCiphertext=res.body.account.containerNameHmacKeyCiphertext;session.account.hmacKeyCiphertext=res.body.account.hmacKeyCiphertext;session.account.keypairCiphertext=res.body.account.keypairCiphertext;session.account.keypairMac=res.body.account.keypairMac;session.account.pubKey=res.body.account.pubKey;session.account.challengeKeySalt=res.body.account.challengeKeySalt;session.account.keypairSalt=res.body.account.keypairSalt;session.account.keypairMacSalt=res.body.account.keypairMacSalt;session.account.signKeyPub=res.body.account.signKeyPub;session.account.signKeyPrivateCiphertext=res.body.account.signKeyPrivateCiphertext;session.account.signKeyPrivateMacSalt=res.body.account.signKeyPrivateMacSalt;session.account.signKeyPrivateMac=res.body.account.signKeyPrivateMac;session.account.unravel(function(err){if(err){return callback(err)}session.load(crypton.trustStateContainer,function(err){if(!err){return callback(null,session)}session.create(crypton.trustStateContainer,function(err){if(err){return callback(err)}callback(null,session)})})})})})})})}})}})();(function(){"use strict";var Account=crypton.Account=function Account(){};Account.prototype.save=function(callback){superagent.post(crypton.url()+"/account").withCredentials().send(this.serialize()).end(function(res){if(res.body.success!==true){callback(res.body.error)}else{callback()}})};Account.prototype.unravel=function(callback){var that=this;crypton.work.unravelAccount(this,function(err,data){if(err){return callback(err)}that.regenerateKeys(data,function(err){callback(err)})})};Account.prototype.regenerateKeys=function(data,callback){var exponent=sjcl.bn.fromBits(data.secret.exponent);this.secretKey=new sjcl.ecc.elGamal.secretKey(data.secret.curve,sjcl.ecc.curves["c"+data.secret.curve],exponent);var point=sjcl.ecc.curves["c"+this.pubKey.curve].fromBits(this.pubKey.point);this.pubKey=new sjcl.ecc.elGamal.publicKey(this.pubKey.curve,point.curve,point);this.hmacKey=data.hmacKey;this.containerNameHmacKey=data.containerNameHmacKey;var signPoint=sjcl.ecc.curves["c"+this.signKeyPub.curve].fromBits(this.signKeyPub.point);this.signKeyPub=new sjcl.ecc.ecdsa.publicKey(this.signKeyPub.curve,signPoint.curve,signPoint);var signExponent=sjcl.bn.fromBits(data.signKeySecret.exponent);this.signKeyPrivate=new sjcl.ecc.ecdsa.secretKey(data.signKeySecret.curve,sjcl.ecc.curves["c"+data.signKeySecret.curve],signExponent);this.fingerprint=crypton.fingerprint(this.pubKey,this.signKeyPub);var pubKeyHex=sjcl.codec.hex.fromBits(this.pubKey._point.toBits());var pubKeyShouldBe=this.secretKey._curve.G.mult(exponent);var pubKeyShouldBeHex=sjcl.codec.hex.fromBits(pubKeyShouldBe.toBits());if(!crypton.constEqual(pubKeyHex,pubKeyShouldBeHex)){return callback("Server provided incorrect public key")}var signKeyPubHex=sjcl.codec.hex.fromBits(this.signKeyPub._point.toBits());var signKeyPubShouldBe=this.signKeyPrivate._curve.G.mult(signExponent);var signKeyPubShouldBeHex=sjcl.codec.hex.fromBits(signKeyPubShouldBe.toBits());if(!crypton.constEqual(signKeyPubHex,signKeyPubShouldBeHex)){return callback("Server provided incorrect public signing key")}this.trusted=true;callback(null)};Account.prototype.serialize=function(){return{srpVerifier:this.srpVerifier,srpSalt:this.srpSalt,containerNameHmacKeyCiphertext:this.containerNameHmacKeyCiphertext,hmacKeyCiphertext:this.hmacKeyCiphertext,keypairCiphertext:this.keypairCiphertext,keypairMac:this.keypairMac,pubKey:this.pubKey,keypairSalt:this.keypairSalt,keypairMacSalt:this.keypairMacSalt,signKeyPrivateMacSalt:this.signKeyPrivateMacSalt,username:this.username,signKeyPub:this.signKeyPub,signKeyPrivateCiphertext:this.signKeyPrivateCiphertext,signKeyPrivateMac:this.signKeyPrivateMac}};Account.prototype.verifyAndDecrypt=function(signedCiphertext,peer){if(!peer.trusted){return{error:"Peer is untrusted"}}var ciphertextString=JSON.stringify(signedCiphertext.ciphertext);var hash=sjcl.hash.sha256.hash(ciphertextString);var verified=false;try{verified=peer.signKeyPub.verify(hash,signedCiphertext.signature)}catch(ex){}try{var message=sjcl.decrypt(this.secretKey,ciphertextString,crypton.cipherOptions);if(verified){return{plaintext:message,verified:verified,error:null}}else{return{plaintext:null,verified:false,error:"Cannot verify ciphertext"}}}catch(ex){return{plaintext:null,verified:false,error:"Cannot verify ciphertext"}}}})();(function(){"use strict";var Session=crypton.Session=function(id){this.id=id;this.peers=[];this.events=[];this.containers=[];this.inbox=new crypton.Inbox(this);var that=this;this.socket=io.connect(crypton.url(),{secure:true});this.socket.on("message",function(data){that.inbox.get(data.messageId,function(err,message){that.emit("message",message)})});this.socket.on("containerUpdate",function(containerNameHmac){for(var i in that.containers){var container=that.containers[i];var temporaryHmac=container.containerNameHmac||container.getPublicName();if(crypton.constEqual(temporaryHmac,containerNameHmac)){container.sync(function(err){if(container._listener){container._listener()}});break}}})};Session.prototype.load=function(containerName,callback){for(var i in this.containers){if(crypton.constEqual(this.containers[i].name,containerName)){callback(null,this.containers[i]);return}}var that=this;this.getContainer(containerName,function(err,container){if(err){callback(err);return}that.containers.push(container);callback(null,container)})};Session.prototype.loadWithHmac=function(containerNameHmac,peer,callback){for(var i in this.containers){if(crypton.constEqual(this.containers[i].nameHmac,containerNameHmac)){callback(null,this.containers[i]);return}}var that=this;this.getContainerWithHmac(containerNameHmac,peer,function(err,container){if(err){callback(err);return}that.containers.push(container);callback(null,container)})};Session.prototype.create=function(containerName,callback){for(var i in this.containers){if(crypton.constEqual(this.containers[i].name,containerName)){callback("Container already exists");return}}var selfPeer=new crypton.Peer({session:this,pubKey:this.account.pubKey,signKeyPub:this.account.signKeyPub});selfPeer.trusted=true;var sessionKey=crypton.randomBytes(32);var sessionKeyCiphertext=selfPeer.encryptAndSign(sessionKey);if(sessionKeyCiphertext.error){return callback(sessionKeyCiphertext.error)}delete sessionKeyCiphertext.error;var signature="hello";var containerNameHmac=new sjcl.misc.hmac(this.account.containerNameHmacKey);containerNameHmac=sjcl.codec.hex.fromBits(containerNameHmac.encrypt(containerName));var rawPayloadCiphertext=sjcl.encrypt(sessionKey,JSON.stringify({recordIndex:0,delta:{}}),crypton.cipherOptions);var payloadCiphertextHash=sjcl.hash.sha256.hash(JSON.stringify(rawPayloadCiphertext));var payloadSignature=this.account.signKeyPrivate.sign(payloadCiphertextHash,crypton.paranoia);var payloadCiphertext={ciphertext:rawPayloadCiphertext,signature:payloadSignature};var that=this;new crypton.Transaction(this,function(err,tx){var chunks=[{type:"addContainer",containerNameHmac:containerNameHmac},{type:"addContainerSessionKey",containerNameHmac:containerNameHmac,signature:signature},{type:"addContainerSessionKeyShare",toAccount:that.account.username,containerNameHmac:containerNameHmac,sessionKeyCiphertext:sessionKeyCiphertext},{type:"addContainerRecord",containerNameHmac:containerNameHmac,payloadCiphertext:payloadCiphertext}];async.eachSeries(chunks,function(chunk,callback2){tx.save(chunk,callback2)},function(err){if(err){return tx.abort(function(){callback(err)})}tx.commit(function(){var container=new crypton.Container(that);container.name=containerName;container.sessionKey=sessionKey;that.containers.push(container);callback(null,container)})})})};Session.prototype.deleteContainer=function(containerName,callback){var that=this;var containerNameHmac=new sjcl.misc.hmac(this.account.containerNameHmacKey);containerNameHmac=sjcl.codec.hex.fromBits(containerNameHmac.encrypt(containerName));new crypton.Transaction(this,function(err,tx){var chunk={type:"deleteContainer",containerNameHmac:containerNameHmac};tx.save(chunk,function(err){if(err){return callback(err)}tx.commit(function(err){callback(err)})})})};Session.prototype.getContainer=function(containerName,callback){var container=new crypton.Container(this);container.name=containerName;container.sync(function(err){callback(err,container)})};Session.prototype.getContainerWithHmac=function(containerNameHmac,peer,callback){var container=new crypton.Container(this);container.nameHmac=containerNameHmac;container.peer=peer;container.sync(function(err){callback(err,container)})};Session.prototype.getPeer=function(username,callback){if(this.peers[username]){return callback(null,this.peers[username])}var that=this;var peer=new crypton.Peer;peer.username=username;peer.session=this;peer.fetch(function(err,peer){if(err){return callback(err)}that.load(crypton.trustStateContainer,function(err,container){if(err){return callback(err)}if(!container.keys[username]){peer.trusted=false}else{var savedFingerprint=container.keys[username].fingerprint;if(!crypton.constEqual(savedFingerprint,peer.fingerprint)){return callback("Server has provided malformed peer",peer)}peer.trusted=true}that.peers[username]=peer;callback(null,peer)})})};Session.prototype.on=function(eventName,listener){this.events[eventName]=listener};Session.prototype.emit=function(eventName,data){this.events[eventName]&&this.events[eventName](data)}})();(function(){"use strict";var Container=crypton.Container=function(session){this.keys={};this.session=session;this.recordCount=1;this.recordIndex=0;this.versions={};this.version=0;this.name=null};Container.prototype.add=function(key,callback){if(this.keys[key]){callback("Key already exists");return}this.keys[key]={};callback()};Container.prototype.get=function(key,callback){if(!this.keys[key]){callback("Key does not exist");return}callback(null,this.keys[key])};Container.prototype.save=function(callback,options){var that=this;this.getDiff(function(err,diff){if(!diff){callback("Container has not changed");return}var payload={recordIndex:that.recordCount,delta:diff};var now=+new Date;that.versions[now]=JSON.parse(JSON.stringify(that.keys));that.version=now;that.recordCount++;var rawPayloadCiphertext=sjcl.encrypt(that.sessionKey,JSON.stringify(payload),crypton.cipherOptions);var payloadCiphertextHash=sjcl.hash.sha256.hash(JSON.stringify(rawPayloadCiphertext));var payloadSignature=that.session.account.signKeyPrivate.sign(payloadCiphertextHash,crypton.paranoia);var payloadCiphertext={ciphertext:rawPayloadCiphertext,signature:payloadSignature};var chunk={type:"addContainerRecord",containerNameHmac:that.getPublicName(),payloadCiphertext:payloadCiphertext};if(options&&options.save==false){callback(null,chunk);return}var tx=new crypton.Transaction(that.session,function(err){tx.save(chunk,function(err){tx.commit(function(err){callback()})})})})};Container.prototype.getDiff=function(callback){var last=this.latestVersion();var old=this.versions[last]||{};callback(null,crypton.diff.create(old,this.keys))};Container.prototype.getVersions=function(){return Object.keys(this.versions)};Container.prototype.getVersion=function(timestamp){return this.versions[timestamp]};Container.prototype.latestVersion=function(){var versions=this.getVersions();if(!versions.length){return this.version}else{return Math.max.apply(Math,versions)}};Container.prototype.getPublicName=function(){if(this.nameHmac){return this.nameHmac}var hmac=new sjcl.misc.hmac(this.session.account.containerNameHmacKey);var containerNameHmac=hmac.encrypt(this.name);this.nameHmac=sjcl.codec.hex.fromBits(containerNameHmac);return this.nameHmac};Container.prototype.getHistory=function(callback){var containerNameHmac=this.getPublicName();var currentVersion=this.latestVersion();var url=crypton.url()+"/container/"+containerNameHmac+"?after="+(currentVersion+1);superagent.get(url).withCredentials().end(function(res){if(!res.body||res.body.success!==true){callback(res.body.error);return}callback(null,res.body.records)})};Container.prototype.parseHistory=function(records,callback){var that=this;var keys=that.keys||{};var versions=that.versions||{};var recordIndex=that.recordIndex+1;async.eachSeries(records,function(rawRecord,callback){that.decryptRecord(recordIndex,rawRecord,function(err,record){if(err){return callback(err)}keys=crypton.diff.apply(record.delta,keys);versions[record.time]=JSON.parse(JSON.stringify(keys));callback(null)})},function(err){if(err){console.log("Hit error parsing container history");console.log(that);console.log(err);return callback(err)}that.recordIndex=recordIndex;callback(null,keys,versions,recordIndex)})};Container.prototype.decryptRecord=function(recordIndex,record,callback){if(!this.sessionKey){this.decryptKey(record)}var parsedRecord;try{parsedRecord=JSON.parse(record.payloadCiphertext)}catch(e){}if(!parsedRecord){return callback("Could not parse record JSON")}var options={sessionKey:this.sessionKey,expectedRecordIndex:recordIndex,record:record.payloadCiphertext,creationTime:record.creationTime,peerSignKeyPubSerialized:(this.peer&&this.peer.signKeyPub||this.session.account.signKeyPub).serialize()};crypton.work.decryptRecord(options,callback)};Container.prototype.decryptKey=function(record){var peer=this.peer||this.session.account;var sessionKeyRaw=this.session.account.verifyAndDecrypt(JSON.parse(record.sessionKeyCiphertext),peer);if(sessionKeyRaw.error){throw new Error(sessionKeyRaw.error)}if(!sessionKeyRaw.verified){throw new Error("Container session key signature mismatch")}this.sessionKey=JSON.parse(sessionKeyRaw.plaintext)};Container.prototype.sync=function(callback){var that=this;this.getHistory(function(err,records){if(err){callback(err);return}that.parseHistory(records,function(err,keys,versions,recordIndexAfter){that.keys=keys;that.versions=versions;that.version=Math.max.apply(Math,Object.keys(versions));that.recordCount=that.recordCount+versions.count;callback(err)})})};Container.prototype.share=function(peer,callback){if(!this.sessionKey){return callback("Container must be initialized to share")}var containerNameHmac=this.getPublicName();var sessionKeyCiphertext=peer.encryptAndSign(this.sessionKey);if(sessionKeyCiphertext.error){return callback(sessionKeyCiphertext.error)}delete sessionKeyCiphertext.error;var that=this;new crypton.Transaction(this,function(err,tx){var chunk={type:"addContainerSessionKeyShare",toAccount:peer.username,containerNameHmac:containerNameHmac,sessionKeyCiphertext:sessionKeyCiphertext};tx.save(chunk,function(err){if(err){return callback(err)}tx.commit(function(err){if(err){return callback(err)}peer.sendMessage({type:"internal",action:"containerShare"},{fromUsername:that.session.account.username,containerNameHmac:containerNameHmac},function(err){callback(err)})})})})};Container.prototype.watch=function(listener){this._listener=listener};Container.prototype.unwatch=function(){delete this._listener}})();(function(){"use strict";var Transaction=crypton.Transaction=function(session,callback){var that=this;this.session=session;this.types=["addAccount","setBaseKeyring","addContainer","deleteContainer","addContainerSessionKey","addContainerSessionKeyShare","addContainerRecord","addMessage","deleteMessage"];if(!this.session){callback&&callback(null,this);return}this.create(function(err,id){if(err){console.log(err);callback(err);return}that.id=id;callback&&callback(null,that)})};Transaction.prototype.create=function(callback){var url=crypton.url()+"/transaction/create";superagent.post(url).withCredentials().end(function(res){if(!res.body||res.body.success!==true){callback(res.body.error);return}callback(null,res.body.id)})};Transaction.prototype.save=function(){this.verify();var that=this;var args=Array.prototype.slice.call(arguments);var callback=args.pop();if(typeof callback!="function"){args.push(callback);callback=function(){}}async.each(args,function(chunk,cb){if(typeof chunk=="function"){cb();return}that.saveChunk(chunk,cb)},function(err){callback(err)})};Transaction.prototype.saveChunk=function(chunk,callback){this.verify();this.verifyChunk(chunk);var url=crypton.url()+"/transaction/"+this.id;superagent.post(url).withCredentials().send(chunk).end(function(res){if(!res.body||res.body.success!==true){callback(res.body.error);return}callback()})};Transaction.prototype.commit=function(callback){this.verify();var url=crypton.url()+"/transaction/"+this.id+"/commit";superagent.post(url).withCredentials().end(function(res){if(!res.body||res.body.success!==true){callback(res.body.error);return}callback()})};Transaction.prototype.abort=function(callback){this.verify();var url=crypton.url()+"/transaction/"+this.id;superagent.del(url).withCredentials().end(function(res){if(!res.body||res.body.success!==true){callback(res.body.error);return}callback()})};Transaction.prototype.verify=function(){if(!this.id){throw new Error("Invalid transaction")}};Transaction.prototype.verifyChunk=function(chunk){if(!chunk||!~this.types.indexOf(chunk.type)){throw new Error("Invalid transaction chunk type")}}})();(function(){"use strict";var Peer=crypton.Peer=function(options){options=options||{};this.accountId=options.id;this.session=options.session;this.username=options.username;this.pubKey=options.pubKey;this.signKeyPub=options.signKeyPub};Peer.prototype.fetch=function(callback){if(!this.username){callback("Must supply peer username");return}if(!this.session){callback("Must supply session to peer object");return}var that=this;var url=crypton.url()+"/peer/"+this.username;superagent.get(url).withCredentials().end(function(res){if(!res.body||res.body.success!==true){callback(res.body.error);return}var peer=res.body.peer;that.accountId=peer.accountId;that.username=peer.username;that.pubKey=peer.pubKey;that.signKeyPub=peer.signKeyPub;var point=sjcl.ecc.curves["c"+peer.pubKey.curve].fromBits(peer.pubKey.point);that.pubKey=new sjcl.ecc.elGamal.publicKey(peer.pubKey.curve,point.curve,point);var signPoint=sjcl.ecc.curves["c"+peer.signKeyPub.curve].fromBits(peer.signKeyPub.point);that.signKeyPub=new sjcl.ecc.ecdsa.publicKey(peer.signKeyPub.curve,signPoint.curve,signPoint);that.fingerprint=crypton.fingerprint(that.pubKey,that.signKeyPub);callback(null,that)})};Peer.prototype.encrypt=function(payload){if(!this.trusted){return{error:"Peer is untrusted"}}var ciphertext=sjcl.encrypt(this.pubKey,JSON.stringify(payload),crypton.cipherOptions);return ciphertext};Peer.prototype.encryptAndSign=function(payload){if(!this.trusted){return{error:"Peer is untrusted"}}try{var ciphertext=sjcl.encrypt(this.pubKey,JSON.stringify(payload),crypton.cipherOptions);var hash=sjcl.hash.sha256.hash(ciphertext);var signature=this.session.account.signKeyPrivate.sign(hash,crypton.paranoia);return{ciphertext:JSON.parse(ciphertext),signature:signature,error:null}}catch(ex){var err="Error: Could not complete encryptAndSign: "+ex;return{ciphertext:null,signature:null,error:err}}};Peer.prototype.sendMessage=function(headers,payload,callback){if(!this.session){callback("Must supply session to peer object");return}var message=new crypton.Message(this.session);message.headers=headers;message.payload=payload;message.fromAccount=this.session.accountId;message.toAccount=this.accountId;message.encrypt(this);message.send(callback)};Peer.prototype.trust=function(callback){var that=this;that.session.load(crypton.trustStateContainer,function(err,container){if(err){return callback(err)}if(container.keys[that.username]){return callback("Peer is already trusted")}container.keys[that.username]={trustedAt:+new Date,fingerprint:that.fingerprint};container.save(function(err){if(err){return callback(err)}that.trusted=true;callback(null)})})}})();(function(){"use strict";var Message=crypton.Message=function Message(session,raw){this.session=session;this.headers={};this.payload={};raw=raw||{};for(var i in raw){this[i]=raw[i]}};Message.prototype.encrypt=function(peer,callback){var headersCiphertext=peer.encryptAndSign(this.headers);var payloadCiphertext=peer.encryptAndSign(this.payload);if(headersCiphertext.error||payloadCiphertext.error){callback("Error encrypting headers or payload in Message.encrypt()");return}this.encrypted={headersCiphertext:JSON.stringify(headersCiphertext),payloadCiphertext:JSON.stringify(payloadCiphertext),fromUsername:this.session.account.username,toAccountId:peer.accountId};callback&&callback(null)};Message.prototype.decrypt=function(callback){var that=this;var headersCiphertext=JSON.parse(this.headersCiphertext);var payloadCiphertext=JSON.parse(this.payloadCiphertext);this.session.getPeer(this.fromUsername,function(err,peer){if(err){callback(err);return}var headers=that.session.account.verifyAndDecrypt(headersCiphertext,peer);var payload=that.session.account.verifyAndDecrypt(payloadCiphertext,peer);if(!headers.verified||!payload.verified){callback("Cannot verify headers or payload ciphertext in Message.decrypt()");return}else if(headers.error||payload.error){callback("Cannot decrypt headers or payload in Message.decrypt");return}that.headers=JSON.parse(headers.plaintext);that.payload=JSON.parse(payload.plaintext);that.created=new Date(that.creationTime);callback(null,that)})};Message.prototype.send=function(callback){if(!this.encrypted){return callback("You must encrypt the message to a peer before sending!")}var url=crypton.url()+"/peer";superagent.post(url).send(this.encrypted).withCredentials().end(function(res){if(!res.body||res.body.success!==true){callback(res.body.error);return}callback(null,res.body.messageId)})}})();(function(){"use strict";var Inbox=crypton.Inbox=function Inbox(session){this.session=session;this.rawMessages=[];this.messages={};this.poll()};Inbox.prototype.poll=function(callback){var that=this;var url=crypton.url()+"/inbox";callback=callback||function(){};superagent.get(url).withCredentials().end(function(res){if(!res.body||res.body.success!==true){callback(res.body.error);return}that.rawMessages=res.body.messages;that.parseRawMessages();callback(null,res.body.messages)})};Inbox.prototype.list=function(){return this.messages};Inbox.prototype.filter=function(criteria,callback){criteria=criteria||{};async.filter(this.messages,function(message){for(var i in criteria){if(message[i]!=criteria[i]){return false}}return true},function(messages){callback(messages)})};Inbox.prototype.get=function(messageId,callback){var cachedMessage=this.messages[messageId];if(cachedMessage){callback(null,cachedMessage);return}var that=this;var url=crypton.url()+"/inbox/"+messageId;callback=callback||function(){};superagent.get(url).withCredentials().end(function(res){if(!res.body||res.body.success!==true){callback(res.body.error);return}var message=new crypton.Message(that.session,res.body.message);message.decrypt(function(err){that.messages[message.id]=message;callback(null,message)})})};Inbox.prototype.delete=function(id,callback){var chunk={type:"deleteMessage",messageId:id};var tx=new crypton.Transaction(this.session,function(err){tx.save(chunk,function(err){tx.commit(function(err){callback()})})})};Inbox.prototype.clear=function(callback){var chunk={type:"clearInbox"};var tx=new crypton.Transaction(this.session,function(err){tx.save(chunk,function(err){tx.commit(function(err){callback()})})})};Inbox.prototype.parseRawMessages=function(){var that=this;for(var i in this.rawMessages){var rawMessage=this.rawMessages[i];if(this.messages[rawMessage.messageId]){continue}var message=new crypton.Message(this.session,rawMessage);message.decrypt(function(err){that.messages[message.messageId]=message})}}})();(function(){"use strict";var Diff=crypton.diff={};Diff.create=function(old,current){var delta=jsondiffpatch.diff(old,current);return delta};Diff.apply=function(delta,old){var current=JSON.parse(JSON.stringify(old));jsondiffpatch.patch(current,delta);return current}})();(function(){"use strict";!self.worker&&window.addEventListener("load",function(){var scriptEls=document.getElementsByTagName("script");var path;for(var i in scriptEls){if(scriptEls[i].src&&~scriptEls[i].src.indexOf("crypton")){path=scriptEls[i].src}}isomerize(crypton.work,path)},false);var work=crypton.work={};work.calculateSrpA=function(options,callback){if(!crypton.collectorsStarted){crypton.startCollectors()}try{var srp=new SRPClient(options.username,options.passphrase,2048,"sha-256");var a=srp.srpRandom();var srpA=srp.calculateA(a);var srpAstr=srpA.toString(16);srpAstr=srp.nZeros(512-srpAstr.length)+srpAstr;callback(null,{a:a.toString(),srpA:srpA.toString(),srpAstr:srpAstr})}catch(e){console.log(e);callback(e)}};work.calculateSrpM1=function(options,callback){try{var srp=new SRPClient(options.username,options.passphrase,2048,"sha-256");var srpSalt=options.srpSalt;var a=new BigInteger(options.a);var srpA=new BigInteger(options.srpA);var srpB=new BigInteger(options.srpB,16);var srpu=srp.calculateU(srpA,srpB);var srpS=srp.calculateS(srpB,options.srpSalt,srpu,a);var rawSrpM1=srp.calculateMozillaM1(srpA,srpB,srpS);var srpM1=rawSrpM1.toString(16);srpM1=srp.nZeros(64-srpM1.length)+srpM1;var srpK=srp.calculateK(srpS);var srpM2=srp.calculateMozillaM2(srpA,rawSrpM1,srpK).toString(16);callback(null,srpM1,srpM2)}catch(e){console.log(e);callback(e)}};work.unravelAccount=function(account,callback){var ret={};var keypairKey=sjcl.misc.pbkdf2(account.passphrase,account.keypairSalt);
var keypairMacKey=sjcl.misc.pbkdf2(account.passphrase,account.keypairMacSalt);var signKeyPrivateMacKey=sjcl.misc.pbkdf2(account.passphrase,account.signKeyPrivateMacSalt);var macOk=false;try{var ciphertextString=JSON.stringify(account.keypairCiphertext);macOk=crypton.hmacAndCompare(keypairMacKey,ciphertextString,account.keypairMac);ret.secret=JSON.parse(sjcl.decrypt(keypairKey,ciphertextString,crypton.cipherOptions))}catch(e){}if(!macOk||!ret.secret){return callback("Could not parse secret key")}macOk=false;try{var ciphertextString=JSON.stringify(account.signKeyPrivateCiphertext);macOk=crypton.hmacAndCompare(signKeyPrivateMacKey,ciphertextString,account.signKeyPrivateMac);ret.signKeySecret=JSON.parse(sjcl.decrypt(keypairKey,ciphertextString,crypton.cipherOptions))}catch(e){}if(!macOk||!ret.signKeySecret){return callback("Could not parse signKeySecret")}var exponent=sjcl.bn.fromBits(ret.secret.exponent);var secretKey=new sjcl.ecc.elGamal.secretKey(ret.secret.curve,sjcl.ecc.curves["c"+ret.secret.curve],exponent);account.secretKey=secretKey;var session={};session.account=account;session.account.signKeyPrivate=ret.signKeySecret;var signPoint=sjcl.ecc.curves["c"+account.signKeyPub.curve].fromBits(account.signKeyPub.point);var selfPeer=new crypton.Peer({session:session,pubKey:account.pubKey,signKeyPub:new sjcl.ecc.ecdsa.publicKey(account.signKeyPub.curve,signPoint.curve,signPoint)});selfPeer.trusted=true;var selfAccount=new crypton.Account;selfAccount.secretKey=secretKey;var containerNameHmacKey;try{containerNameHmacKey=selfAccount.verifyAndDecrypt(account.containerNameHmacKeyCiphertext,selfPeer);ret.containerNameHmacKey=JSON.parse(containerNameHmacKey.plaintext)}catch(e){}if(!containerNameHmacKey.verified){return callback("Could not parse containerNameHmacKey")}var hmacKey;try{hmacKey=selfAccount.verifyAndDecrypt(account.hmacKeyCiphertext,selfPeer);ret.hmacKey=JSON.parse(hmacKey.plaintext)}catch(e){}if(!hmacKey.verified){return callback("Could not parse hmacKey")}callback(null,ret)};work.decryptRecord=function(options,callback){var sessionKey=options.sessionKey;var creationTime=options.creationTime;var expectedRecordIndex=options.expectedRecordIndex;var peerSignKeyPubSerialized=options.peerSignKeyPubSerialized;if(!sessionKey||!creationTime||!expectedRecordIndex||!peerSignKeyPubSerialized){return callback("Must supply all options to work.decryptRecord")}var record;try{record=JSON.parse(options.record)}catch(e){}if(!record){return callback("Could not parse record")}var curve="c"+peerSignKeyPubSerialized.curve;var signPoint=sjcl.ecc.curves[curve].fromBits(peerSignKeyPubSerialized.point);var peerSignKeyPub=new sjcl.ecc.ecdsa.publicKey(peerSignKeyPubSerialized.curve,signPoint.curve,signPoint);var verified=false;var payloadCiphertextHash=sjcl.hash.sha256.hash(JSON.stringify(record.ciphertext));try{verified=peerSignKeyPub.verify(payloadCiphertextHash,record.signature)}catch(e){console.log(e)}if(!verified){return callback("Record signature does not match expected signature")}var payload;try{payload=JSON.parse(sjcl.decrypt(sessionKey,record.ciphertext,crypton.cipherOptions))}catch(e){}if(!payload){return callback("Could not parse record payload")}if(payload.recordIndex!==expectedRecordIndex){}callback(null,{time:+new Date(creationTime),delta:payload.delta})}})();(function(){var async={};var root,previous_async;root=this;if(root!=null){previous_async=root.async}async.noConflict=function(){root.async=previous_async;return async};function only_once(fn){var called=false;return function(){if(called)throw new Error("Callback was already called.");called=true;fn.apply(root,arguments)}}var _each=function(arr,iterator){if(arr.forEach){return arr.forEach(iterator)}for(var i=0;i<arr.length;i+=1){iterator(arr[i],i,arr)}};var _map=function(arr,iterator){if(arr.map){return arr.map(iterator)}var results=[];_each(arr,function(x,i,a){results.push(iterator(x,i,a))});return results};var _reduce=function(arr,iterator,memo){if(arr.reduce){return arr.reduce(iterator,memo)}_each(arr,function(x,i,a){memo=iterator(memo,x,i,a)});return memo};var _keys=function(obj){if(Object.keys){return Object.keys(obj)}var keys=[];for(var k in obj){if(obj.hasOwnProperty(k)){keys.push(k)}}return keys};if(typeof process==="undefined"||!process.nextTick){if(typeof setImmediate==="function"){async.nextTick=function(fn){setImmediate(fn)};async.setImmediate=async.nextTick}else{async.nextTick=function(fn){setTimeout(fn,0)};async.setImmediate=async.nextTick}}else{async.nextTick=process.nextTick;if(typeof setImmediate!=="undefined"){async.setImmediate=setImmediate}else{async.setImmediate=async.nextTick}}async.each=function(arr,iterator,callback){callback=callback||function(){};if(!arr.length){return callback()}var completed=0;_each(arr,function(x){iterator(x,only_once(function(err){if(err){callback(err);callback=function(){}}else{completed+=1;if(completed>=arr.length){callback(null)}}}))})};async.forEach=async.each;async.eachSeries=function(arr,iterator,callback){callback=callback||function(){};if(!arr.length){return callback()}var completed=0;var iterate=function(){iterator(arr[completed],function(err){if(err){callback(err);callback=function(){}}else{completed+=1;if(completed>=arr.length){callback(null)}else{iterate()}}})};iterate()};async.forEachSeries=async.eachSeries;async.eachLimit=function(arr,limit,iterator,callback){var fn=_eachLimit(limit);fn.apply(null,[arr,iterator,callback])};async.forEachLimit=async.eachLimit;var _eachLimit=function(limit){return function(arr,iterator,callback){callback=callback||function(){};if(!arr.length||limit<=0){return callback()}var completed=0;var started=0;var running=0;(function replenish(){if(completed>=arr.length){return callback()}while(running<limit&&started<arr.length){started+=1;running+=1;iterator(arr[started-1],function(err){if(err){callback(err);callback=function(){}}else{completed+=1;running-=1;if(completed>=arr.length){callback()}else{replenish()}}})}})()}};var doParallel=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[async.each].concat(args))}};var doParallelLimit=function(limit,fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[_eachLimit(limit)].concat(args))}};var doSeries=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[async.eachSeries].concat(args))}};var _asyncMap=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}});eachfn(arr,function(x,callback){iterator(x.value,function(err,v){results[x.index]=v;callback(err)})},function(err){callback(err,results)})};async.map=doParallel(_asyncMap);async.mapSeries=doSeries(_asyncMap);async.mapLimit=function(arr,limit,iterator,callback){return _mapLimit(limit)(arr,iterator,callback)};var _mapLimit=function(limit){return doParallelLimit(limit,_asyncMap)};async.reduce=function(arr,memo,iterator,callback){async.eachSeries(arr,function(x,callback){iterator(memo,x,function(err,v){memo=v;callback(err)})},function(err){callback(err,memo)})};async.inject=async.reduce;async.foldl=async.reduce;async.reduceRight=function(arr,memo,iterator,callback){var reversed=_map(arr,function(x){return x}).reverse();async.reduce(reversed,memo,iterator,callback)};async.foldr=async.reduceRight;var _filter=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}});eachfn(arr,function(x,callback){iterator(x.value,function(v){if(v){results.push(x)}callback()})},function(err){callback(_map(results.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})};async.filter=doParallel(_filter);async.filterSeries=doSeries(_filter);async.select=async.filter;async.selectSeries=async.filterSeries;var _reject=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}});eachfn(arr,function(x,callback){iterator(x.value,function(v){if(!v){results.push(x)}callback()})},function(err){callback(_map(results.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})};async.reject=doParallel(_reject);async.rejectSeries=doSeries(_reject);var _detect=function(eachfn,arr,iterator,main_callback){eachfn(arr,function(x,callback){iterator(x,function(result){if(result){main_callback(x);main_callback=function(){}}else{callback()}})},function(err){main_callback()})};async.detect=doParallel(_detect);async.detectSeries=doSeries(_detect);async.some=function(arr,iterator,main_callback){async.each(arr,function(x,callback){iterator(x,function(v){if(v){main_callback(true);main_callback=function(){}}callback()})},function(err){main_callback(false)})};async.any=async.some;async.every=function(arr,iterator,main_callback){async.each(arr,function(x,callback){iterator(x,function(v){if(!v){main_callback(false);main_callback=function(){}}callback()})},function(err){main_callback(true)})};async.all=async.every;async.sortBy=function(arr,iterator,callback){async.map(arr,function(x,callback){iterator(x,function(err,criteria){if(err){callback(err)}else{callback(null,{value:x,criteria:criteria})}})},function(err,results){if(err){return callback(err)}else{var fn=function(left,right){var a=left.criteria,b=right.criteria;return a<b?-1:a>b?1:0};callback(null,_map(results.sort(fn),function(x){return x.value}))}})};async.auto=function(tasks,callback){callback=callback||function(){};var keys=_keys(tasks);if(!keys.length){return callback(null)}var results={};var listeners=[];var addListener=function(fn){listeners.unshift(fn)};var removeListener=function(fn){for(var i=0;i<listeners.length;i+=1){if(listeners[i]===fn){listeners.splice(i,1);return}}};var taskComplete=function(){_each(listeners.slice(0),function(fn){fn()})};addListener(function(){if(_keys(results).length===keys.length){callback(null,results);callback=function(){}}});_each(keys,function(k){var task=tasks[k]instanceof Function?[tasks[k]]:tasks[k];var taskCallback=function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}if(err){var safeResults={};_each(_keys(results),function(rkey){safeResults[rkey]=results[rkey]});safeResults[k]=args;callback(err,safeResults);callback=function(){}}else{results[k]=args;async.setImmediate(taskComplete)}};var requires=task.slice(0,Math.abs(task.length-1))||[];var ready=function(){return _reduce(requires,function(a,x){return a&&results.hasOwnProperty(x)},true)&&!results.hasOwnProperty(k)};if(ready()){task[task.length-1](taskCallback,results)}else{var listener=function(){if(ready()){removeListener(listener);task[task.length-1](taskCallback,results)}};addListener(listener)}})};async.waterfall=function(tasks,callback){callback=callback||function(){};if(tasks.constructor!==Array){var err=new Error("First argument to waterfall must be an array of functions");return callback(err)}if(!tasks.length){return callback()}var wrapIterator=function(iterator){return function(err){if(err){callback.apply(null,arguments);callback=function(){}}else{var args=Array.prototype.slice.call(arguments,1);var next=iterator.next();if(next){args.push(wrapIterator(next))}else{args.push(callback)}async.setImmediate(function(){iterator.apply(null,args)})}}};wrapIterator(async.iterator(tasks))()};var _parallel=function(eachfn,tasks,callback){callback=callback||function(){};if(tasks.constructor===Array){eachfn.map(tasks,function(fn,callback){if(fn){fn(function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}callback.call(null,err,args)})}},callback)}else{var results={};eachfn.each(_keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}results[k]=args;callback(err)})},function(err){callback(err,results)})}};async.parallel=function(tasks,callback){_parallel({map:async.map,each:async.each},tasks,callback)};async.parallelLimit=function(tasks,limit,callback){_parallel({map:_mapLimit(limit),each:_eachLimit(limit)},tasks,callback)};async.series=function(tasks,callback){callback=callback||function(){};if(tasks.constructor===Array){async.mapSeries(tasks,function(fn,callback){if(fn){fn(function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}callback.call(null,err,args)})}},callback)}else{var results={};async.eachSeries(_keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}results[k]=args;callback(err)})},function(err){callback(err,results)})}};async.iterator=function(tasks){var makeCallback=function(index){var fn=function(){if(tasks.length){tasks[index].apply(null,arguments)}return fn.next()};fn.next=function(){return index<tasks.length-1?makeCallback(index+1):null};return fn};return makeCallback(0)};async.apply=function(fn){var args=Array.prototype.slice.call(arguments,1);return function(){return fn.apply(null,args.concat(Array.prototype.slice.call(arguments)))}};var _concat=function(eachfn,arr,fn,callback){var r=[];eachfn(arr,function(x,cb){fn(x,function(err,y){r=r.concat(y||[]);cb(err)})},function(err){callback(err,r)})};async.concat=doParallel(_concat);async.concatSeries=doSeries(_concat);async.whilst=function(test,iterator,callback){if(test()){iterator(function(err){if(err){return callback(err)}async.whilst(test,iterator,callback)})}else{callback()}};async.doWhilst=function(iterator,test,callback){iterator(function(err){if(err){return callback(err)}if(test()){async.doWhilst(iterator,test,callback)}else{callback()}})};async.until=function(test,iterator,callback){if(!test()){iterator(function(err){if(err){return callback(err)}async.until(test,iterator,callback)})}else{callback()}};async.doUntil=function(iterator,test,callback){iterator(function(err){if(err){return callback(err)}if(!test()){async.doUntil(iterator,test,callback)}else{callback()}})};async.queue=function(worker,concurrency){if(concurrency===undefined){concurrency=1}function _insert(q,data,pos,callback){if(data.constructor!==Array){data=[data]}_each(data,function(task){var item={data:task,callback:typeof callback==="function"?callback:null};if(pos){q.tasks.unshift(item)}else{q.tasks.push(item)}if(q.saturated&&q.tasks.length===concurrency){q.saturated()}async.setImmediate(q.process)})}var workers=0;var q={tasks:[],concurrency:concurrency,saturated:null,empty:null,drain:null,push:function(data,callback){_insert(q,data,false,callback)},unshift:function(data,callback){_insert(q,data,true,callback)},process:function(){if(workers<q.concurrency&&q.tasks.length){var task=q.tasks.shift();if(q.empty&&q.tasks.length===0){q.empty()}workers+=1;var next=function(){workers-=1;if(task.callback){task.callback.apply(task,arguments)}if(q.drain&&q.tasks.length+workers===0){q.drain()}q.process()};var cb=only_once(next);worker(task.data,cb)}},length:function(){return q.tasks.length},running:function(){return workers}};return q};async.cargo=function(worker,payload){var working=false,tasks=[];var cargo={tasks:tasks,payload:payload,saturated:null,empty:null,drain:null,push:function(data,callback){if(data.constructor!==Array){data=[data]}_each(data,function(task){tasks.push({data:task,callback:typeof callback==="function"?callback:null});if(cargo.saturated&&tasks.length===payload){cargo.saturated()}});async.setImmediate(cargo.process)},process:function process(){if(working)return;if(tasks.length===0){if(cargo.drain)cargo.drain();return}var ts=typeof payload==="number"?tasks.splice(0,payload):tasks.splice(0);var ds=_map(ts,function(task){return task.data});if(cargo.empty)cargo.empty();working=true;worker(ds,function(){working=false;var args=arguments;_each(ts,function(data){if(data.callback){data.callback.apply(null,args)}});process()})},length:function(){return tasks.length},running:function(){return working}};return cargo};var _console_fn=function(name){return function(fn){var args=Array.prototype.slice.call(arguments,1);fn.apply(null,args.concat([function(err){var args=Array.prototype.slice.call(arguments,1);if(typeof console!=="undefined"){if(err){if(console.error){console.error(err)}}else if(console[name]){_each(args,function(x){console[name](x)})}}}]))}};async.log=_console_fn("log");async.dir=_console_fn("dir");async.memoize=function(fn,hasher){var memo={};var queues={};hasher=hasher||function(x){return x};var memoized=function(){var args=Array.prototype.slice.call(arguments);var callback=args.pop();var key=hasher.apply(null,args);if(key in memo){callback.apply(null,memo[key])}else if(key in queues){queues[key].push(callback)}else{queues[key]=[callback];fn.apply(null,args.concat([function(){memo[key]=arguments;var q=queues[key];delete queues[key];for(var i=0,l=q.length;i<l;i++){q[i].apply(null,arguments)}}]))}};memoized.memo=memo;memoized.unmemoized=fn;return memoized};async.unmemoize=function(fn){return function(){return(fn.unmemoized||fn).apply(null,arguments)}};async.times=function(count,iterator,callback){var counter=[];for(var i=0;i<count;i++){counter.push(i)}return async.map(counter,iterator,callback)};async.timesSeries=function(count,iterator,callback){var counter=[];for(var i=0;i<count;i++){counter.push(i)}return async.mapSeries(counter,iterator,callback)};async.compose=function(){var fns=Array.prototype.reverse.call(arguments);return function(){var that=this;var args=Array.prototype.slice.call(arguments);var callback=args.pop();async.reduce(fns,args,function(newargs,fn,cb){fn.apply(that,newargs.concat([function(){var err=arguments[0];var nextargs=Array.prototype.slice.call(arguments,1);cb(err,nextargs)}]))},function(err,results){callback.apply(that,[err].concat(results))})}};var _applyEach=function(eachfn,fns){var go=function(){var that=this;var args=Array.prototype.slice.call(arguments);var callback=args.pop();return eachfn(fns,function(fn,cb){fn.apply(that,args.concat([cb]))},callback)};if(arguments.length>2){var args=Array.prototype.slice.call(arguments,2);return go.apply(this,args)}else{return go}};async.applyEach=doParallel(_applyEach);async.applyEachSeries=doSeries(_applyEach);async.forever=function(fn,callback){function next(err){if(err){if(callback){return callback(err)}throw err}fn(next)}next()};if(typeof define!=="undefined"&&define.amd){define([],function(){return async})}else if(typeof module!=="undefined"&&module.exports){module.exports=async}else{root.async=async}})();(function(global){var BASE64_CODE=[".","/","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];var BASE64_INDEX=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,54,55,56,57,58,59,60,61,62,63,-1,-1,-1,-1,-1,-1,-1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,-1,-1,-1,-1,-1,-1,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,-1,-1,-1,-1,-1];var base64={};base64.encode=function(b,len){var off=0;var rs=[];var c1;var c2;if(len<=0||len>b.length){throw new Error("Invalid 'len': "+len)}while(off<len){c1=b[off++]&255;rs.push(BASE64_CODE[c1>>2&63]);c1=(c1&3)<<4;if(off>=len){rs.push(BASE64_CODE[c1&63]);break}c2=b[off++]&255;c1|=c2>>4&15;rs.push(BASE64_CODE[c1&63]);c1=(c2&15)<<2;if(off>=len){rs.push(BASE64_CODE[c1&63]);break}c2=b[off++]&255;c1|=c2>>6&3;rs.push(BASE64_CODE[c1&63]);rs.push(BASE64_CODE[c2&63])}return rs.join("")};base64.decode=function(s,len){var off=0;var slen=s.length;var olen=0;var rs=[];var c1,c2,c3,c4,o,code;if(len<=0)throw new Error("Illegal 'len': "+len);while(off<slen-1&&olen<len){code=s.charCodeAt(off++);c1=code<BASE64_INDEX.length?BASE64_INDEX[code]:-1;code=s.charCodeAt(off++);c2=code<BASE64_INDEX.length?BASE64_INDEX[code]:-1;if(c1==-1||c2==-1){break}o=c1<<2>>>0;o|=(c2&48)>>4;rs.push(String.fromCharCode(o));if(++olen>=len||off>=slen){break}code=s.charCodeAt(off++);c3=code<BASE64_INDEX.length?BASE64_INDEX[code]:-1;if(c3==-1){break}o=(c2&15)<<4>>>0;o|=(c3&60)>>2;rs.push(String.fromCharCode(o));if(++olen>=len||off>=slen){break}code=s.charCodeAt(off++);c4=code<BASE64_INDEX.length?BASE64_INDEX[code]:-1;o=(c3&3)<<6>>>0;o|=c4;rs.push(String.fromCharCode(o));++olen}var res=[];for(off=0;off<olen;off++){res.push(rs[off].charCodeAt(0))}return res};var bcrypt={};var BCRYPT_SALT_LEN=16;var GENSALT_DEFAULT_LOG2_ROUNDS=10;var BLOWFISH_NUM_ROUNDS=16;var MAX_EXECUTION_TIME=100;var P_ORIG=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731];var S_ORIG=[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946,1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055,3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504,976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462];var C_ORIG=[1332899944,1700884034,1701343084,1684370003,1668446532,1869963892];function _encipher(lr,off,P,S){var n;var l=lr[off];var r=lr[off+1];l^=P[0];for(var i=0;i<=BLOWFISH_NUM_ROUNDS-2;){n=S[l>>24&255];n+=S[256|l>>16&255];n^=S[512|l>>8&255];
n+=S[768|l&255];r^=n^P[++i];n=S[r>>24&255];n+=S[256|r>>16&255];n^=S[512|r>>8&255];n+=S[768|r&255];l^=n^P[++i]}lr[off]=r^P[BLOWFISH_NUM_ROUNDS+1];lr[off+1]=l;return lr}function _streamtoword(data,offp){var i;var word=0;for(i=0;i<4;i++){word=word<<8|data[offp]&255;offp=(offp+1)%data.length}return{key:word,offp:offp}}function _key(key,P,S){var offset=0;var lr=new Array(0,0);var plen=P.length;var slen=S.length;for(var i=0;i<plen;i++){var sw=_streamtoword(key,offset);offset=sw.offp;P[i]=P[i]^sw.key}for(i=0;i<plen;i+=2){lr=_encipher(lr,0,P,S);P[i]=lr[0];P[i+1]=lr[1]}for(i=0;i<slen;i+=2){lr=_encipher(lr,0,P,S);S[i]=lr[0];S[i+1]=lr[1]}}function _ekskey(data,key,P,S){var offp=0;var lr=new Array(0,0);var plen=P.length;var slen=S.length;var sw;for(var i=0;i<plen;i++){sw=_streamtoword(key,offp);offp=sw.offp;P[i]=P[i]^sw.key}offp=0;for(i=0;i<plen;i+=2){sw=_streamtoword(data,offp);offp=sw.offp;lr[0]^=sw.key;sw=_streamtoword(data,offp);offp=sw.offp;lr[1]^=sw.key;lr=_encipher(lr,0,P,S);P[i]=lr[0];P[i+1]=lr[1]}for(i=0;i<slen;i+=2){sw=_streamtoword(data,offp);offp=sw.offp;lr[0]^=sw.key;sw=_streamtoword(data,offp);offp=sw.offp;lr[1]^=sw.key;lr=_encipher(lr,0,P,S);S[i]=lr[0];S[i+1]=lr[1]}}function _nextTick(callback){if(typeof process!=="undefined"&&typeof process.nextTick==="function"){if(typeof setImmediate==="function"){setImmediate(callback)}else{process.nextTick(callback)}}else{setTimeout(callback,0)}}function _crypt(b,salt,rounds,callback){var cdata=C_ORIG.slice();var clen=cdata.length;if(rounds<4||rounds>31){throw new Error("Illegal number of rounds: "+rounds)}if(salt.length!=BCRYPT_SALT_LEN){throw new Error("Illegal salt length: "+salt.length+" != "+BCRYPT_SALT_LEN)}rounds=1<<rounds;var P=P_ORIG.slice();var S=S_ORIG.slice();_ekskey(salt,b,P,S);var i=0,j;function next(){if(i<rounds){var start=new Date;for(;i<rounds;){i=i+1;_key(b,P,S);_key(salt,P,S);if(Date.now()-start>MAX_EXECUTION_TIME){break}}}else{for(i=0;i<64;i++){for(j=0;j<clen>>1;j++){_encipher(cdata,j<<1,P,S)}}var ret=[];for(i=0;i<clen;i++){ret.push((cdata[i]>>24&255)>>>0);ret.push((cdata[i]>>16&255)>>>0);ret.push((cdata[i]>>8&255)>>>0);ret.push((cdata[i]&255)>>>0)}if(callback){callback(null,ret);return null}else{return ret}}if(callback){_nextTick(next)}return null}if(typeof callback!=="undefined"){next();return null}else{var res;while(true){if((res=next())!==null){return res}}}}function _stringToBytes(str){var ch,st,re=[];for(var i=0;i<str.length;i++){ch=str.charCodeAt(i);st=[];do{st.push(ch&255);ch=ch>>8}while(ch);re=re.concat(st.reverse())}return re}function _hash(s,salt,callback){var minor,offset;if(salt.charAt(0)!="$"||salt.charAt(1)!="2"){throw new Error("Invalid salt version: "+salt.substring(0,2))}if(salt.charAt(2)=="$"){minor=String.fromCharCode(0);offset=3}else{minor=salt.charAt(2);if(minor!="a"||salt.charAt(3)!="$"){throw new Error("Invalid salt revision: "+salt.substring(2,4))}offset=4}if(salt.charAt(offset+2)>"$"){throw new Error("Missing salt rounds")}var r1=parseInt(salt.substring(offset,offset+1),10)*10;var r2=parseInt(salt.substring(offset+1,offset+2),10);var rounds=r1+r2;var real_salt=salt.substring(offset+3,offset+25);s+=minor>="a"?"\x00":"";var passwordb=_stringToBytes(s);var saltb=[];saltb=base64.decode(real_salt,BCRYPT_SALT_LEN);function finish(bytes){var res=[];res.push("$2");if(minor>="a")res.push(minor);res.push("$");if(rounds<10)res.push("0");res.push(rounds.toString());res.push("$");res.push(base64.encode(saltb,saltb.length));res.push(base64.encode(bytes,C_ORIG.length*4-1));return res.join("")}if(typeof callback=="undefined"){return finish(_crypt(passwordb,saltb,rounds))}else{_crypt(passwordb,saltb,rounds,function(err,bytes){if(err){callback(err,null)}else{callback(null,finish(bytes))}});return null}}function _randomBytes(len){if(typeof module!=="undefined"&&module.exports){var crypto=require("crypto");return crypto.randomBytes(len)}else{var array=new Uint32Array(len);if(global.crypto&&typeof global.crypto.getRandomValues==="function"){global.crypto.getRandomValues(array)}else if(typeof _getRandomValues==="function"){_getRandomValues(array)}else{throw new Error("Failed to generate random values: Web Crypto API not available / no polyfill set")}return Array.prototype.slice.call(array)}}function _gensalt(rounds){rounds=rounds||10;if(rounds<4||rounds>31){throw new Error("Illegal number of rounds: "+rounds)}var salt=[];salt.push("$2a$");if(rounds<GENSALT_DEFAULT_LOG2_ROUNDS)salt.push("0");salt.push(rounds.toString());salt.push("$");try{salt.push(base64.encode(_randomBytes(BCRYPT_SALT_LEN),BCRYPT_SALT_LEN));return salt.join("")}catch(err){throw err}}var _getRandomValues=null;bcrypt.setRandomPolyfill=function(getRandomValues){_getRandomValues=getRandomValues};bcrypt.genSaltSync=function(rounds,seed_length){if(!rounds)rounds=10;return _gensalt(rounds)};bcrypt.genSalt=function(rounds,seed_length,callback){if(typeof seed_length=="function"){callback=seed_length;seed_length=-1}var rnd;if(typeof rounds=="function"){callback=rounds;rnd=GENSALT_DEFAULT_LOG2_ROUNDS}else{rnd=parseInt(rounds,10)}if(typeof callback!="function"){throw new Error("Illegal or missing 'callback': "+callback)}_nextTick(function(){try{var res=bcrypt.genSaltSync(rnd);callback(null,res)}catch(err){callback(err,null)}})};bcrypt.hashSync=function(s,salt){if(!salt)salt=GENSALT_DEFAULT_LOG2_ROUNDS;if(typeof salt=="number"){salt=bcrypt.genSaltSync(salt)}return _hash(s,salt)};bcrypt.hash=function(s,salt,callback){if(typeof callback!="function"){throw new Error("Illegal 'callback': "+callback)}if(typeof salt=="number"){bcrypt.genSalt(salt,function(err,salt){_hash(s,salt,callback)})}else{_hash(s,salt,callback)}};bcrypt.compareSync=function(s,hash){if(typeof s!="string"||typeof hash!="string"){throw new Error("Illegal argument types: "+typeof s+", "+typeof hash)}if(hash.length!=60){throw new Error("Illegal hash length: "+hash.length+" != 60")}var comp=bcrypt.hashSync(s,hash.substr(0,hash.length-31));var same=comp.length==hash.length;var max_length=comp.length<hash.length?comp.length:hash.length;for(var i=0;i<max_length;++i){if(comp.length>=i&&hash.length>=i&&comp[i]!=hash[i]){same=false}}return same};bcrypt.compare=function(s,hash,callback){if(typeof callback!="function"){throw new Error("Illegal 'callback': "+callback)}bcrypt.hash(s,hash.substr(0,29),function(err,comp){callback(err,hash===comp)})};bcrypt.getRounds=function(hash){if(typeof hash!="string"){throw new Error("Illegal type of 'hash': "+typeof hash)}return parseInt(hash.split("$")[2],10)};bcrypt.getSalt=function(hash){if(typeof hash!="string"){throw new Error("Illegal type of 'hash': "+typeof hash)}if(hash.length!=60){throw new Error("Illegal hash length: "+hash.length+" != 60")}return hash.substring(0,29)};if(typeof module!="undefined"&&module["exports"]){module["exports"]=bcrypt}else if(typeof define!="undefined"&&define["amd"]){define("bcrypt",function(){return bcrypt})}else{if(!global["dcodeIO"]){global["dcodeIO"]={}}global["dcodeIO"]["bcrypt"]=bcrypt}})(this);(function(){self.isomerize=function(obj,dependencies){if(!window.Worker){return}var code="";if(typeof dependencies=="string"){code+="window = document = self; self.worker = true;\n";code+="document.documentElement = { style: [] };\n";code+="importScripts('"+dependencies+"');\n"}else{for(var i in dependencies){var name=dependencies[i];var dep=window[name];code+=toSource(dep,name)}}code+=toSource(obj,"original");code+="("+isomerExternal.toString()+")();";var blob=new Blob([code],{type:"application/javascript"});var worker=new Worker(URL.createObjectURL(blob));var listeners={};worker.onmessage=function(e){var data=JSON.parse(e.data);if(!listeners[data.time]){return}listeners[data.time].apply(listeners[data.time],data.args)};for(var i in obj){if(typeof obj[i]=="function"){obj[i]=overrideLocalMethod(i)}}function overrideLocalMethod(methodName){return function isomerProxy(){var args=[].slice.call(arguments);var callback=args.pop();var now=+new Date;listeners[now]=callback;worker.postMessage(JSON.stringify({name:methodName,time:now,args:args}))}}};function isomerExternal(){onmessage=function(e){var data=JSON.parse(e.data);var args=data.args;args.push(function(){var args=[].slice.call(arguments);postMessage(JSON.stringify({time:data.time,args:args}))});original[data.name].apply(original,args)}}function toSource(obj,name){var code="";if(name){code+="var "+name+" = "}if(typeof obj=="function"){code+=obj.toString()}else{code+=JSON.stringify(obj)}code+=";\n";for(var i in obj){if(typeof obj[i]!="function"){continue}if(name){code+=name+"."+i+" = "}code+=obj[i].toString()+";\n"}for(var i in obj.prototype){if(name){code+=name+".prototype."+i+" = "}if(typeof obj.prototype[i]=="function"){code+=obj.prototype[i].toString()+";\n"}else if(typeof obj.prototype[i]=="object"){code+=JSON.stringify(obj.prototype[i])+";\n"}}return code}})();(function(){"use strict";var e={};typeof t!="undefined"&&(e=t);var t=e;e.version="0.0.7",e.config={textDiffMinLength:60,detectArrayMove:!0,includeValueOnArrayMove:!1};var n={diff:function(t,n,r,i){var s=0,o=0,u,a,f=t.length,l=n.length,c,h=[],p=[],d=typeof r=="function"?function(e,t,n,i){if(e===t)return!0;if(typeof e!="object"||typeof t!="object")return!1;var s,o;return typeof n=="number"?(s=h[n],typeof s=="undefined"&&(h[n]=s=r(e))):s=r(e),typeof i=="number"?(o=p[i],typeof o=="undefined"&&(p[i]=o=r(t))):o=r(t),s===o}:function(e,t){return e===t},v=function(e,r){return d(t[e],n[r],e,r)},m=function(e,r){if(!i)return;if(typeof t[e]!="object"||typeof n[r]!="object")return;var s=i(t[e],n[r]);if(typeof s=="undefined")return;c||(c={_t:"a"}),c[r]=s};while(s<f&&s<l&&v(s,s))m(s,s),s++;while(o+s<f&&o+s<l&&v(f-1-o,l-1-o))m(f-1-o,l-1-o),o++;if(s+o===f){if(f===l)return c;c=c||{_t:"a"};for(u=s;u<l-o;u++)c[u]=[n[u]];return c}if(s+o===l){c=c||{_t:"a"};for(u=s;u<f-o;u++)c["_"+u]=[t[u],0,0];return c}var g=this.lcs(t.slice(s,f-o),n.slice(s,l-o),{areTheSameByIndex:function(e,t){return v(e+s,t+s)}});c=c||{_t:"a"};var y=[];for(u=s;u<f-o;u++)g.indices1.indexOf(u-s)<0&&(c["_"+u]=[t[u],0,0],y.push(u));var b=y.length;for(u=s;u<l-o;u++){var w=g.indices2.indexOf(u-s);if(w<0){var E=!1;if(e.config.detectArrayMove&&b>0)for(a=0;a<b;a++)if(v(y[a],u)){c["_"+y[a]].splice(1,2,u,3),e.config.includeValueOnArrayMove||(c["_"+y[a]][0]=""),m(y[a],u),y.splice(a,1),E=!0;break}E||(c[u]=[n[u]])}else m(g.indices1[w]+s,g.indices2[w]+s)}return c},getArrayIndexBefore:function(e,t){var n,r=t;for(var s in e)if(e.hasOwnProperty(s)&&i(e[s])){s.slice(0,1)==="_"?n=parseInt(s.slice(1),10):n=parseInt(s,10);if(e[s].length===1){if(n<t)r--;else if(n===t)return-1}else if(e[s].length===3)if(e[s][2]===0)n<=t&&r++;else if(e[s][2]===3){n<=t&&r++;if(e[s][1]>t)r--;else if(e[s][1]===t)return n}}return r},patch:function(e,t,n,r){var i,s,o=function(e,t){return e-t},u=function(e){return function(t,n){return t[e]-n[e]}},a=[],f=[],l=[];for(i in t)if(i!=="_t")if(i[0]=="_"){if(t[i][2]!==0&&t[i][2]!==3)throw new Error("only removal or move can be applied at original array indices, invalid diff type: "+t[i][2]);a.push(parseInt(i.slice(1),10))}else t[i].length===1?f.push({index:parseInt(i,10),value:t[i][0]}):l.push({index:parseInt(i,10),diff:t[i]});a=a.sort(o);for(i=a.length-1;i>=0;i--){s=a[i];var c=t["_"+s],h=e.splice(s,1)[0];c[2]===3&&f.push({index:c[1],value:h})}f=f.sort(u("index"));var p=f.length;for(i=0;i<p;i++){var d=f[i];e.splice(d.index,0,d.value)}var v=l.length;if(v>0){if(typeof n!="function")throw new Error("to patch items in the array an objectInnerPatch function must be provided");for(i=0;i<v;i++){var m=l[i];n(e,m.index.toString(),m.diff,r)}}return e},lcs:function(e,t,n){n.areTheSameByIndex=n.areTheSameByIndex||function(n,r){return e[n]===t[r]};var r=this.lengthMatrix(e,t,n),i=this.backtrack(r,e,t,e.length,t.length);return typeof e=="string"&&typeof t=="string"&&(i.sequence=i.sequence.join("")),i},lengthMatrix:function(e,t,n){var r=e.length,i=t.length,s,o,u=[r+1];for(s=0;s<r+1;s++){u[s]=[i+1];for(o=0;o<i+1;o++)u[s][o]=0}u.options=n;for(s=1;s<r+1;s++)for(o=1;o<i+1;o++)n.areTheSameByIndex(s-1,o-1)?u[s][o]=u[s-1][o-1]+1:u[s][o]=Math.max(u[s-1][o],u[s][o-1]);return u},backtrack:function(e,t,n,r,i){if(r===0||i===0)return{sequence:[],indices1:[],indices2:[]};if(e.options.areTheSameByIndex(r-1,i-1)){var s=this.backtrack(e,t,n,r-1,i-1);return s.sequence.push(t[r-1]),s.indices1.push(r-1),s.indices2.push(i-1),s}return e[r][i-1]>e[r-1][i]?this.backtrack(e,t,n,r,i-1):this.backtrack(e,t,n,r-1,i)}};e.sequenceDiffer=n,e.dateReviver=function(e,t){var n;if(typeof t=="string"){n=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)(Z|([+\-])(\d{2}):(\d{2}))$/.exec(t);if(n)return new Date(Date.UTC(+n[1],+n[2]-1,+n[3],+n[4],+n[5],+n[6]))}return t};var r=function(){var t;e.config.diff_match_patch&&(t=new e.config.diff_match_patch.diff_match_patch),typeof diff_match_patch!="undefined"&&(typeof diff_match_patch=="function"?t=new diff_match_patch:typeof diff_match_patch=="object"&&typeof diff_match_patch.diff_match_patch=="function"&&(t=new diff_match_patch.diff_match_patch));if(t)return e.config.textDiff=function(e,n){return t.patch_toText(t.patch_make(e,n))},e.config.textPatch=function(e,n){var r=t.patch_apply(t.patch_fromText(n),e);for(var i=0;i<r[1].length;i++)if(!r[1][i])throw new Error("text patch failed");return r[0]},!0},i=e.isArray=typeof Array.isArray=="function"?Array.isArray:function(e){return typeof e=="object"&&e instanceof Array},s=e.isDate=function(e){return e instanceof Date||Object.prototype.toString.call(e)==="[object Date]"},o=function(t,r){return n.diff(t,r,e.config.objectHash,e.diff)},u=function(e,t){var n,r,i,s;s=function(i){r=a(e[i],t[i]),typeof r!="undefined"&&(typeof n=="undefined"&&(n={}),n[i]=r)};for(i in t)t.hasOwnProperty(i)&&s(i);for(i in e)e.hasOwnProperty(i)&&typeof t[i]=="undefined"&&s(i);return n},a=e.diff=function(t,n){var a,f,l,c,h;if(t===n)return;if(t!==t&&n!==n)return;a=typeof n,f=typeof t,l=n===null,c=t===null,f=="object"&&s(t)&&(f="date");if(a=="object"&&s(n)){a="date";if(f=="date"&&t.getTime()===n.getTime())return}if(l||c||a=="undefined"||a!=f||a=="number"||f=="number"||a=="boolean"||f=="boolean"||a=="string"||f=="string"||a=="date"||f=="date"||a==="object"&&i(n)!=i(t)){h=[];if(typeof t!="undefined")if(typeof n!="undefined"){var p=a=="string"&&f=="string"&&Math.min(t.length,n.length)>e.config.textDiffMinLength;p&&!e.config.textDiff&&r(),p&&e.config.textDiff?h.push(e.config.textDiff(t,n),0,2):(h.push(t),h.push(n))}else h.push(t),h.push(0,0);else h.push(n);return h}return i(n)?o(t,n):u(t,n)},f=function(e,t){return i(e)?e[parseInt(t,10)]:e[t]};e.getByKey=f;var l=function(e,t,n){if(i(e)&&e._key){var r=e._key;typeof e._key!="function"&&(r=function(t){return t[e._key]});for(var s=0;s<e.length;s++)if(r(e[s])===t){typeof n=="undefined"?(e.splice(s,1),s--):e[s]=n;return}typeof n!="undefined"&&e.push(n);return}typeof n=="undefined"?i(e)?e.splice(t,1):delete e[t]:e[t]=n},c=function(t){return e.config.textDiffReverse||(e.config.textDiffReverse=function(e){var t,n,r,i,s,o=null,u=/^@@ +\-(\d+),(\d+) +\+(\d+),(\d+) +@@$/,a,f,l,c=function(){f!==null&&(r[f]="-"+r[f].slice(1)),l!==null&&(r[l]="+"+r[l].slice(1),f!==null&&(s=r[f],r[f]=r[l],r[l]=s)),r[a]="@@ -"+o[3]+","+o[4]+" +"+o[1]+","+o[2]+" @@",o=null,a=null,f=null,l=null};r=e.split("\n");for(t=0,n=r.length;t<n;t++){i=r[t];var h=i.slice(0,1);h==="@"?(o!==null,o=u.exec(i),a=t,f=null,l=null,r[a]="@@ -"+o[3]+","+o[4]+" +"+o[1]+","+o[2]+" @@"):h=="+"?(f=t,r[t]="-"+r[t].slice(1)):h=="-"&&(l=t,r[t]="+"+r[t].slice(1))}return o!==null,r.join("\n")}),e.config.textDiffReverse(t)},h=e.reverse=function(e){var t,r;if(typeof e=="undefined")return;if(e===null)return null;if(typeof e=="object"&&!s(e)){if(i(e)){if(e.length<3)return e.length===1?[e[0],0,0]:[e[1],e[0]];if(e[2]===0)return[e[0]];if(e[2]===2)return[c(e[0]),0,2];throw new Error("invalid diff type")}r={};if(e._t==="a"){for(t in e)if(e.hasOwnProperty(t)&&t!=="_t"){var o,u=t;t.slice(0,1)==="_"?o=parseInt(t.slice(1),10):o=parseInt(t,10);if(i(e[t]))if(e[t].length===1)u="_"+o;else if(e[t].length===2)u=n.getArrayIndexBefore(e,o);else if(e[t][2]===0)u=o.toString();else{if(e[t][2]===3){u="_"+e[t][1],r[u]=[e[t][0],o,3];continue}u=n.getArrayIndexBefore(e,o)}else u=n.getArrayIndexBefore(e,o);r[u]=h(e[t])}r._t="a"}else for(t in e)e.hasOwnProperty(t)&&(r[t]=h(e[t]));return r}return typeof e=="string"&&e.slice(0,2)==="@@"?c(e):e},p=e.patch=function(s,o,u,a){var c,h,d="",v;typeof o!="string"?(a=u,u=o,o=null):typeof s!="object"&&(o=null),a&&(d+=a),d+="/",o!==null&&(d+=o);if(typeof u=="object")if(i(u)){if(u.length<3)return h=u[u.length-1],o!==null&&l(s,o,h),h;if(u[2]!==0){if(u[2]===2){e.config.textPatch||r();if(!e.config.textPatch)throw new Error("textPatch function not found");try{h=e.config.textPatch(f(s,o),u[0])}catch(m){throw new Error('cannot apply patch at "'+d+'": '+m)}return o!==null&&l(s,o,h),h}throw u[2]===3?new Error("Not implemented diff type: "+u[2]):new Error("invalid diff type: "+u[2])}if(o===null)return;l(s,o)}else if(u._t=="a"){v=o===null?s:f(s,o);if(typeof v!="object"||!i(v))throw new Error('cannot apply patch at "'+d+'": array expected');n.patch(v,u,t.patch,d)}else{v=o===null?s:f(s,o);if(typeof v!="object"||i(v))throw new Error('cannot apply patch at "'+d+'": object expected');for(c in u)u.hasOwnProperty(c)&&p(v,c,u[c],d)}return s},d=e.unpatch=function(e,t,n,r){return typeof t!="string"?p(e,h(t),n):p(e,t,h(n),r)};typeof require=="function"&&typeof exports=="object"&&typeof module=="object"?module.exports=e:typeof define=="function"&&define.amd?define(e):window.jsondiffpatch=e})();(function(){function require(path,parent,orig){var resolved=require.resolve(path);if(null==resolved){orig=orig||path;parent=parent||"root";var err=new Error('Failed to require "'+orig+'" from "'+parent+'"');err.path=orig;err.parent=parent;err.require=true;throw err}var module=require.modules[resolved];if(!module._resolving&&!module.exports){var mod={};mod.exports={};mod.client=mod.component=true;module._resolving=true;module.call(this,mod.exports,require.relative(resolved),mod);delete module._resolving;module.exports=mod.exports}return module.exports}require.modules={};require.aliases={};require.resolve=function(path){if(path.charAt(0)==="/")path=path.slice(1);var paths=[path,path+".js",path+".json",path+"/index.js",path+"/index.json"];for(var i=0;i<paths.length;i++){var path=paths[i];if(require.modules.hasOwnProperty(path))return path;if(require.aliases.hasOwnProperty(path))return require.aliases[path]}};require.normalize=function(curr,path){var segs=[];if("."!=path.charAt(0))return path;curr=curr.split("/");path=path.split("/");for(var i=0;i<path.length;++i){if(".."==path[i]){curr.pop()}else if("."!=path[i]&&""!=path[i]){segs.push(path[i])}}return curr.concat(segs).join("/")};require.register=function(path,definition){require.modules[path]=definition};require.alias=function(from,to){if(!require.modules.hasOwnProperty(from)){throw new Error('Failed to alias "'+from+'", it does not exist')}require.aliases[to]=from};require.relative=function(parent){var p=require.normalize(parent,"..");function lastIndexOf(arr,obj){var i=arr.length;while(i--){if(arr[i]===obj)return i}return-1}function localRequire(path){var resolved=localRequire.resolve(path);return require(resolved,parent,path)}localRequire.resolve=function(path){var c=path.charAt(0);if("/"==c)return path.slice(1);if("."==c)return require.normalize(p,path);var segs=parent.split("/");var i=lastIndexOf(segs,"deps")+1;if(!i)i=0;path=segs.slice(0,i+1).join("/")+"/deps/"+path;return path};localRequire.exists=function(path){return require.modules.hasOwnProperty(localRequire.resolve(path))};return localRequire};require.register("component-emitter/index.js",function(exports,require,module){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[event]=this._callbacks[event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){var self=this;this._callbacks=this._callbacks||{};function on(){self.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}});require.register("RedVentures-reduce/index.js",function(exports,require,module){module.exports=function(arr,fn,initial){var idx=0;var len=arr.length;var curr=arguments.length==3?initial:arr[idx++];while(idx<len){curr=fn.call(null,curr,arr[idx],++idx,arr)}return curr}});require.register("superagent/lib/client.js",function(exports,require,module){var Emitter=require("emitter");var reduce=require("reduce");var root="undefined"==typeof window?this:window;function noop(){}function isHost(obj){var str={}.toString.call(obj);switch(str){case"[object File]":case"[object Blob]":case"[object FormData]":return true;default:return false}}function getXHR(){if(root.XMLHttpRequest&&("file:"!=root.location.protocol||!root.ActiveXObject)){return new XMLHttpRequest}else{try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}}return false}var trim="".trim?function(s){return s.trim()}:function(s){return s.replace(/(^\s*|\s*$)/g,"")};function isObject(obj){return obj===Object(obj)}function serialize(obj){if(!isObject(obj))return obj;var pairs=[];for(var key in obj){if(null!=obj[key]){pairs.push(encodeURIComponent(key)+"="+encodeURIComponent(obj[key]))}}return pairs.join("&")}request.serializeObject=serialize;function parseString(str){var obj={};var pairs=str.split("&");var parts;var pair;for(var i=0,len=pairs.length;i<len;++i){pair=pairs[i];parts=pair.split("=");obj[decodeURIComponent(parts[0])]=decodeURIComponent(parts[1])}return obj}request.parseString=parseString;request.types={html:"text/html",json:"application/json",xml:"application/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"};request.serialize={"application/x-www-form-urlencoded":serialize,"application/json":JSON.stringify};request.parse={"application/x-www-form-urlencoded":parseString,"application/json":JSON.parse};function parseHeader(str){var lines=str.split(/\r?\n/);var fields={};var index;var line;var field;var val;lines.pop();for(var i=0,len=lines.length;i<len;++i){line=lines[i];index=line.indexOf(":");field=line.slice(0,index).toLowerCase();val=trim(line.slice(index+1));fields[field]=val}return fields}function type(str){return str.split(/ *; */).shift()}function params(str){return reduce(str.split(/ *; */),function(obj,str){var parts=str.split(/ *= */),key=parts.shift(),val=parts.shift();if(key&&val)obj[key]=val;return obj},{})}function Response(req,options){options=options||{};this.req=req;this.xhr=this.req.xhr;this.text=this.xhr.responseText;this.setStatusProperties(this.xhr.status);this.header=this.headers=parseHeader(this.xhr.getAllResponseHeaders());this.header["content-type"]=this.xhr.getResponseHeader("content-type");this.setHeaderProperties(this.header);this.body=this.req.method!="HEAD"?this.parseBody(this.text):null}Response.prototype.get=function(field){return this.header[field.toLowerCase()]};Response.prototype.setHeaderProperties=function(header){var ct=this.header["content-type"]||"";this.type=type(ct);var obj=params(ct);for(var key in obj)this[key]=obj[key]};Response.prototype.parseBody=function(str){var parse=request.parse[this.type];return parse?parse(str):null};Response.prototype.setStatusProperties=function(status){var type=status/100|0;this.status=status;this.statusType=type;this.info=1==type;this.ok=2==type;this.clientError=4==type;this.serverError=5==type;this.error=4==type||5==type?this.toError():false;this.accepted=202==status;this.noContent=204==status||1223==status;this.badRequest=400==status;this.unauthorized=401==status;this.notAcceptable=406==status;this.notFound=404==status;this.forbidden=403==status};Response.prototype.toError=function(){var req=this.req;var method=req.method;var path=req.path;var msg="cannot "+method+" "+path+" ("+this.status+")";var err=new Error(msg);err.status=this.status;err.method=method;err.path=path;return err};request.Response=Response;function Request(method,url){var self=this;Emitter.call(this);this._query=this._query||[];this.method=method;this.url=url;this.header={};this._header={};this.on("end",function(){var res=new Response(self);if("HEAD"==method)res.text=null;self.callback(null,res)})}Emitter(Request.prototype);Request.prototype.timeout=function(ms){this._timeout=ms;return this};Request.prototype.clearTimeout=function(){this._timeout=0;clearTimeout(this._timer);return this};Request.prototype.abort=function(){if(this.aborted)return;this.aborted=true;this.xhr.abort();this.clearTimeout();this.emit("abort");return this};Request.prototype.set=function(field,val){if(isObject(field)){for(var key in field){this.set(key,field[key])}return this}this._header[field.toLowerCase()]=val;this.header[field]=val;return this};Request.prototype.getHeader=function(field){return this._header[field.toLowerCase()]};Request.prototype.type=function(type){this.set("Content-Type",request.types[type]||type);return this};Request.prototype.accept=function(type){this.set("Accept",request.types[type]||type);return this};Request.prototype.auth=function(user,pass){var str=btoa(user+":"+pass);this.set("Authorization","Basic "+str);return this};Request.prototype.query=function(val){if("string"!=typeof val)val=serialize(val);if(val)this._query.push(val);return this};Request.prototype.send=function(data){var obj=isObject(data);var type=this.getHeader("Content-Type");if(obj&&isObject(this._data)){for(var key in data){this._data[key]=data[key]}}else if("string"==typeof data){if(!type)this.type("form");type=this.getHeader("Content-Type");if("application/x-www-form-urlencoded"==type){this._data=this._data?this._data+"&"+data:data}else{this._data=(this._data||"")+data}}else{this._data=data}if(!obj)return this;if(!type)this.type("json");return this};Request.prototype.callback=function(err,res){var fn=this._callback;if(2==fn.length)return fn(err,res);if(err)return this.emit("error",err);fn(res)};Request.prototype.crossDomainError=function(){var err=new Error("Origin is not allowed by Access-Control-Allow-Origin");err.crossDomain=true;this.callback(err)};Request.prototype.timeoutError=function(){var timeout=this._timeout;var err=new Error("timeout of "+timeout+"ms exceeded");err.timeout=timeout;this.callback(err)};Request.prototype.withCredentials=function(){this._withCredentials=true;return this};Request.prototype.end=function(fn){var self=this;var xhr=this.xhr=getXHR();var query=this._query.join("&");var timeout=this._timeout;var data=this._data;this._callback=fn||noop;xhr.onreadystatechange=function(){if(4!=xhr.readyState)return;if(0==xhr.status){if(self.aborted)return self.timeoutError();return self.crossDomainError()}self.emit("end")};if(xhr.upload){xhr.upload.onprogress=function(e){e.percent=e.loaded/e.total*100;self.emit("progress",e)}}if(timeout&&!this._timer){this._timer=setTimeout(function(){self.abort()},timeout)}if(query){query=request.serializeObject(query);this.url+=~this.url.indexOf("?")?"&"+query:"?"+query}xhr.open(this.method,this.url,true);if(this._withCredentials)xhr.withCredentials=true;if("GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof data&&!isHost(data)){var serialize=request.serialize[this.getHeader("Content-Type")];if(serialize)data=serialize(data)}for(var field in this.header){if(null==this.header[field])continue;xhr.setRequestHeader(field,this.header[field])}xhr.send(data);return this};request.Request=Request;function request(method,url){if("function"==typeof url){return new Request("GET",method).end(url)}if(1==arguments.length){return new Request("GET",method)}return new Request(method,url)}request.get=function(url,data,fn){var req=request("GET",url);if("function"==typeof data)fn=data,data=null;if(data)req.query(data);if(fn)req.end(fn);return req};request.head=function(url,data,fn){var req=request("HEAD",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};request.del=function(url,fn){var req=request("DELETE",url);if(fn)req.end(fn);return req};request.patch=function(url,data,fn){var req=request("PATCH",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};request.post=function(url,data,fn){var req=request("POST",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};request.put=function(url,data,fn){var req=request("PUT",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};module.exports=request});require.alias("component-emitter/index.js","superagent/deps/emitter/index.js");require.alias("component-emitter/index.js","emitter/index.js");require.alias("RedVentures-reduce/index.js","superagent/deps/reduce/index.js");require.alias("RedVentures-reduce/index.js","reduce/index.js");require.alias("superagent/lib/client.js","superagent/index.js");if(typeof exports=="object"){module.exports=require("superagent")}else if(typeof define=="function"&&define.amd){define(function(){return require("superagent")})}else{this["superagent"]=require("superagent")}})();"use strict";var sjcl={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(message){this.toString=function(){return"CORRUPT: "+this.message};this.message=message},invalid:function(message){this.toString=function(){return"INVALID: "+this.message};this.message=message},bug:function(message){this.toString=function(){return"BUG: "+this.message};this.message=message},notReady:function(message){this.toString=function(){return"NOT READY: "+this.message};this.message=message}}};if(typeof module!="undefined"&&module.exports){module.exports=sjcl}sjcl.cipher.aes=function(key){if(!this._tables[0][0][0]){this._precompute()}var i,j,tmp,encKey,decKey,sbox=this._tables[0][4],decTable=this._tables[1],keyLen=key.length,rcon=1;if(keyLen!==4&&keyLen!==6&&keyLen!==8){throw new sjcl.exception.invalid("invalid aes key size")}this._key=[encKey=key.slice(0),decKey=[]];for(i=keyLen;i<4*keyLen+28;i++){tmp=encKey[i-1];if(i%keyLen===0||keyLen===8&&i%keyLen===4){tmp=sbox[tmp>>>24]<<24^sbox[tmp>>16&255]<<16^sbox[tmp>>8&255]<<8^sbox[tmp&255];if(i%keyLen===0){tmp=tmp<<8^tmp>>>24^rcon<<24;rcon=rcon<<1^(rcon>>7)*283}}encKey[i]=encKey[i-keyLen]^tmp}for(j=0;i;j++,i--){tmp=encKey[j&3?i:i-4];if(i<=4||j<4){decKey[j]=tmp}else{decKey[j]=decTable[0][sbox[tmp>>>24]]^decTable[1][sbox[tmp>>16&255]]^decTable[2][sbox[tmp>>8&255]]^decTable[3][sbox[tmp&255]]}}};sjcl.cipher.aes.prototype={encrypt:function(data){return this._crypt(data,0)},decrypt:function(data){return this._crypt(data,1)},_tables:[[[],[],[],[],[]],[[],[],[],[],[]]],_precompute:function(){var encTable=this._tables[0],decTable=this._tables[1],sbox=encTable[4],sboxInv=decTable[4],i,x,xInv,d=[],th=[],x2,x4,x8,s,tEnc,tDec;
for(i=0;i<256;i++){th[(d[i]=i<<1^(i>>7)*283)^i]=i}for(x=xInv=0;!sbox[x];x^=x2||1,xInv=th[xInv]||1){s=xInv^xInv<<1^xInv<<2^xInv<<3^xInv<<4;s=s>>8^s&255^99;sbox[x]=s;sboxInv[s]=x;x8=d[x4=d[x2=d[x]]];tDec=x8*16843009^x4*65537^x2*257^x*16843008;tEnc=d[s]*257^s*16843008;for(i=0;i<4;i++){encTable[i][x]=tEnc=tEnc<<24^tEnc>>>8;decTable[i][s]=tDec=tDec<<24^tDec>>>8}}for(i=0;i<5;i++){encTable[i]=encTable[i].slice(0);decTable[i]=decTable[i].slice(0)}},_crypt:function(input,dir){if(input.length!==4){throw new sjcl.exception.invalid("invalid aes block size")}var key=this._key[dir],a=input[0]^key[0],b=input[dir?3:1]^key[1],c=input[2]^key[2],d=input[dir?1:3]^key[3],a2,b2,c2,nInnerRounds=key.length/4-2,i,kIndex=4,out=[0,0,0,0],table=this._tables[dir],t0=table[0],t1=table[1],t2=table[2],t3=table[3],sbox=table[4];for(i=0;i<nInnerRounds;i++){a2=t0[a>>>24]^t1[b>>16&255]^t2[c>>8&255]^t3[d&255]^key[kIndex];b2=t0[b>>>24]^t1[c>>16&255]^t2[d>>8&255]^t3[a&255]^key[kIndex+1];c2=t0[c>>>24]^t1[d>>16&255]^t2[a>>8&255]^t3[b&255]^key[kIndex+2];d=t0[d>>>24]^t1[a>>16&255]^t2[b>>8&255]^t3[c&255]^key[kIndex+3];kIndex+=4;a=a2;b=b2;c=c2}for(i=0;i<4;i++){out[dir?3&-i:i]=sbox[a>>>24]<<24^sbox[b>>16&255]<<16^sbox[c>>8&255]<<8^sbox[d&255]^key[kIndex++];a2=a;a=b;b=c;c=d;d=a2}return out}};sjcl.bitArray={bitSlice:function(a,bstart,bend){a=sjcl.bitArray._shiftRight(a.slice(bstart/32),32-(bstart&31)).slice(1);return bend===undefined?a:sjcl.bitArray.clamp(a,bend-bstart)},extract:function(a,bstart,blength){var x,sh=Math.floor(-bstart-blength&31);if((bstart+blength-1^bstart)&-32){x=a[bstart/32|0]<<32-sh^a[bstart/32+1|0]>>>sh}else{x=a[bstart/32|0]>>>sh}return x&(1<<blength)-1},concat:function(a1,a2){if(a1.length===0||a2.length===0){return a1.concat(a2)}var out,i,last=a1[a1.length-1],shift=sjcl.bitArray.getPartial(last);if(shift===32){return a1.concat(a2)}else{return sjcl.bitArray._shiftRight(a2,shift,last|0,a1.slice(0,a1.length-1))}},bitLength:function(a){var l=a.length,x;if(l===0){return 0}x=a[l-1];return(l-1)*32+sjcl.bitArray.getPartial(x)},clamp:function(a,len){if(a.length*32<len){return a}a=a.slice(0,Math.ceil(len/32));var l=a.length;len=len&31;if(l>0&&len){a[l-1]=sjcl.bitArray.partial(len,a[l-1]&2147483648>>len-1,1)}return a},partial:function(len,x,_end){if(len===32){return x}return(_end?x|0:x<<32-len)+len*1099511627776},getPartial:function(x){return Math.round(x/1099511627776)||32},equal:function(a,b){if(sjcl.bitArray.bitLength(a)!==sjcl.bitArray.bitLength(b)){return false}var x=0,i;for(i=0;i<a.length;i++){x|=a[i]^b[i]}return x===0},_shiftRight:function(a,shift,carry,out){var i,last2=0,shift2;if(out===undefined){out=[]}for(;shift>=32;shift-=32){out.push(carry);carry=0}if(shift===0){return out.concat(a)}for(i=0;i<a.length;i++){out.push(carry|a[i]>>>shift);carry=a[i]<<32-shift}last2=a.length?a[a.length-1]:0;shift2=sjcl.bitArray.getPartial(last2);out.push(sjcl.bitArray.partial(shift+shift2&31,shift+shift2>32?carry:out.pop(),1));return out},_xor4:function(x,y){return[x[0]^y[0],x[1]^y[1],x[2]^y[2],x[3]^y[3]]}};sjcl.codec.utf8String={fromBits:function(arr){var out="",bl=sjcl.bitArray.bitLength(arr),i,tmp;for(i=0;i<bl/8;i++){if((i&3)===0){tmp=arr[i/4]}out+=String.fromCharCode(tmp>>>24);tmp<<=8}return decodeURIComponent(escape(out))},toBits:function(str){str=unescape(encodeURIComponent(str));var out=[],i,tmp=0;for(i=0;i<str.length;i++){tmp=tmp<<8|str.charCodeAt(i);if((i&3)===3){out.push(tmp);tmp=0}}if(i&3){out.push(sjcl.bitArray.partial(8*(i&3),tmp))}return out}};sjcl.codec.base64={_chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(arr,_noEquals,_url){var out="",i,bits=0,c=sjcl.codec.base64._chars,ta=0,bl=sjcl.bitArray.bitLength(arr);if(_url)c=c.substr(0,62)+"-_";for(i=0;out.length*6<bl;){out+=c.charAt((ta^arr[i]>>>bits)>>>26);if(bits<6){ta=arr[i]<<6-bits;bits+=26;i++}else{ta<<=6;bits-=6}}while(out.length&3&&!_noEquals){out+="="}return out},toBits:function(str,_url){str=str.replace(/\s|=/g,"");var out=[],i,bits=0,c=sjcl.codec.base64._chars,ta=0,x;if(_url)c=c.substr(0,62)+"-_";for(i=0;i<str.length;i++){x=c.indexOf(str.charAt(i));if(x<0){throw new sjcl.exception.invalid("this isn't base64!")}if(bits>26){bits-=26;out.push(ta^x>>>bits);ta=x<<32-bits}else{bits+=6;ta^=x<<32-bits}}if(bits&56){out.push(sjcl.bitArray.partial(bits&56,ta,1))}return out}};sjcl.codec.base64url={fromBits:function(arr){return sjcl.codec.base64.fromBits(arr,1,1)},toBits:function(str){return sjcl.codec.base64.toBits(str,1)}};sjcl.hash.sha256=function(hash){if(!this._key[0]){this._precompute()}if(hash){this._h=hash._h.slice(0);this._buffer=hash._buffer.slice(0);this._length=hash._length}else{this.reset()}};sjcl.hash.sha256.hash=function(data){return(new sjcl.hash.sha256).update(data).finalize()};sjcl.hash.sha256.prototype={blockSize:512,reset:function(){this._h=this._init.slice(0);this._buffer=[];this._length=0;return this},update:function(data){if(typeof data==="string"){data=sjcl.codec.utf8String.toBits(data)}var i,b=this._buffer=sjcl.bitArray.concat(this._buffer,data),ol=this._length,nl=this._length=ol+sjcl.bitArray.bitLength(data);for(i=512+ol&-512;i<=nl;i+=512){this._block(b.splice(0,16))}return this},finalize:function(){var i,b=this._buffer,h=this._h;b=sjcl.bitArray.concat(b,[sjcl.bitArray.partial(1,1)]);for(i=b.length+2;i&15;i++){b.push(0)}b.push(Math.floor(this._length/4294967296));b.push(this._length|0);while(b.length){this._block(b.splice(0,16))}this.reset();return h},_init:[],_key:[],_precompute:function(){var i=0,prime=2,factor;function frac(x){return(x-Math.floor(x))*4294967296|0}outer:for(;i<64;prime++){for(factor=2;factor*factor<=prime;factor++){if(prime%factor===0){continue outer}}if(i<8){this._init[i]=frac(Math.pow(prime,1/2))}this._key[i]=frac(Math.pow(prime,1/3));i++}},_block:function(words){var i,tmp,a,b,w=words.slice(0),h=this._h,k=this._key,h0=h[0],h1=h[1],h2=h[2],h3=h[3],h4=h[4],h5=h[5],h6=h[6],h7=h[7];for(i=0;i<64;i++){if(i<16){tmp=w[i]}else{a=w[i+1&15];b=w[i+14&15];tmp=w[i&15]=(a>>>7^a>>>18^a>>>3^a<<25^a<<14)+(b>>>17^b>>>19^b>>>10^b<<15^b<<13)+w[i&15]+w[i+9&15]|0}tmp=tmp+h7+(h4>>>6^h4>>>11^h4>>>25^h4<<26^h4<<21^h4<<7)+(h6^h4&(h5^h6))+k[i];h7=h6;h6=h5;h5=h4;h4=h3+tmp|0;h3=h2;h2=h1;h1=h0;h0=tmp+(h1&h2^h3&(h1^h2))+(h1>>>2^h1>>>13^h1>>>22^h1<<30^h1<<19^h1<<10)|0}h[0]=h[0]+h0|0;h[1]=h[1]+h1|0;h[2]=h[2]+h2|0;h[3]=h[3]+h3|0;h[4]=h[4]+h4|0;h[5]=h[5]+h5|0;h[6]=h[6]+h6|0;h[7]=h[7]+h7|0}};sjcl.mode.gcm={name:"gcm",encrypt:function(prf,plaintext,iv,adata,tlen){var out,data=plaintext.slice(0),w=sjcl.bitArray;tlen=tlen||128;adata=adata||[];out=sjcl.mode.gcm._ctrMode(true,prf,data,adata,iv,tlen);return w.concat(out.data,out.tag)},decrypt:function(prf,ciphertext,iv,adata,tlen){var out,data=ciphertext.slice(0),tag,w=sjcl.bitArray,l=w.bitLength(data);tlen=tlen||128;adata=adata||[];if(tlen<=l){tag=w.bitSlice(data,l-tlen);data=w.bitSlice(data,0,l-tlen)}else{tag=data;data=[]}out=sjcl.mode.gcm._ctrMode(false,prf,data,adata,iv,tlen);if(!w.equal(out.tag,tag)){throw new sjcl.exception.corrupt("gcm: tag doesn't match")}return out.data},_galoisMultiply:function(x,y){var i,j,xi,Zi,Vi,lsb_Vi,w=sjcl.bitArray,xor=w._xor4;Zi=[0,0,0,0];Vi=y.slice(0);for(i=0;i<128;i++){xi=(x[Math.floor(i/32)]&1<<31-i%32)!==0;if(xi){Zi=xor(Zi,Vi)}lsb_Vi=(Vi[3]&1)!==0;for(j=3;j>0;j--){Vi[j]=Vi[j]>>>1|(Vi[j-1]&1)<<31}Vi[0]=Vi[0]>>>1;if(lsb_Vi){Vi[0]=Vi[0]^225<<24}}return Zi},_ghash:function(H,Y0,data){var Yi,i,l=data.length;Yi=Y0.slice(0);for(i=0;i<l;i+=4){Yi[0]^=4294967295&data[i];Yi[1]^=4294967295&data[i+1];Yi[2]^=4294967295&data[i+2];Yi[3]^=4294967295&data[i+3];Yi=sjcl.mode.gcm._galoisMultiply(Yi,H)}return Yi},_ctrMode:function(encrypt,prf,data,adata,iv,tlen){var H,J0,S0,enc,i,ctr,tag,last,l,bl,abl,ivbl,w=sjcl.bitArray,xor=w._xor4;l=data.length;bl=w.bitLength(data);abl=w.bitLength(adata);ivbl=w.bitLength(iv);H=prf.encrypt([0,0,0,0]);if(ivbl===96){J0=iv.slice(0);J0=w.concat(J0,[1])}else{J0=sjcl.mode.gcm._ghash(H,[0,0,0,0],iv);J0=sjcl.mode.gcm._ghash(H,J0,[0,0,Math.floor(ivbl/4294967296),ivbl&4294967295])}S0=sjcl.mode.gcm._ghash(H,[0,0,0,0],adata);ctr=J0.slice(0);tag=S0.slice(0);if(!encrypt){tag=sjcl.mode.gcm._ghash(H,S0,data)}for(i=0;i<l;i+=4){ctr[3]++;enc=prf.encrypt(ctr);data[i]^=enc[0];data[i+1]^=enc[1];data[i+2]^=enc[2];data[i+3]^=enc[3]}data=w.clamp(data,bl);if(encrypt){tag=sjcl.mode.gcm._ghash(H,S0,data)}last=[Math.floor(abl/4294967296),abl&4294967295,Math.floor(bl/4294967296),bl&4294967295];tag=sjcl.mode.gcm._ghash(H,tag,last);enc=prf.encrypt(J0);tag[0]^=enc[0];tag[1]^=enc[1];tag[2]^=enc[2];tag[3]^=enc[3];return{tag:w.bitSlice(tag,0,tlen),data:data}}};sjcl.misc.hmac=function(key,Hash){this._hash=Hash=Hash||sjcl.hash.sha256;var exKey=[[],[]],i,bs=Hash.prototype.blockSize/32;this._baseHash=[new Hash,new Hash];if(key.length>bs){key=Hash.hash(key)}for(i=0;i<bs;i++){exKey[0][i]=key[i]^909522486;exKey[1][i]=key[i]^1549556828}this._baseHash[0].update(exKey[0]);this._baseHash[1].update(exKey[1])};sjcl.misc.hmac.prototype.encrypt=sjcl.misc.hmac.prototype.mac=function(data,encoding){var w=new this._hash(this._baseHash[0]).update(data,encoding).finalize();return new this._hash(this._baseHash[1]).update(w).finalize()};sjcl.misc.pbkdf2=function(password,salt,count,length,Prff){count=count||1e3;if(length<0||count<0){throw sjcl.exception.invalid("invalid params to pbkdf2")}if(typeof password==="string"){password=sjcl.codec.utf8String.toBits(password)}Prff=Prff||sjcl.misc.hmac;var prf=new Prff(password),u,ui,i,j,k,out=[],b=sjcl.bitArray;for(k=1;32*out.length<(length||1);k++){u=ui=prf.encrypt(b.concat(salt,[k]));for(i=1;i<count;i++){ui=prf.encrypt(ui);for(j=0;j<ui.length;j++){u[j]^=ui[j]}}out=out.concat(u)}if(length){out=b.clamp(out,length)}return out};sjcl.random={randomWords:function(nwords,paranoia){var out=[],i,readiness=this.isReady(paranoia),g;if(readiness===this._NOT_READY){throw new sjcl.exception.notReady("generator isn't seeded")}else if(readiness&this._REQUIRES_RESEED){this._reseedFromPools(!(readiness&this._READY))}for(i=0;i<nwords;i+=4){if((i+1)%this._MAX_WORDS_PER_BURST===0){this._gate()}g=this._gen4words();out.push(g[0],g[1],g[2],g[3])}this._gate();return out.slice(0,nwords)},setDefaultParanoia:function(paranoia){this._defaultParanoia=paranoia},addEntropy:function(data,estimatedEntropy,source){source=source||"user";var id,i,tmp,t=(new Date).valueOf(),robin=this._robins[source],oldReady=this.isReady(),err=0;id=this._collectorIds[source];if(id===undefined){id=this._collectorIds[source]=this._collectorIdNext++}if(robin===undefined){robin=this._robins[source]=0}this._robins[source]=(this._robins[source]+1)%this._pools.length;switch(typeof data){case"number":if(estimatedEntropy===undefined){estimatedEntropy=1}this._pools[robin].update([id,this._eventId++,1,estimatedEntropy,t,1,data|0]);break;case"object":var objName=Object.prototype.toString.call(data);if(objName==="[object Uint32Array]"){tmp=[];for(i=0;i<data.length;i++){tmp.push(data[i])}data=tmp}else{if(objName!=="[object Array]"){err=1}for(i=0;i<data.length&&!err;i++){if(typeof data[i]!="number"){err=1}}}if(!err){if(estimatedEntropy===undefined){estimatedEntropy=0;for(i=0;i<data.length;i++){tmp=data[i];while(tmp>0){estimatedEntropy++;tmp=tmp>>>1}}}this._pools[robin].update([id,this._eventId++,2,estimatedEntropy,t,data.length].concat(data))}break;case"string":if(estimatedEntropy===undefined){estimatedEntropy=data.length}this._pools[robin].update([id,this._eventId++,3,estimatedEntropy,t,data.length]);this._pools[robin].update(data);break;default:err=1}if(err){throw new sjcl.exception.bug("random: addEntropy only supports number, array of numbers or string")}this._poolEntropy[robin]+=estimatedEntropy;this._poolStrength+=estimatedEntropy;if(oldReady===this._NOT_READY){if(this.isReady()!==this._NOT_READY){this._fireEvent("seeded",Math.max(this._strength,this._poolStrength))}this._fireEvent("progress",this.getProgress())}},isReady:function(paranoia){var entropyRequired=this._PARANOIA_LEVELS[paranoia!==undefined?paranoia:this._defaultParanoia];if(this._strength&&this._strength>=entropyRequired){return this._poolEntropy[0]>this._BITS_PER_RESEED&&(new Date).valueOf()>this._nextReseed?this._REQUIRES_RESEED|this._READY:this._READY}else{return this._poolStrength>=entropyRequired?this._REQUIRES_RESEED|this._NOT_READY:this._NOT_READY}},getProgress:function(paranoia){var entropyRequired=this._PARANOIA_LEVELS[paranoia?paranoia:this._defaultParanoia];if(this._strength>=entropyRequired){return 1}else{return this._poolStrength>entropyRequired?1:this._poolStrength/entropyRequired}},startCollectors:function(){if(this._collectorsStarted){return}if(window.addEventListener){window.addEventListener("load",this._loadTimeCollector,false);window.addEventListener("mousemove",this._mouseCollector,false)}else if(document.attachEvent){document.attachEvent("onload",this._loadTimeCollector);document.attachEvent("onmousemove",this._mouseCollector)}else{throw new sjcl.exception.bug("can't attach event")}this._collectorsStarted=true},stopCollectors:function(){if(!this._collectorsStarted){return}if(window.removeEventListener){window.removeEventListener("load",this._loadTimeCollector,false);window.removeEventListener("mousemove",this._mouseCollector,false)}else if(window.detachEvent){window.detachEvent("onload",this._loadTimeCollector);window.detachEvent("onmousemove",this._mouseCollector)}this._collectorsStarted=false},addEventListener:function(name,callback){this._callbacks[name][this._callbackI++]=callback},removeEventListener:function(name,cb){var i,j,cbs=this._callbacks[name],jsTemp=[];for(j in cbs){if(cbs.hasOwnProperty(j)&&cbs[j]===cb){jsTemp.push(j)}}for(i=0;i<jsTemp.length;i++){j=jsTemp[i];delete cbs[j]}},_pools:[new sjcl.hash.sha256],_poolEntropy:[0],_reseedCount:0,_robins:{},_eventId:0,_collectorIds:{},_collectorIdNext:0,_strength:0,_poolStrength:0,_nextReseed:0,_key:[0,0,0,0,0,0,0,0],_counter:[0,0,0,0],_cipher:undefined,_defaultParanoia:6,_collectorsStarted:false,_callbacks:{progress:{},seeded:{}},_callbackI:0,_NOT_READY:0,_READY:1,_REQUIRES_RESEED:2,_MAX_WORDS_PER_BURST:65536,_PARANOIA_LEVELS:[0,48,64,96,128,192,256,384,512,768,1024],_MILLISECONDS_PER_RESEED:3e4,_BITS_PER_RESEED:80,_gen4words:function(){for(var i=0;i<4;i++){this._counter[i]=this._counter[i]+1|0;if(this._counter[i]){break}}return this._cipher.encrypt(this._counter)},_gate:function(){this._key=this._gen4words().concat(this._gen4words());this._cipher=new sjcl.cipher.aes(this._key)},_reseed:function(seedWords){this._key=sjcl.hash.sha256.hash(this._key.concat(seedWords));this._cipher=new sjcl.cipher.aes(this._key);for(var i=0;i<4;i++){this._counter[i]=this._counter[i]+1|0;if(this._counter[i]){break}}},_reseedFromPools:function(full){var reseedData=[],strength=0,i;this._nextReseed=reseedData[0]=(new Date).valueOf()+this._MILLISECONDS_PER_RESEED;for(i=0;i<16;i++){reseedData.push(Math.random()*4294967296|0)}for(i=0;i<this._pools.length;i++){reseedData=reseedData.concat(this._pools[i].finalize());strength+=this._poolEntropy[i];this._poolEntropy[i]=0;if(!full&&this._reseedCount&1<<i){break}}if(this._reseedCount>=1<<this._pools.length){this._pools.push(new sjcl.hash.sha256);this._poolEntropy.push(0)}this._poolStrength-=strength;if(strength>this._strength){this._strength=strength}this._reseedCount++;this._reseed(reseedData)},_mouseCollector:function(ev){var x=ev.x||ev.clientX||ev.offsetX,y=ev.y||ev.clientY||ev.offsetY;sjcl.random.addEntropy([x,y],2,"mouse")},_loadTimeCollector:function(ev){sjcl.random.addEntropy((new Date).valueOf(),2,"loadtime")},_fireEvent:function(name,arg){var j,cbs=sjcl.random._callbacks[name],cbsTemp=[];for(j in cbs){if(cbs.hasOwnProperty(j)){cbsTemp.push(cbs[j])}}for(j=0;j<cbsTemp.length;j++){cbsTemp[j](arg)}}};(function(){try{var ab=new Uint32Array(32);crypto.getRandomValues(ab);sjcl.random.addEntropy(ab,1024,"crypto.getRandomValues")}catch(e){}})();sjcl.json={defaults:{v:1,iter:1e3,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},encrypt:function(password,plaintext,params,rp){params=params||{};rp=rp||{};var j=sjcl.json,p=j._add({iv:sjcl.random.randomWords(4,0)},j.defaults),tmp,prp,adata;j._add(p,params);adata=p.adata;if(typeof p.salt==="string"){p.salt=sjcl.codec.base64.toBits(p.salt)}if(typeof p.iv==="string"){p.iv=sjcl.codec.base64.toBits(p.iv)}if(!sjcl.mode[p.mode]||!sjcl.cipher[p.cipher]||typeof password==="string"&&p.iter<=100||p.ts!==64&&p.ts!==96&&p.ts!==128||p.ks!==128&&p.ks!==192&&p.ks!==256||(p.iv.length<2||p.iv.length>4)){throw new sjcl.exception.invalid("json encrypt: invalid parameters")}if(typeof password==="string"){tmp=sjcl.misc.cachedPbkdf2(password,p);password=tmp.key.slice(0,p.ks/32);p.salt=tmp.salt}else if(sjcl.ecc&&password instanceof sjcl.ecc.elGamal.publicKey){tmp=password.kem();p.kemtag=tmp.tag;password=tmp.key.slice(0,p.ks/32)}if(typeof plaintext==="string"){plaintext=sjcl.codec.utf8String.toBits(plaintext)}if(typeof adata==="string"){adata=sjcl.codec.utf8String.toBits(adata)}prp=new sjcl.cipher[p.cipher](password);j._add(rp,p);rp.key=password;p.ct=sjcl.mode[p.mode].encrypt(prp,plaintext,p.iv,adata,p.ts);return j.encode(p)},decrypt:function(password,ciphertext,params,rp){params=params||{};rp=rp||{};var j=sjcl.json,p=j._add(j._add(j._add({},j.defaults),j.decode(ciphertext)),params,true),ct,tmp,prp,adata=p.adata;if(typeof p.salt==="string"){p.salt=sjcl.codec.base64.toBits(p.salt)}if(typeof p.iv==="string"){p.iv=sjcl.codec.base64.toBits(p.iv)}if(!sjcl.mode[p.mode]||!sjcl.cipher[p.cipher]||typeof password==="string"&&p.iter<=100||p.ts!==64&&p.ts!==96&&p.ts!==128||p.ks!==128&&p.ks!==192&&p.ks!==256||!p.iv||(p.iv.length<2||p.iv.length>4)){throw new sjcl.exception.invalid("json decrypt: invalid parameters")}if(typeof password==="string"){tmp=sjcl.misc.cachedPbkdf2(password,p);password=tmp.key.slice(0,p.ks/32);p.salt=tmp.salt}else if(sjcl.ecc&&password instanceof sjcl.ecc.elGamal.secretKey){password=password.unkem(sjcl.codec.base64.toBits(p.kemtag)).slice(0,p.ks/32)}if(typeof adata==="string"){adata=sjcl.codec.utf8String.toBits(adata)}prp=new sjcl.cipher[p.cipher](password);ct=sjcl.mode[p.mode].decrypt(prp,p.ct,p.iv,adata,p.ts);j._add(rp,p);rp.key=password;return sjcl.codec.utf8String.fromBits(ct)},encode:function(obj){var i,out="{",comma="";for(i in obj){if(obj.hasOwnProperty(i)){if(!i.match(/^[a-z0-9]+$/i)){throw new sjcl.exception.invalid("json encode: invalid property name")}out+=comma+'"'+i+'":';comma=",";switch(typeof obj[i]){case"number":case"boolean":out+=obj[i];break;case"string":out+='"'+escape(obj[i])+'"';break;case"object":out+='"'+sjcl.codec.base64.fromBits(obj[i],1)+'"';break;default:throw new sjcl.exception.bug("json encode: unsupported type")}}}return out+"}"},decode:function(str){str=str.replace(/\s/g,"");if(!str.match(/^\{.*\}$/)){throw new sjcl.exception.invalid("json decode: this isn't json!")}var a=str.replace(/^\{|\}$/g,"").split(/,/),out={},i,m;for(i=0;i<a.length;i++){if(!(m=a[i].match(/^(?:(["']?)([a-z][a-z0-9]*)\1):(?:(\d+)|"([a-z0-9+\/%*_.@=\-]*)")$/i))){throw new sjcl.exception.invalid("json decode: this isn't json!")}if(m[3]){out[m[2]]=parseInt(m[3],10)}else{out[m[2]]=m[2].match(/^(ct|salt|iv)$/)?sjcl.codec.base64.toBits(m[4]):unescape(m[4])}}return out},_add:function(target,src,requireSame){if(target===undefined){target={}}if(src===undefined){return target}var i;for(i in src){if(src.hasOwnProperty(i)){if(requireSame&&target[i]!==undefined&&target[i]!==src[i]){throw new sjcl.exception.invalid("required parameter overridden")}target[i]=src[i]}}return target},_subtract:function(plus,minus){var out={},i;for(i in plus){if(plus.hasOwnProperty(i)&&plus[i]!==minus[i]){out[i]=plus[i]}}return out},_filter:function(src,filter){var out={},i;for(i=0;i<filter.length;i++){if(src[filter[i]]!==undefined){out[filter[i]]=src[filter[i]]}}return out}};sjcl.encrypt=sjcl.json.encrypt;sjcl.decrypt=sjcl.json.decrypt;sjcl.misc._pbkdf2Cache={};sjcl.misc.cachedPbkdf2=function(password,obj){var cache=sjcl.misc._pbkdf2Cache,c,cp,str,salt,iter;obj=obj||{};iter=obj.iter||1e3;cp=cache[password]=cache[password]||{};c=cp[iter]=cp[iter]||{firstSalt:obj.salt&&obj.salt.length?obj.salt.slice(0):sjcl.random.randomWords(2,0)};salt=obj.salt===undefined?c.firstSalt:obj.salt;c[salt]=c[salt]||sjcl.misc.pbkdf2(password,salt,obj.iter);return{key:c[salt].slice(0),salt:salt.slice(0)}};sjcl.bn=function(it){this.initWith(it)};sjcl.bn.prototype={radix:24,maxMul:8,_class:sjcl.bn,copy:function(){return new this._class(this)},initWith:function(it){var i=0,k,n,l;switch(typeof it){case"object":this.limbs=it.limbs.slice(0);break;case"number":this.limbs=[it];this.normalize();break;case"string":it=it.replace(/^0x/,"");this.limbs=[];k=this.radix/4;for(i=0;i<it.length;i+=k){this.limbs.push(parseInt(it.substring(Math.max(it.length-i-k,0),it.length-i),16))}break;default:this.limbs=[0]}return this},equals:function(that){if(typeof that==="number"){that=new this._class(that)}var difference=0,i;this.fullReduce();that.fullReduce();for(i=0;i<this.limbs.length||i<that.limbs.length;i++){difference|=this.getLimb(i)^that.getLimb(i)}return difference===0},getLimb:function(i){return i>=this.limbs.length?0:this.limbs[i]},greaterEquals:function(that){if(typeof that==="number"){that=new this._class(that)}var less=0,greater=0,i,a,b;i=Math.max(this.limbs.length,that.limbs.length)-1;for(;i>=0;i--){a=this.getLimb(i);b=that.getLimb(i);greater|=b-a&~less;less|=a-b&~greater}return(greater|~less)>>>31},toString:function(){this.fullReduce();var out="",i,s,l=this.limbs;for(i=0;i<this.limbs.length;i++){s=l[i].toString(16);while(i<this.limbs.length-1&&s.length<6){s="0"+s}out=s+out}return"0x"+out},addM:function(that){if(typeof that!=="object"){that=new this._class(that)}var i,l=this.limbs,ll=that.limbs;for(i=l.length;i<ll.length;i++){l[i]=0}for(i=0;i<ll.length;i++){l[i]+=ll[i]}return this},doubleM:function(){var i,carry=0,tmp,r=this.radix,m=this.radixMask,l=this.limbs;for(i=0;i<l.length;i++){tmp=l[i];tmp=tmp+tmp+carry;l[i]=tmp&m;carry=tmp>>r}if(carry){l.push(carry)}return this},halveM:function(){var i,carry=0,tmp,r=this.radix,l=this.limbs;for(i=l.length-1;i>=0;i--){tmp=l[i];l[i]=tmp+carry>>1;carry=(tmp&1)<<r}if(!l[l.length-1]){l.pop()}return this},subM:function(that){if(typeof that!=="object"){that=new this._class(that)}var i,l=this.limbs,ll=that.limbs;for(i=l.length;i<ll.length;i++){l[i]=0}for(i=0;i<ll.length;i++){l[i]-=ll[i]}return this},mod:function(that){that=new sjcl.bn(that).normalize();var out=new sjcl.bn(this).normalize(),ci=0;for(;out.greaterEquals(that);ci++){that.doubleM()}for(;ci>0;ci--){that.halveM();if(out.greaterEquals(that)){out.subM(that).normalize()}}return out.trim()},inverseMod:function(p){var a=new sjcl.bn(1),b=new sjcl.bn(0),x=new sjcl.bn(this),y=new sjcl.bn(p),tmp,i,nz=1;if(!(p.limbs[0]&1)){throw new sjcl.exception.invalid("inverseMod: p must be odd")}do{if(x.limbs[0]&1){if(!x.greaterEquals(y)){tmp=x;x=y;y=tmp;tmp=a;a=b;b=tmp}x.subM(y);x.normalize();if(!a.greaterEquals(b)){a.addM(p)}a.subM(b)}x.halveM();if(a.limbs[0]&1){a.addM(p)}a.normalize();a.halveM();for(i=nz=0;i<x.limbs.length;i++){nz|=x.limbs[i]}}while(nz);if(!y.equals(1)){throw new sjcl.exception.invalid("inverseMod: p and x must be relatively prime")}return b},add:function(that){return this.copy().addM(that)},sub:function(that){return this.copy().subM(that)},mul:function(that){if(typeof that==="number"){that=new this._class(that)}var i,j,a=this.limbs,b=that.limbs,al=a.length,bl=b.length,out=new this._class,c=out.limbs,ai,ii=this.maxMul;for(i=0;i<this.limbs.length+that.limbs.length+1;i++){c[i]=0}for(i=0;i<al;i++){ai=a[i];for(j=0;j<bl;j++){c[i+j]+=ai*b[j]}if(!--ii){ii=this.maxMul;out.cnormalize()}}return out.cnormalize().reduce()},square:function(){return this.mul(this)},power:function(l){if(typeof l==="number"){l=[l]}else if(l.limbs!==undefined){l=l.normalize().limbs}var i,j,out=new this._class(1),pow=this;for(i=0;i<l.length;i++){for(j=0;j<this.radix;j++){if(l[i]&1<<j){out=out.mul(pow)}pow=pow.square()}}return out},mulmod:function(that,N){return this.mod(N).mul(that.mod(N)).mod(N)},powermod:function(x,N){var result=new sjcl.bn(1),a=new sjcl.bn(this),k=new sjcl.bn(x);while(true){if(k.limbs[0]&1){result=result.mulmod(a,N)}k.halveM();if(k.equals(0)){break}a=a.mulmod(a,N)}return result.normalize().reduce()},trim:function(){var l=this.limbs,p;do{p=l.pop()}while(l.length&&p===0);l.push(p);return this},reduce:function(){return this},fullReduce:function(){return this.normalize()},normalize:function(){var carry=0,i,pv=this.placeVal,ipv=this.ipv,l,m,limbs=this.limbs,ll=limbs.length,mask=this.radixMask;for(i=0;i<ll||carry!==0&&carry!==-1;i++){l=(limbs[i]||0)+carry;m=limbs[i]=l&mask;carry=(l-m)*ipv}if(carry===-1){limbs[i-1]-=this.placeVal}return this},cnormalize:function(){var carry=0,i,ipv=this.ipv,l,m,limbs=this.limbs,ll=limbs.length,mask=this.radixMask;for(i=0;i<ll-1;i++){l=limbs[i]+carry;m=limbs[i]=l&mask;carry=(l-m)*ipv}limbs[i]+=carry;return this},toBits:function(len){this.fullReduce();len=len||this.exponent||this.limbs.length*this.radix;var i=Math.floor((len-1)/24),w=sjcl.bitArray,e=(len+7&-8)%this.radix||this.radix,out=[w.partial(e,this.getLimb(i))];for(i--;i>=0;i--){out=w.concat(out,[w.partial(this.radix,this.getLimb(i))])}return out},bitLength:function(){this.fullReduce();var out=this.radix*(this.limbs.length-1),b=this.limbs[this.limbs.length-1];for(;b;b>>=1){out++}return out+7&-8}};sjcl.bn.fromBits=function(bits){var Class=this,out=new Class,words=[],w=sjcl.bitArray,t=this.prototype,l=Math.min(this.bitLength||4294967296,w.bitLength(bits)),e=l%t.radix||t.radix;words[0]=w.extract(bits,0,e);for(;e<l;e+=t.radix){words.unshift(w.extract(bits,e,t.radix))}out.limbs=words;return out};sjcl.bn.prototype.ipv=1/(sjcl.bn.prototype.placeVal=Math.pow(2,sjcl.bn.prototype.radix));sjcl.bn.prototype.radixMask=(1<<sjcl.bn.prototype.radix)-1;sjcl.bn.pseudoMersennePrime=function(exponent,coeff){function p(it){this.initWith(it)}var ppr=p.prototype=new sjcl.bn,i,tmp,mo;mo=ppr.modOffset=Math.ceil(tmp=exponent/ppr.radix);ppr.exponent=exponent;ppr.offset=[];ppr.factor=[];ppr.minOffset=mo;ppr.fullMask=0;ppr.fullOffset=[];ppr.fullFactor=[];ppr.modulus=p.modulus=new sjcl.bn(Math.pow(2,exponent));ppr.fullMask=0|-Math.pow(2,exponent%ppr.radix);for(i=0;i<coeff.length;i++){ppr.offset[i]=Math.floor(coeff[i][0]/ppr.radix-tmp);ppr.fullOffset[i]=Math.ceil(coeff[i][0]/ppr.radix-tmp);ppr.factor[i]=coeff[i][1]*Math.pow(1/2,exponent-coeff[i][0]+ppr.offset[i]*ppr.radix);ppr.fullFactor[i]=coeff[i][1]*Math.pow(1/2,exponent-coeff[i][0]+ppr.fullOffset[i]*ppr.radix);ppr.modulus.addM(new sjcl.bn(Math.pow(2,coeff[i][0])*coeff[i][1]));ppr.minOffset=Math.min(ppr.minOffset,-ppr.offset[i])}ppr._class=p;ppr.modulus.cnormalize();ppr.reduce=function(){var i,k,l,mo=this.modOffset,limbs=this.limbs,aff,off=this.offset,ol=this.offset.length,fac=this.factor,ll;i=this.minOffset;while(limbs.length>mo){l=limbs.pop();ll=limbs.length;for(k=0;k<ol;k++){limbs[ll+off[k]]-=fac[k]*l}i--;if(!i){limbs.push(0);this.cnormalize();i=this.minOffset}}this.cnormalize();return this};ppr._strongReduce=ppr.fullMask===-1?ppr.reduce:function(){var limbs=this.limbs,i=limbs.length-1,k,l;this.reduce();if(i===this.modOffset-1){l=limbs[i]&this.fullMask;limbs[i]-=l;for(k=0;k<this.fullOffset.length;k++){limbs[i+this.fullOffset[k]]-=this.fullFactor[k]*l}this.normalize()}};ppr.fullReduce=function(){var greater,i;this._strongReduce();this.addM(this.modulus);this.addM(this.modulus);this.normalize();this._strongReduce();for(i=this.limbs.length;i<this.modOffset;i++){this.limbs[i]=0}greater=this.greaterEquals(this.modulus);for(i=0;i<this.limbs.length;i++){this.limbs[i]-=this.modulus.limbs[i]*greater}this.cnormalize();return this};ppr.inverse=function(){return this.power(this.modulus.sub(2))};p.fromBits=sjcl.bn.fromBits;return p};sjcl.bn.prime={p127:sjcl.bn.pseudoMersennePrime(127,[[0,-1]]),p25519:sjcl.bn.pseudoMersennePrime(255,[[0,-19]]),p192:sjcl.bn.pseudoMersennePrime(192,[[0,-1],[64,-1]]),p224:sjcl.bn.pseudoMersennePrime(224,[[0,1],[96,-1]]),p256:sjcl.bn.pseudoMersennePrime(256,[[0,-1],[96,1],[192,1],[224,-1]]),p384:sjcl.bn.pseudoMersennePrime(384,[[0,-1],[32,1],[96,-1],[128,-1]]),p521:sjcl.bn.pseudoMersennePrime(521,[[0,-1]])};sjcl.bn.random=function(modulus,paranoia){if(typeof modulus!=="object"){modulus=new sjcl.bn(modulus)}var words,i,l=modulus.limbs.length,m=modulus.limbs[l-1]+1,out=new sjcl.bn;while(true){do{words=sjcl.random.randomWords(l,paranoia);if(words[l-1]<0){words[l-1]+=4294967296}}while(Math.floor(words[l-1]/m)===Math.floor(4294967296/m));words[l-1]%=m;for(i=0;i<l-1;i++){words[i]&=modulus.radixMask}out.limbs=words;if(!out.greaterEquals(modulus)){return out}}};sjcl.ecc={};sjcl.ecc.point=function(curve,x,y){if(x===undefined){this.isIdentity=true}else{this.x=x;this.y=y;this.isIdentity=false}this.curve=curve};sjcl.ecc.point.prototype={toJac:function(){return new sjcl.ecc.pointJac(this.curve,this.x,this.y,new this.curve.field(1))},mult:function(k){return this.toJac().mult(k,this).toAffine()},mult2:function(k,k2,affine2){return this.toJac().mult2(k,this,k2,affine2).toAffine()},multiples:function(){var m,i,j;if(this._multiples===undefined){j=this.toJac().doubl();m=this._multiples=[new sjcl.ecc.point(this.curve),this,j.toAffine()];for(i=3;i<16;i++){j=j.add(this);m.push(j.toAffine())}}return this._multiples},isValid:function(){return this.y.square().equals(this.curve.b.add(this.x.mul(this.curve.a.add(this.x.square()))))},toBits:function(){return sjcl.bitArray.concat(this.x.toBits(),this.y.toBits())}};sjcl.ecc.pointJac=function(curve,x,y,z){if(x===undefined){this.isIdentity=true}else{this.x=x;this.y=y;this.z=z;this.isIdentity=false}this.curve=curve};sjcl.ecc.pointJac.prototype={add:function(T){var S=this,sz2,c,d,c2,x1,x2,x,y1,y2,y,z;if(S.curve!==T.curve){throw"sjcl.ecc.add(): Points must be on the same curve to add them!"}if(S.isIdentity){return T.toJac()}else if(T.isIdentity){return S}sz2=S.z.square();c=T.x.mul(sz2).subM(S.x);if(c.equals(0)){if(S.y.equals(T.y.mul(sz2.mul(S.z)))){return S.doubl()}else{return new sjcl.ecc.pointJac(S.curve)}}d=T.y.mul(sz2.mul(S.z)).subM(S.y);c2=c.square();x1=d.square();x2=c.square().mul(c).addM(S.x.add(S.x).mul(c2));x=x1.subM(x2);y1=S.x.mul(c2).subM(x).mul(d);y2=S.y.mul(c.square().mul(c));y=y1.subM(y2);z=S.z.mul(c);return new sjcl.ecc.pointJac(this.curve,x,y,z)},doubl:function(){if(this.isIdentity){return this}var y2=this.y.square(),a=y2.mul(this.x.mul(4)),b=y2.square().mul(8),z2=this.z.square(),c=this.x.sub(z2).mul(3).mul(this.x.add(z2)),x=c.square().subM(a).subM(a),y=a.sub(x).mul(c).subM(b),z=this.y.add(this.y).mul(this.z);return new sjcl.ecc.pointJac(this.curve,x,y,z)},toAffine:function(){if(this.isIdentity||this.z.equals(0)){return new sjcl.ecc.point(this.curve)}var zi=this.z.inverse(),zi2=zi.square();return new sjcl.ecc.point(this.curve,this.x.mul(zi2).fullReduce(),this.y.mul(zi2.mul(zi)).fullReduce())},mult:function(k,affine){if(typeof k==="number"){k=[k]}else if(k.limbs!==undefined){k=k.normalize().limbs}var i,j,out=new sjcl.ecc.point(this.curve).toJac(),multiples=affine.multiples();for(i=k.length-1;i>=0;i--){for(j=sjcl.bn.prototype.radix-4;j>=0;j-=4){out=out.doubl().doubl().doubl().doubl().add(multiples[k[i]>>j&15])}}return out},mult2:function(k1,affine,k2,affine2){if(typeof k1==="number"){k1=[k1]}else if(k1.limbs!==undefined){k1=k1.normalize().limbs}if(typeof k2==="number"){k2=[k2]}else if(k2.limbs!==undefined){k2=k2.normalize().limbs}var i,j,out=new sjcl.ecc.point(this.curve).toJac(),m1=affine.multiples(),m2=affine2.multiples(),l1,l2;for(i=Math.max(k1.length,k2.length)-1;i>=0;i--){l1=k1[i]|0;l2=k2[i]|0;for(j=sjcl.bn.prototype.radix-4;j>=0;j-=4){out=out.doubl().doubl().doubl().doubl().add(m1[l1>>j&15]).add(m2[l2>>j&15])}}return out},isValid:function(){var z2=this.z.square(),z4=z2.square(),z6=z4.mul(z2);return this.y.square().equals(this.curve.b.mul(z6).add(this.x.mul(this.curve.a.mul(z4).add(this.x.square()))))}};sjcl.ecc.curve=function(Field,pMinusR,a,b,x,y){this.field=Field;this.r=Field.prototype.modulus.sub(pMinusR);this.a=new Field(a);this.b=new Field(b);this.G=new sjcl.ecc.point(this,new Field(x),new Field(y))};sjcl.ecc.curve.prototype.fromBits=function(bits){var w=sjcl.bitArray,l=this.field.prototype.exponent+7&-8,p=new sjcl.ecc.point(this,this.field.fromBits(w.bitSlice(bits,0,l)),this.field.fromBits(w.bitSlice(bits,l,2*l)));
if(!p.isValid()){throw new sjcl.exception.corrupt("not on the curve!")}return p};sjcl.ecc.curves={c192:new sjcl.ecc.curve(sjcl.bn.prime.p192,"0x662107c8eb94364e4b2dd7ce",-3,"0x64210519e59c80e70fa7e9ab72243049feb8deecc146b9b1","0x188da80eb03090f67cbf20eb43a18800f4ff0afd82ff1012","0x07192b95ffc8da78631011ed6b24cdd573f977a11e794811"),c224:new sjcl.ecc.curve(sjcl.bn.prime.p224,"0xe95c1f470fc1ec22d6baa3a3d5c4",-3,"0xb4050a850c04b3abf54132565044b0b7d7bfd8ba270b39432355ffb4","0xb70e0cbd6bb4bf7f321390b94a03c1d356c21122343280d6115c1d21","0xbd376388b5f723fb4c22dfe6cd4375a05a07476444d5819985007e34"),c256:new sjcl.ecc.curve(sjcl.bn.prime.p256,"0x4319055358e8617b0c46353d039cdaae",-3,"0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b","0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296","0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),c384:new sjcl.ecc.curve(sjcl.bn.prime.p384,"0x389cb27e0bc8d21fa7e5f24cb74f58851313e696333ad68c",-3,"0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef","0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7","0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")};sjcl.ecc._dh=function(cn){sjcl.ecc[cn]={publicKey:function(curve_id,curve,point){this._curve=curve;if(point instanceof Array){this._point=curve.fromBits(point)}else{this._point=point}if(curve_id){this._curve_id=curve_id;this.serialize=function(){return{point:point.toBits(),curve:curve_id}}}},secretKey:function(curve_id,curve,exponent){this._curve=curve;this._exponent=exponent;if(curve_id){this._curve_id=curve_id;this.serialize=function(){return{exponent:exponent.toBits(),curve:curve_id}}}},generateKeys:function(curve,paranoia){var curve_id;if(curve===undefined){curve=256}if(typeof curve==="number"){curve_id=curve;curve=sjcl.ecc.curves["c"+curve];if(curve===undefined){throw new sjcl.exception.invalid("no such curve")}}var sec=sjcl.bn.random(curve.r,paranoia),pub=curve.G.mult(sec);return{pub:new sjcl.ecc[cn].publicKey(curve_id,curve,pub),sec:new sjcl.ecc[cn].secretKey(curve_id,curve,sec)}}}};sjcl.ecc._dh("elGamal");sjcl.ecc.elGamal.publicKey.prototype={kem:function(paranoia){var sec=sjcl.bn.random(this._curve.r,paranoia),tag=this._curve.G.mult(sec).toBits(),key=sjcl.hash.sha256.hash(this._point.mult(sec).toBits());return{key:key,tag:tag}}};sjcl.ecc.elGamal.secretKey.prototype={unkem:function(tag){return sjcl.hash.sha256.hash(this._curve.fromBits(tag).mult(this._exponent).toBits())},dh:function(pk){return sjcl.hash.sha256.hash(pk._point.mult(this._exponent).toBits())}};sjcl.ecc._dh("ecdsa");sjcl.ecc.ecdsa.secretKey.prototype={sign:function(hash,paranoia){var R=this._curve.r,l=R.bitLength(),k=sjcl.bn.random(R.sub(1),paranoia).add(1),r=this._curve.G.mult(k).x.mod(R),s=sjcl.bn.fromBits(hash).add(r.mul(this._exponent)).inverseMod(R).mul(k).mod(R);return sjcl.bitArray.concat(r.toBits(l),s.toBits(l))}};sjcl.ecc.ecdsa.publicKey.prototype={verify:function(hash,rs){var w=sjcl.bitArray,R=this._curve.r,l=R.bitLength(),r=sjcl.bn.fromBits(w.bitSlice(rs,0,l)),s=sjcl.bn.fromBits(w.bitSlice(rs,l,2*l)),hG=sjcl.bn.fromBits(hash).mul(s).mod(R),hA=r.mul(s).mod(R),r2=this._curve.G.mult2(hG,hA,this._point).x;if(r.equals(0)||s.equals(0)||r.greaterEquals(R)||s.greaterEquals(R)||!r2.equals(r)){throw new sjcl.exception.corrupt("signature didn't check out")}return true}};sjcl.codec.hex={fromBits:function(arr){var out="",i,x;for(i=0;i<arr.length;i++){out+=((arr[i]|0)+0xf00000000000).toString(16).substr(4)}return out.substr(0,sjcl.bitArray.bitLength(arr)/4)},toBits:function(str){var i,out=[],len;str=str.replace(/\s|0x/g,"");len=str.length;str=str+"00000000";for(i=0;i<str.length;i+=8){out.push(parseInt(str.substr(i,8),16)^0)}return sjcl.bitArray.clamp(out,len*4)}};var io="undefined"===typeof module?{}:module.exports;(function(){(function(exports,global){var io=exports;io.version="0.9.16";io.protocol=1;io.transports=[];io.j=[];io.sockets={};io.connect=function(host,details){var uri=io.util.parseUri(host),uuri,socket;if(global&&global.location){uri.protocol=uri.protocol||global.location.protocol.slice(0,-1);uri.host=uri.host||(global.document?global.document.domain:global.location.hostname);uri.port=uri.port||global.location.port}uuri=io.util.uniqueUri(uri);var options={host:uri.host,secure:"https"==uri.protocol,port:uri.port||("https"==uri.protocol?443:80),query:uri.query||""};io.util.merge(options,details);if(options["force new connection"]||!io.sockets[uuri]){socket=new io.Socket(options)}if(!options["force new connection"]&&socket){io.sockets[uuri]=socket}socket=socket||io.sockets[uuri];return socket.of(uri.path.length>1?uri.path:"")}})("object"===typeof module?module.exports:this.io={},this);(function(exports,global){var util=exports.util={};var re=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;var parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];util.parseUri=function(str){var m=re.exec(str||""),uri={},i=14;while(i--){uri[parts[i]]=m[i]||""}return uri};util.uniqueUri=function(uri){var protocol=uri.protocol,host=uri.host,port=uri.port;if("document"in global){host=host||document.domain;port=port||(protocol=="https"&&document.location.protocol!=="https:"?443:document.location.port)}else{host=host||"localhost";if(!port&&protocol=="https"){port=443}}return(protocol||"http")+"://"+host+":"+(port||80)};util.query=function(base,addition){var query=util.chunkQuery(base||""),components=[];util.merge(query,util.chunkQuery(addition||""));for(var part in query){if(query.hasOwnProperty(part)){components.push(part+"="+query[part])}}return components.length?"?"+components.join("&"):""};util.chunkQuery=function(qs){var query={},params=qs.split("&"),i=0,l=params.length,kv;for(;i<l;++i){kv=params[i].split("=");if(kv[0]){query[kv[0]]=kv[1]}}return query};var pageLoaded=false;util.load=function(fn){if("document"in global&&document.readyState==="complete"||pageLoaded){return fn()}util.on(global,"load",fn,false)};util.on=function(element,event,fn,capture){if(element.attachEvent){element.attachEvent("on"+event,fn)}else if(element.addEventListener){element.addEventListener(event,fn,capture)}};util.request=function(xdomain){if(xdomain&&"undefined"!=typeof XDomainRequest&&!util.ua.hasCORS){return new XDomainRequest}if("undefined"!=typeof XMLHttpRequest&&(!xdomain||util.ua.hasCORS)){return new XMLHttpRequest}if(!xdomain){try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}return null};if("undefined"!=typeof window){util.load(function(){pageLoaded=true})}util.defer=function(fn){if(!util.ua.webkit||"undefined"!=typeof importScripts){return fn()}util.load(function(){setTimeout(fn,100)})};util.merge=function merge(target,additional,deep,lastseen){var seen=lastseen||[],depth=typeof deep=="undefined"?2:deep,prop;for(prop in additional){if(additional.hasOwnProperty(prop)&&util.indexOf(seen,prop)<0){if(typeof target[prop]!=="object"||!depth){target[prop]=additional[prop];seen.push(additional[prop])}else{util.merge(target[prop],additional[prop],depth-1,seen)}}}return target};util.mixin=function(ctor,ctor2){util.merge(ctor.prototype,ctor2.prototype)};util.inherit=function(ctor,ctor2){function f(){}f.prototype=ctor2.prototype;ctor.prototype=new f};util.isArray=Array.isArray||function(obj){return Object.prototype.toString.call(obj)==="[object Array]"};util.intersect=function(arr,arr2){var ret=[],longest=arr.length>arr2.length?arr:arr2,shortest=arr.length>arr2.length?arr2:arr;for(var i=0,l=shortest.length;i<l;i++){if(~util.indexOf(longest,shortest[i]))ret.push(shortest[i])}return ret};util.indexOf=function(arr,o,i){for(var j=arr.length,i=i<0?i+j<0?0:i+j:i||0;i<j&&arr[i]!==o;i++){}return j<=i?-1:i};util.toArray=function(enu){var arr=[];for(var i=0,l=enu.length;i<l;i++)arr.push(enu[i]);return arr};util.ua={};util.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var a=new XMLHttpRequest}catch(e){return false}return a.withCredentials!=undefined}();util.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent);util.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)})("undefined"!=typeof io?io:module.exports,this);(function(exports,io){exports.EventEmitter=EventEmitter;function EventEmitter(){}EventEmitter.prototype.on=function(name,fn){if(!this.$events){this.$events={}}if(!this.$events[name]){this.$events[name]=fn}else if(io.util.isArray(this.$events[name])){this.$events[name].push(fn)}else{this.$events[name]=[this.$events[name],fn]}return this};EventEmitter.prototype.addListener=EventEmitter.prototype.on;EventEmitter.prototype.once=function(name,fn){var self=this;function on(){self.removeListener(name,on);fn.apply(this,arguments)}on.listener=fn;this.on(name,on);return this};EventEmitter.prototype.removeListener=function(name,fn){if(this.$events&&this.$events[name]){var list=this.$events[name];if(io.util.isArray(list)){var pos=-1;for(var i=0,l=list.length;i<l;i++){if(list[i]===fn||list[i].listener&&list[i].listener===fn){pos=i;break}}if(pos<0){return this}list.splice(pos,1);if(!list.length){delete this.$events[name]}}else if(list===fn||list.listener&&list.listener===fn){delete this.$events[name]}}return this};EventEmitter.prototype.removeAllListeners=function(name){if(name===undefined){this.$events={};return this}if(this.$events&&this.$events[name]){this.$events[name]=null}return this};EventEmitter.prototype.listeners=function(name){if(!this.$events){this.$events={}}if(!this.$events[name]){this.$events[name]=[]}if(!io.util.isArray(this.$events[name])){this.$events[name]=[this.$events[name]]}return this.$events[name]};EventEmitter.prototype.emit=function(name){if(!this.$events){return false}var handler=this.$events[name];if(!handler){return false}var args=Array.prototype.slice.call(arguments,1);if("function"==typeof handler){handler.apply(this,args)}else if(io.util.isArray(handler)){var listeners=handler.slice();for(var i=0,l=listeners.length;i<l;i++){listeners[i].apply(this,args)}}else{return false}return true}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);(function(exports,nativeJSON){"use strict";if(nativeJSON&&nativeJSON.parse){return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify}}var JSON=exports.JSON={};function f(n){return n<10?"0"+n:n}function date(d,key){return isFinite(d.valueOf())?d.getUTCFullYear()+"-"+f(d.getUTCMonth()+1)+"-"+f(d.getUTCDate())+"T"+f(d.getUTCHours())+":"+f(d.getUTCMinutes())+":"+f(d.getUTCSeconds())+"Z":null}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value instanceof Date){value=date(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else if(typeof space==="string"){indent=space}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})};JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}})("undefined"!=typeof io?io:module.exports,typeof JSON!=="undefined"?JSON:undefined);(function(exports,io){var parser=exports.parser={};var packets=parser.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"];var reasons=parser.reasons=["transport not supported","client not handshaken","unauthorized"];var advice=parser.advice=["reconnect"];var JSON=io.JSON,indexOf=io.util.indexOf;parser.encodePacket=function(packet){var type=indexOf(packets,packet.type),id=packet.id||"",endpoint=packet.endpoint||"",ack=packet.ack,data=null;switch(packet.type){case"error":var reason=packet.reason?indexOf(reasons,packet.reason):"",adv=packet.advice?indexOf(advice,packet.advice):"";if(reason!==""||adv!=="")data=reason+(adv!==""?"+"+adv:"");break;case"message":if(packet.data!=="")data=packet.data;break;case"event":var ev={name:packet.name};if(packet.args&&packet.args.length){ev.args=packet.args}data=JSON.stringify(ev);break;case"json":data=JSON.stringify(packet.data);break;case"connect":if(packet.qs)data=packet.qs;break;case"ack":data=packet.ackId+(packet.args&&packet.args.length?"+"+JSON.stringify(packet.args):"");break}var encoded=[type,id+(ack=="data"?"+":""),endpoint];if(data!==null&&data!==undefined)encoded.push(data);return encoded.join(":")};parser.encodePayload=function(packets){var decoded="";if(packets.length==1)return packets[0];for(var i=0,l=packets.length;i<l;i++){var packet=packets[i];decoded+="�"+packet.length+"�"+packets[i]}return decoded};var regexp=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;parser.decodePacket=function(data){var pieces=data.match(regexp);if(!pieces)return{};var id=pieces[2]||"",data=pieces[5]||"",packet={type:packets[pieces[1]],endpoint:pieces[4]||""};if(id){packet.id=id;if(pieces[3])packet.ack="data";else packet.ack=true}switch(packet.type){case"error":var pieces=data.split("+");packet.reason=reasons[pieces[0]]||"";packet.advice=advice[pieces[1]]||"";break;case"message":packet.data=data||"";break;case"event":try{var opts=JSON.parse(data);packet.name=opts.name;packet.args=opts.args}catch(e){}packet.args=packet.args||[];break;case"json":try{packet.data=JSON.parse(data)}catch(e){}break;case"connect":packet.qs=data||"";break;case"ack":var pieces=data.match(/^([0-9]+)(\+)?(.*)/);if(pieces){packet.ackId=pieces[1];packet.args=[];if(pieces[3]){try{packet.args=pieces[3]?JSON.parse(pieces[3]):[]}catch(e){}}}break;case"disconnect":case"heartbeat":break}return packet};parser.decodePayload=function(data){if(data.charAt(0)=="�"){var ret=[];for(var i=1,length="";i<data.length;i++){if(data.charAt(i)=="�"){ret.push(parser.decodePacket(data.substr(i+1).substr(0,length)));i+=Number(length)+1;length=""}else{length+=data.charAt(i)}}return ret}else{return[parser.decodePacket(data)]}}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);(function(exports,io){exports.Transport=Transport;function Transport(socket,sessid){this.socket=socket;this.sessid=sessid}io.util.mixin(Transport,io.EventEmitter);Transport.prototype.heartbeats=function(){return true};Transport.prototype.onData=function(data){this.clearCloseTimeout();if(this.socket.connected||this.socket.connecting||this.socket.reconnecting){this.setCloseTimeout()}if(data!==""){var msgs=io.parser.decodePayload(data);if(msgs&&msgs.length){for(var i=0,l=msgs.length;i<l;i++){this.onPacket(msgs[i])}}}return this};Transport.prototype.onPacket=function(packet){this.socket.setHeartbeatTimeout();if(packet.type=="heartbeat"){return this.onHeartbeat()}if(packet.type=="connect"&&packet.endpoint==""){this.onConnect()}if(packet.type=="error"&&packet.advice=="reconnect"){this.isOpen=false}this.socket.onPacket(packet);return this};Transport.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var self=this;this.closeTimeout=setTimeout(function(){self.onDisconnect()},this.socket.closeTimeout)}};Transport.prototype.onDisconnect=function(){if(this.isOpen)this.close();this.clearTimeouts();this.socket.onDisconnect();return this};Transport.prototype.onConnect=function(){this.socket.onConnect();return this};Transport.prototype.clearCloseTimeout=function(){if(this.closeTimeout){clearTimeout(this.closeTimeout);this.closeTimeout=null}};Transport.prototype.clearTimeouts=function(){this.clearCloseTimeout();if(this.reopenTimeout){clearTimeout(this.reopenTimeout)}};Transport.prototype.packet=function(packet){this.send(io.parser.encodePacket(packet))};Transport.prototype.onHeartbeat=function(heartbeat){this.packet({type:"heartbeat"})};Transport.prototype.onOpen=function(){this.isOpen=true;this.clearCloseTimeout();this.socket.onOpen()};Transport.prototype.onClose=function(){var self=this;this.isOpen=false;this.socket.onClose();this.onDisconnect()};Transport.prototype.prepareUrl=function(){var options=this.socket.options;return this.scheme()+"://"+options.host+":"+options.port+"/"+options.resource+"/"+io.protocol+"/"+this.name+"/"+this.sessid};Transport.prototype.ready=function(socket,fn){fn.call(this)}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);(function(exports,io,global){exports.Socket=Socket;function Socket(options){this.options={port:80,secure:false,document:"document"in global?document:false,resource:"socket.io",transports:io.transports,"connect timeout":1e4,"try multiple transports":true,reconnect:true,"reconnection delay":500,"reconnection limit":Infinity,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":false,"auto connect":true,"flash policy port":10843,manualFlush:false};io.util.merge(this.options,options);this.connected=false;this.open=false;this.connecting=false;this.reconnecting=false;this.namespaces={};this.buffer=[];this.doBuffer=false;if(this.options["sync disconnect on unload"]&&(!this.isXDomain()||io.util.ua.hasCORS)){var self=this;io.util.on(global,"beforeunload",function(){self.disconnectSync()},false)}if(this.options["auto connect"]){this.connect()}}io.util.mixin(Socket,io.EventEmitter);Socket.prototype.of=function(name){if(!this.namespaces[name]){this.namespaces[name]=new io.SocketNamespace(this,name);if(name!==""){this.namespaces[name].packet({type:"connect"})}}return this.namespaces[name]};Socket.prototype.publish=function(){this.emit.apply(this,arguments);var nsp;for(var i in this.namespaces){if(this.namespaces.hasOwnProperty(i)){nsp=this.of(i);nsp.$emit.apply(nsp,arguments)}}};function empty(){}Socket.prototype.handshake=function(fn){var self=this,options=this.options;function complete(data){if(data instanceof Error){self.connecting=false;self.onError(data.message)}else{fn.apply(null,data.split(":"))}}var url=["http"+(options.secure?"s":"")+":/",options.host+":"+options.port,options.resource,io.protocol,io.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!io.util.ua.hasCORS){var insertAt=document.getElementsByTagName("script")[0],script=document.createElement("script");script.src=url+"&jsonp="+io.j.length;insertAt.parentNode.insertBefore(script,insertAt);io.j.push(function(data){complete(data);script.parentNode.removeChild(script)})}else{var xhr=io.util.request();xhr.open("GET",url,true);if(this.isXDomain()){xhr.withCredentials=true}xhr.onreadystatechange=function(){if(xhr.readyState==4){xhr.onreadystatechange=empty;if(xhr.status==200){complete(xhr.responseText)}else if(xhr.status==403){self.onError(xhr.responseText)}else{self.connecting=false;!self.reconnecting&&self.onError(xhr.responseText)}}};xhr.send(null)}};Socket.prototype.getTransport=function(override){var transports=override||this.transports,match;for(var i=0,transport;transport=transports[i];i++){if(io.Transport[transport]&&io.Transport[transport].check(this)&&(!this.isXDomain()||io.Transport[transport].xdomainCheck(this))){return new io.Transport[transport](this,this.sessionid)}}return null};Socket.prototype.connect=function(fn){if(this.connecting){return this}var self=this;self.connecting=true;this.handshake(function(sid,heartbeat,close,transports){self.sessionid=sid;self.closeTimeout=close*1e3;self.heartbeatTimeout=heartbeat*1e3;if(!self.transports)self.transports=self.origTransports=transports?io.util.intersect(transports.split(","),self.options.transports):self.options.transports;self.setHeartbeatTimeout();function connect(transports){if(self.transport)self.transport.clearTimeouts();self.transport=self.getTransport(transports);if(!self.transport)return self.publish("connect_failed");self.transport.ready(self,function(){self.connecting=true;self.publish("connecting",self.transport.name);self.transport.open();if(self.options["connect timeout"]){self.connectTimeoutTimer=setTimeout(function(){if(!self.connected){self.connecting=false;if(self.options["try multiple transports"]){var remaining=self.transports;while(remaining.length>0&&remaining.splice(0,1)[0]!=self.transport.name){}if(remaining.length){connect(remaining)}else{self.publish("connect_failed")}}}},self.options["connect timeout"])}})}connect(self.transports);self.once("connect",function(){clearTimeout(self.connectTimeoutTimer);fn&&typeof fn=="function"&&fn()})});return this};Socket.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);if(this.transport&&!this.transport.heartbeats())return;var self=this;this.heartbeatTimeoutTimer=setTimeout(function(){self.transport.onClose()},this.heartbeatTimeout)};Socket.prototype.packet=function(data){if(this.connected&&!this.doBuffer){this.transport.packet(data)}else{this.buffer.push(data)}return this};Socket.prototype.setBuffer=function(v){this.doBuffer=v;if(!v&&this.connected&&this.buffer.length){if(!this.options["manualFlush"]){this.flushBuffer()}}};Socket.prototype.flushBuffer=function(){this.transport.payload(this.buffer);this.buffer=[]};Socket.prototype.disconnect=function(){if(this.connected||this.connecting){if(this.open){this.of("").packet({type:"disconnect"})}this.onDisconnect("booted")}return this};Socket.prototype.disconnectSync=function(){var xhr=io.util.request();var uri=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,io.protocol,"",this.sessionid].join("/")+"/?disconnect=1";xhr.open("GET",uri,false);xhr.send(null);this.onDisconnect("booted")};Socket.prototype.isXDomain=function(){var port=global.location.port||("https:"==global.location.protocol?443:80);return this.options.host!==global.location.hostname||this.options.port!=port};Socket.prototype.onConnect=function(){if(!this.connected){this.connected=true;this.connecting=false;if(!this.doBuffer){this.setBuffer(false)}this.emit("connect")}};Socket.prototype.onOpen=function(){this.open=true};Socket.prototype.onClose=function(){this.open=false;clearTimeout(this.heartbeatTimeoutTimer)};Socket.prototype.onPacket=function(packet){this.of(packet.endpoint).onPacket(packet)};Socket.prototype.onError=function(err){if(err&&err.advice){if(err.advice==="reconnect"&&(this.connected||this.connecting)){this.disconnect();if(this.options.reconnect){this.reconnect()}}}this.publish("error",err&&err.reason?err.reason:err)};Socket.prototype.onDisconnect=function(reason){var wasConnected=this.connected,wasConnecting=this.connecting;this.connected=false;this.connecting=false;this.open=false;if(wasConnected||wasConnecting){this.transport.close();this.transport.clearTimeouts();if(wasConnected){this.publish("disconnect",reason);if("booted"!=reason&&this.options.reconnect&&!this.reconnecting){this.reconnect()}}}};Socket.prototype.reconnect=function(){this.reconnecting=true;this.reconnectionAttempts=0;this.reconnectionDelay=this.options["reconnection delay"];var self=this,maxAttempts=this.options["max reconnection attempts"],tryMultiple=this.options["try multiple transports"],limit=this.options["reconnection limit"];function reset(){if(self.connected){for(var i in self.namespaces){if(self.namespaces.hasOwnProperty(i)&&""!==i){self.namespaces[i].packet({type:"connect"})}}self.publish("reconnect",self.transport.name,self.reconnectionAttempts)}clearTimeout(self.reconnectionTimer);self.removeListener("connect_failed",maybeReconnect);self.removeListener("connect",maybeReconnect);self.reconnecting=false;delete self.reconnectionAttempts;delete self.reconnectionDelay;delete self.reconnectionTimer;delete self.redoTransports;self.options["try multiple transports"]=tryMultiple}function maybeReconnect(){if(!self.reconnecting){return}if(self.connected){return reset()}if(self.connecting&&self.reconnecting){return self.reconnectionTimer=setTimeout(maybeReconnect,1e3)}if(self.reconnectionAttempts++>=maxAttempts){if(!self.redoTransports){self.on("connect_failed",maybeReconnect);self.options["try multiple transports"]=true;self.transports=self.origTransports;self.transport=self.getTransport();self.redoTransports=true;self.connect()}else{self.publish("reconnect_failed");reset()}}else{if(self.reconnectionDelay<limit){self.reconnectionDelay*=2}self.connect();self.publish("reconnecting",self.reconnectionDelay,self.reconnectionAttempts);self.reconnectionTimer=setTimeout(maybeReconnect,self.reconnectionDelay)}}this.options["try multiple transports"]=false;this.reconnectionTimer=setTimeout(maybeReconnect,this.reconnectionDelay);this.on("connect",maybeReconnect)}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);(function(exports,io){exports.SocketNamespace=SocketNamespace;function SocketNamespace(socket,name){this.socket=socket;this.name=name||"";this.flags={};this.json=new Flag(this,"json");this.ackPackets=0;this.acks={}}io.util.mixin(SocketNamespace,io.EventEmitter);SocketNamespace.prototype.$emit=io.EventEmitter.prototype.emit;SocketNamespace.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)};SocketNamespace.prototype.packet=function(packet){packet.endpoint=this.name;this.socket.packet(packet);this.flags={};return this};SocketNamespace.prototype.send=function(data,fn){var packet={type:this.flags.json?"json":"message",data:data};if("function"==typeof fn){packet.id=++this.ackPackets;packet.ack=true;this.acks[packet.id]=fn}return this.packet(packet)};SocketNamespace.prototype.emit=function(name){var args=Array.prototype.slice.call(arguments,1),lastArg=args[args.length-1],packet={type:"event",name:name};if("function"==typeof lastArg){packet.id=++this.ackPackets;packet.ack="data";this.acks[packet.id]=lastArg;args=args.slice(0,args.length-1)}packet.args=args;return this.packet(packet)};SocketNamespace.prototype.disconnect=function(){if(this.name===""){this.socket.disconnect()}else{this.packet({type:"disconnect"});this.$emit("disconnect")}return this};SocketNamespace.prototype.onPacket=function(packet){var self=this;function ack(){self.packet({type:"ack",args:io.util.toArray(arguments),ackId:packet.id})}switch(packet.type){case"connect":this.$emit("connect");break;case"disconnect":if(this.name===""){this.socket.onDisconnect(packet.reason||"booted")}else{this.$emit("disconnect",packet.reason)}break;case"message":case"json":var params=["message",packet.data];if(packet.ack=="data"){params.push(ack)}else if(packet.ack){this.packet({type:"ack",ackId:packet.id})}this.$emit.apply(this,params);break;case"event":var params=[packet.name].concat(packet.args);if(packet.ack=="data")params.push(ack);this.$emit.apply(this,params);break;case"ack":if(this.acks[packet.ackId]){this.acks[packet.ackId].apply(this,packet.args);delete this.acks[packet.ackId]}break;case"error":if(packet.advice){this.socket.onError(packet)}else{if(packet.reason=="unauthorized"){this.$emit("connect_failed",packet.reason)}else{this.$emit("error",packet.reason)}}break}};function Flag(nsp,name){this.namespace=nsp;this.name=name}Flag.prototype.send=function(){this.namespace.flags[this.name]=true;this.namespace.send.apply(this.namespace,arguments)};Flag.prototype.emit=function(){this.namespace.flags[this.name]=true;this.namespace.emit.apply(this.namespace,arguments)}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);(function(exports,io,global){exports.websocket=WS;function WS(socket){io.Transport.apply(this,arguments)}io.util.inherit(WS,io.Transport);WS.prototype.name="websocket";WS.prototype.open=function(){var query=io.util.query(this.socket.options.query),self=this,Socket;if(!Socket){Socket=global.MozWebSocket||global.WebSocket}this.websocket=new Socket(this.prepareUrl()+query);this.websocket.onopen=function(){self.onOpen();self.socket.setBuffer(false)};this.websocket.onmessage=function(ev){self.onData(ev.data)};this.websocket.onclose=function(){self.onClose();self.socket.setBuffer(true)};this.websocket.onerror=function(e){self.onError(e)};return this};if(io.util.ua.iDevice){WS.prototype.send=function(data){var self=this;setTimeout(function(){self.websocket.send(data)},0);return this}}else{WS.prototype.send=function(data){this.websocket.send(data);return this}}WS.prototype.payload=function(arr){for(var i=0,l=arr.length;i<l;i++){this.packet(arr[i])}return this};WS.prototype.close=function(){this.websocket.close();return this};WS.prototype.onError=function(e){this.socket.onError(e)};WS.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"};WS.check=function(){return"WebSocket"in global&&!("__addTask"in WebSocket)||"MozWebSocket"in global};WS.xdomainCheck=function(){return true};io.transports.push("websocket")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);(function(exports,io){exports.flashsocket=Flashsocket;function Flashsocket(){io.Transport.websocket.apply(this,arguments)}io.util.inherit(Flashsocket,io.Transport.websocket);Flashsocket.prototype.name="flashsocket";Flashsocket.prototype.open=function(){var self=this,args=arguments;WebSocket.__addTask(function(){io.Transport.websocket.prototype.open.apply(self,args)});return this};Flashsocket.prototype.send=function(){var self=this,args=arguments;WebSocket.__addTask(function(){io.Transport.websocket.prototype.send.apply(self,args)});return this};Flashsocket.prototype.close=function(){WebSocket.__tasks.length=0;io.Transport.websocket.prototype.close.call(this);return this};Flashsocket.prototype.ready=function(socket,fn){function init(){var options=socket.options,port=options["flash policy port"],path=["http"+(options.secure?"s":"")+":/",options.host+":"+options.port,options.resource,"static/flashsocket","WebSocketMain"+(socket.isXDomain()?"Insecure":"")+".swf"];
if(!Flashsocket.loaded){if(typeof WEB_SOCKET_SWF_LOCATION==="undefined"){WEB_SOCKET_SWF_LOCATION=path.join("/")}if(port!==843){WebSocket.loadFlashPolicyFile("xmlsocket://"+options.host+":"+port)}WebSocket.__initialize();Flashsocket.loaded=true}fn.call(self)}var self=this;if(document.body)return init();io.util.load(init)};Flashsocket.check=function(){if(typeof WebSocket=="undefined"||!("__initialize"in WebSocket)||!swfobject)return false;return swfobject.getFlashPlayerVersion().major>=10};Flashsocket.xdomainCheck=function(){return true};if(typeof window!="undefined"){WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=true}io.transports.push("flashsocket")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports);if("undefined"!=typeof window){var swfobject=function(){var D="undefined",r="object",S="Shockwave Flash",W="ShockwaveFlash.ShockwaveFlash",q="application/x-shockwave-flash",R="SWFObjectExprInst",x="onreadystatechange",O=window,j=document,t=navigator,T=false,U=[h],o=[],N=[],I=[],l,Q,E,B,J=false,a=false,n,G,m=true,M=function(){var aa=typeof j.getElementById!=D&&typeof j.getElementsByTagName!=D&&typeof j.createElement!=D,ah=t.userAgent.toLowerCase(),Y=t.platform.toLowerCase(),ae=Y?/win/.test(Y):/win/.test(ah),ac=Y?/mac/.test(Y):/mac/.test(ah),af=/webkit/.test(ah)?parseFloat(ah.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,X=!+"1",ag=[0,0,0],ab=null;if(typeof t.plugins!=D&&typeof t.plugins[S]==r){ab=t.plugins[S].description;if(ab&&!(typeof t.mimeTypes!=D&&t.mimeTypes[q]&&!t.mimeTypes[q].enabledPlugin)){T=true;X=false;ab=ab.replace(/^.*\s+(\S+\s+\S+$)/,"$1");ag[0]=parseInt(ab.replace(/^(.*)\..*$/,"$1"),10);ag[1]=parseInt(ab.replace(/^.*\.(.*)\s.*$/,"$1"),10);ag[2]=/[a-zA-Z]/.test(ab)?parseInt(ab.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof O[["Active"].concat("Object").join("X")]!=D){try{var ad=new(window[["Active"].concat("Object").join("X")])(W);if(ad){ab=ad.GetVariable("$version");if(ab){X=true;ab=ab.split(" ")[1].split(",");ag=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}}catch(Z){}}}return{w3:aa,pv:ag,wk:af,ie:X,win:ae,mac:ac}}(),k=function(){if(!M.w3){return}if(typeof j.readyState!=D&&j.readyState=="complete"||typeof j.readyState==D&&(j.getElementsByTagName("body")[0]||j.body)){f()}if(!J){if(typeof j.addEventListener!=D){j.addEventListener("DOMContentLoaded",f,false)}if(M.ie&&M.win){j.attachEvent(x,function(){if(j.readyState=="complete"){j.detachEvent(x,arguments.callee);f()}});if(O==top){(function(){if(J){return}try{j.documentElement.doScroll("left")}catch(X){setTimeout(arguments.callee,0);return}f()})()}}if(M.wk){(function(){if(J){return}if(!/loaded|complete/.test(j.readyState)){setTimeout(arguments.callee,0);return}f()})()}s(f)}}();function f(){if(J){return}try{var Z=j.getElementsByTagName("body")[0].appendChild(C("span"));Z.parentNode.removeChild(Z)}catch(aa){return}J=true;var X=U.length;for(var Y=0;Y<X;Y++){U[Y]()}}function K(X){if(J){X()}else{U[U.length]=X}}function s(Y){if(typeof O.addEventListener!=D){O.addEventListener("load",Y,false)}else{if(typeof j.addEventListener!=D){j.addEventListener("load",Y,false)}else{if(typeof O.attachEvent!=D){i(O,"onload",Y)}else{if(typeof O.onload=="function"){var X=O.onload;O.onload=function(){X();Y()}}else{O.onload=Y}}}}}function h(){if(T){V()}else{H()}}function V(){var X=j.getElementsByTagName("body")[0];var aa=C(r);aa.setAttribute("type",q);var Z=X.appendChild(aa);if(Z){var Y=0;(function(){if(typeof Z.GetVariable!=D){var ab=Z.GetVariable("$version");if(ab){ab=ab.split(" ")[1].split(",");M.pv=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}else{if(Y<10){Y++;setTimeout(arguments.callee,10);return}}X.removeChild(aa);Z=null;H()})()}else{H()}}function H(){var ag=o.length;if(ag>0){for(var af=0;af<ag;af++){var Y=o[af].id;var ab=o[af].callbackFn;var aa={success:false,id:Y};if(M.pv[0]>0){var ae=c(Y);if(ae){if(F(o[af].swfVersion)&&!(M.wk&&M.wk<312)){w(Y,true);if(ab){aa.success=true;aa.ref=z(Y);ab(aa)}}else{if(o[af].expressInstall&&A()){var ai={};ai.data=o[af].expressInstall;ai.width=ae.getAttribute("width")||"0";ai.height=ae.getAttribute("height")||"0";if(ae.getAttribute("class")){ai.styleclass=ae.getAttribute("class")}if(ae.getAttribute("align")){ai.align=ae.getAttribute("align")}var ah={};var X=ae.getElementsByTagName("param");var ac=X.length;for(var ad=0;ad<ac;ad++){if(X[ad].getAttribute("name").toLowerCase()!="movie"){ah[X[ad].getAttribute("name")]=X[ad].getAttribute("value")}}P(ai,ah,Y,ab)}else{p(ae);if(ab){ab(aa)}}}}}else{w(Y,true);if(ab){var Z=z(Y);if(Z&&typeof Z.SetVariable!=D){aa.success=true;aa.ref=Z}ab(aa)}}}}}function z(aa){var X=null;var Y=c(aa);if(Y&&Y.nodeName=="OBJECT"){if(typeof Y.SetVariable!=D){X=Y}else{var Z=Y.getElementsByTagName(r)[0];if(Z){X=Z}}}return X}function A(){return!a&&F("6.0.65")&&(M.win||M.mac)&&!(M.wk&&M.wk<312)}function P(aa,ab,X,Z){a=true;E=Z||null;B={success:false,id:X};var ae=c(X);if(ae){if(ae.nodeName=="OBJECT"){l=g(ae);Q=null}else{l=ae;Q=X}aa.id=R;if(typeof aa.width==D||!/%$/.test(aa.width)&&parseInt(aa.width,10)<310){aa.width="310"}if(typeof aa.height==D||!/%$/.test(aa.height)&&parseInt(aa.height,10)<137){aa.height="137"}j.title=j.title.slice(0,47)+" - Flash Player Installation";var ad=M.ie&&M.win?["Active"].concat("").join("X"):"PlugIn",ac="MMredirectURL="+O.location.toString().replace(/&/g,"%26")+"&MMplayerType="+ad+"&MMdoctitle="+j.title;if(typeof ab.flashvars!=D){ab.flashvars+="&"+ac}else{ab.flashvars=ac}if(M.ie&&M.win&&ae.readyState!=4){var Y=C("div");X+="SWFObjectNew";Y.setAttribute("id",X);ae.parentNode.insertBefore(Y,ae);ae.style.display="none";(function(){if(ae.readyState==4){ae.parentNode.removeChild(ae)}else{setTimeout(arguments.callee,10)}})()}u(aa,ab,X)}}function p(Y){if(M.ie&&M.win&&Y.readyState!=4){var X=C("div");Y.parentNode.insertBefore(X,Y);X.parentNode.replaceChild(g(Y),X);Y.style.display="none";(function(){if(Y.readyState==4){Y.parentNode.removeChild(Y)}else{setTimeout(arguments.callee,10)}})()}else{Y.parentNode.replaceChild(g(Y),Y)}}function g(ab){var aa=C("div");if(M.win&&M.ie){aa.innerHTML=ab.innerHTML}else{var Y=ab.getElementsByTagName(r)[0];if(Y){var ad=Y.childNodes;if(ad){var X=ad.length;for(var Z=0;Z<X;Z++){if(!(ad[Z].nodeType==1&&ad[Z].nodeName=="PARAM")&&!(ad[Z].nodeType==8)){aa.appendChild(ad[Z].cloneNode(true))}}}}}return aa}function u(ai,ag,Y){var X,aa=c(Y);if(M.wk&&M.wk<312){return X}if(aa){if(typeof ai.id==D){ai.id=Y}if(M.ie&&M.win){var ah="";for(var ae in ai){if(ai[ae]!=Object.prototype[ae]){if(ae.toLowerCase()=="data"){ag.movie=ai[ae]}else{if(ae.toLowerCase()=="styleclass"){ah+=' class="'+ai[ae]+'"'}else{if(ae.toLowerCase()!="classid"){ah+=" "+ae+'="'+ai[ae]+'"'}}}}}var af="";for(var ad in ag){if(ag[ad]!=Object.prototype[ad]){af+='<param name="'+ad+'" value="'+ag[ad]+'" />'}}aa.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+ah+">"+af+"</object>";N[N.length]=ai.id;X=c(ai.id)}else{var Z=C(r);Z.setAttribute("type",q);for(var ac in ai){if(ai[ac]!=Object.prototype[ac]){if(ac.toLowerCase()=="styleclass"){Z.setAttribute("class",ai[ac])}else{if(ac.toLowerCase()!="classid"){Z.setAttribute(ac,ai[ac])}}}}for(var ab in ag){if(ag[ab]!=Object.prototype[ab]&&ab.toLowerCase()!="movie"){e(Z,ab,ag[ab])}}aa.parentNode.replaceChild(Z,aa);X=Z}}return X}function e(Z,X,Y){var aa=C("param");aa.setAttribute("name",X);aa.setAttribute("value",Y);Z.appendChild(aa)}function y(Y){var X=c(Y);if(X&&X.nodeName=="OBJECT"){if(M.ie&&M.win){X.style.display="none";(function(){if(X.readyState==4){b(Y)}else{setTimeout(arguments.callee,10)}})()}else{X.parentNode.removeChild(X)}}}function b(Z){var Y=c(Z);if(Y){for(var X in Y){if(typeof Y[X]=="function"){Y[X]=null}}Y.parentNode.removeChild(Y)}}function c(Z){var X=null;try{X=j.getElementById(Z)}catch(Y){}return X}function C(X){return j.createElement(X)}function i(Z,X,Y){Z.attachEvent(X,Y);I[I.length]=[Z,X,Y]}function F(Z){var Y=M.pv,X=Z.split(".");X[0]=parseInt(X[0],10);X[1]=parseInt(X[1],10)||0;X[2]=parseInt(X[2],10)||0;return Y[0]>X[0]||Y[0]==X[0]&&Y[1]>X[1]||Y[0]==X[0]&&Y[1]==X[1]&&Y[2]>=X[2]?true:false}function v(ac,Y,ad,ab){if(M.ie&&M.mac){return}var aa=j.getElementsByTagName("head")[0];if(!aa){return}var X=ad&&typeof ad=="string"?ad:"screen";if(ab){n=null;G=null}if(!n||G!=X){var Z=C("style");Z.setAttribute("type","text/css");Z.setAttribute("media",X);n=aa.appendChild(Z);if(M.ie&&M.win&&typeof j.styleSheets!=D&&j.styleSheets.length>0){n=j.styleSheets[j.styleSheets.length-1]}G=X}if(M.ie&&M.win){if(n&&typeof n.addRule==r){n.addRule(ac,Y)}}else{if(n&&typeof j.createTextNode!=D){n.appendChild(j.createTextNode(ac+" {"+Y+"}"))}}}function w(Z,X){if(!m){return}var Y=X?"visible":"hidden";if(J&&c(Z)){c(Z).style.visibility=Y}else{v("#"+Z,"visibility:"+Y)}}function L(Y){var Z=/[\\\"<>\.;]/;var X=Z.exec(Y)!=null;return X&&typeof encodeURIComponent!=D?encodeURIComponent(Y):Y}var d=function(){if(M.ie&&M.win){window.attachEvent("onunload",function(){var ac=I.length;for(var ab=0;ab<ac;ab++){I[ab][0].detachEvent(I[ab][1],I[ab][2])}var Z=N.length;for(var aa=0;aa<Z;aa++){y(N[aa])}for(var Y in M){M[Y]=null}M=null;for(var X in swfobject){swfobject[X]=null}swfobject=null})}}();return{registerObject:function(ab,X,aa,Z){if(M.w3&&ab&&X){var Y={};Y.id=ab;Y.swfVersion=X;Y.expressInstall=aa;Y.callbackFn=Z;o[o.length]=Y;w(ab,false)}else{if(Z){Z({success:false,id:ab})}}},getObjectById:function(X){if(M.w3){return z(X)}},embedSWF:function(ab,ah,ae,ag,Y,aa,Z,ad,af,ac){var X={success:false,id:ah};if(M.w3&&!(M.wk&&M.wk<312)&&ab&&ah&&ae&&ag&&Y){w(ah,false);K(function(){ae+="";ag+="";var aj={};if(af&&typeof af===r){for(var al in af){aj[al]=af[al]}}aj.data=ab;aj.width=ae;aj.height=ag;var am={};if(ad&&typeof ad===r){for(var ak in ad){am[ak]=ad[ak]}}if(Z&&typeof Z===r){for(var ai in Z){if(typeof am.flashvars!=D){am.flashvars+="&"+ai+"="+Z[ai]}else{am.flashvars=ai+"="+Z[ai]}}}if(F(Y)){var an=u(aj,am,ah);if(aj.id==ah){w(ah,true)}X.success=true;X.ref=an}else{if(aa&&A()){aj.data=aa;P(aj,am,ah,ac);return}else{w(ah,true)}}if(ac){ac(X)}})}else{if(ac){ac(X)}}},switchOffAutoHideShow:function(){m=false},ua:M,getFlashPlayerVersion:function(){return{major:M.pv[0],minor:M.pv[1],release:M.pv[2]}},hasFlashPlayerVersion:F,createSWF:function(Z,Y,X){if(M.w3){return u(Z,Y,X)}else{return undefined}},showExpressInstall:function(Z,aa,X,Y){if(M.w3&&A()){P(Z,aa,X,Y)}},removeSWF:function(X){if(M.w3){y(X)}},createCSS:function(aa,Z,Y,X){if(M.w3){v(aa,Z,Y,X)}},addDomLoadEvent:K,addLoadEvent:s,getQueryParamValue:function(aa){var Z=j.location.search||j.location.hash;if(Z){if(/\?/.test(Z)){Z=Z.split("?")[1]}if(aa==null){return L(Z)}var Y=Z.split("&");for(var X=0;X<Y.length;X++){if(Y[X].substring(0,Y[X].indexOf("="))==aa){return L(Y[X].substring(Y[X].indexOf("=")+1))}}}return""},expressInstallCallback:function(){if(a){var X=c(R);if(X&&l){X.parentNode.replaceChild(l,X);if(Q){w(Q,true);if(M.ie&&M.win){l.style.display="block"}}if(E){E(B)}}a=false}}}}()}(function(){if("undefined"==typeof window||window.WebSocket)return;var console=window.console;if(!console||!console.log||!console.error){console={log:function(){},error:function(){}}}if(!swfobject.hasFlashPlayerVersion("10.0.0")){console.error("Flash Player >= 10.0.0 is required.");return}if(location.protocol=="file:"){console.error("WARNING: web-socket-js doesn't work in file:///... URL "+"unless you set Flash Security Settings properly. "+"Open the page via Web server i.e. http://...")}WebSocket=function(url,protocols,proxyHost,proxyPort,headers){var self=this;self.__id=WebSocket.__nextId++;WebSocket.__instances[self.__id]=self;self.readyState=WebSocket.CONNECTING;self.bufferedAmount=0;self.__events={};if(!protocols){protocols=[]}else if(typeof protocols=="string"){protocols=[protocols]}setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(self.__id,url,protocols,proxyHost||null,proxyPort||0,headers||null)})},0)};WebSocket.prototype.send=function(data){if(this.readyState==WebSocket.CONNECTING){throw"INVALID_STATE_ERR: Web Socket connection has not been established"}var result=WebSocket.__flash.send(this.__id,encodeURIComponent(data));if(result<0){return true}else{this.bufferedAmount+=result;return false}};WebSocket.prototype.close=function(){if(this.readyState==WebSocket.CLOSED||this.readyState==WebSocket.CLOSING){return}this.readyState=WebSocket.CLOSING;WebSocket.__flash.close(this.__id)};WebSocket.prototype.addEventListener=function(type,listener,useCapture){if(!(type in this.__events)){this.__events[type]=[]}this.__events[type].push(listener)};WebSocket.prototype.removeEventListener=function(type,listener,useCapture){if(!(type in this.__events))return;var events=this.__events[type];for(var i=events.length-1;i>=0;--i){if(events[i]===listener){events.splice(i,1);break}}};WebSocket.prototype.dispatchEvent=function(event){var events=this.__events[event.type]||[];for(var i=0;i<events.length;++i){events[i](event)}var handler=this["on"+event.type];if(handler)handler(event)};WebSocket.prototype.__handleEvent=function(flashEvent){if("readyState"in flashEvent){this.readyState=flashEvent.readyState}if("protocol"in flashEvent){this.protocol=flashEvent.protocol}var jsEvent;if(flashEvent.type=="open"||flashEvent.type=="error"){jsEvent=this.__createSimpleEvent(flashEvent.type)}else if(flashEvent.type=="close"){jsEvent=this.__createSimpleEvent("close")}else if(flashEvent.type=="message"){var data=decodeURIComponent(flashEvent.message);jsEvent=this.__createMessageEvent("message",data)}else{throw"unknown event type: "+flashEvent.type}this.dispatchEvent(jsEvent)};WebSocket.prototype.__createSimpleEvent=function(type){if(document.createEvent&&window.Event){var event=document.createEvent("Event");event.initEvent(type,false,false);return event}else{return{type:type,bubbles:false,cancelable:false}}};WebSocket.prototype.__createMessageEvent=function(type,data){if(document.createEvent&&window.MessageEvent&&!window.opera){var event=document.createEvent("MessageEvent");event.initMessageEvent("message",false,false,data,null,null,window,null);return event}else{return{type:type,data:data,bubbles:false,cancelable:false}}};WebSocket.CONNECTING=0;WebSocket.OPEN=1;WebSocket.CLOSING=2;WebSocket.CLOSED=3;WebSocket.__flash=null;WebSocket.__instances={};WebSocket.__tasks=[];WebSocket.__nextId=0;WebSocket.loadFlashPolicyFile=function(url){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(url)})};WebSocket.__initialize=function(){if(WebSocket.__flash)return;if(WebSocket.__swfLocation){window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation}if(!window.WEB_SOCKET_SWF_LOCATION){console.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf");return}var container=document.createElement("div");container.id="webSocketContainer";container.style.position="absolute";if(WebSocket.__isFlashLite()){container.style.left="0px";container.style.top="0px"}else{container.style.left="-100px";container.style.top="-100px"}var holder=document.createElement("div");holder.id="webSocketFlash";container.appendChild(holder);document.body.appendChild(container);swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:true,swliveconnect:true,allowScriptAccess:"always"},null,function(e){if(!e.success){console.error("[WebSocket] swfobject.embedSWF failed")}})};WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash");WebSocket.__flash.setCallerUrl(location.href);WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var i=0;i<WebSocket.__tasks.length;++i){WebSocket.__tasks[i]()}WebSocket.__tasks=[]},0)};WebSocket.__onFlashEvent=function(){setTimeout(function(){try{var events=WebSocket.__flash.receiveEvents();for(var i=0;i<events.length;++i){WebSocket.__instances[events[i].webSocketId].__handleEvent(events[i])}}catch(e){console.error(e)}},0);return true};WebSocket.__log=function(message){console.log(decodeURIComponent(message))};WebSocket.__error=function(message){console.error(decodeURIComponent(message))};WebSocket.__addTask=function(task){if(WebSocket.__flash){task()}else{WebSocket.__tasks.push(task)}};WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes){return false}var mimeType=window.navigator.mimeTypes["application/x-shockwave-flash"];if(!mimeType||!mimeType.enabledPlugin||!mimeType.enabledPlugin.filename){return false}return mimeType.enabledPlugin.filename.match(/flashlite/i)?true:false};if(!window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION){if(window.addEventListener){window.addEventListener("load",function(){WebSocket.__initialize()},false)}else{window.attachEvent("onload",function(){WebSocket.__initialize()})}}})();(function(exports,io,global){exports.XHR=XHR;function XHR(socket){if(!socket)return;io.Transport.apply(this,arguments);this.sendBuffer=[]}io.util.inherit(XHR,io.Transport);XHR.prototype.open=function(){this.socket.setBuffer(false);this.onOpen();this.get();this.setCloseTimeout();return this};XHR.prototype.payload=function(payload){var msgs=[];for(var i=0,l=payload.length;i<l;i++){msgs.push(io.parser.encodePacket(payload[i]))}this.send(io.parser.encodePayload(msgs))};XHR.prototype.send=function(data){this.post(data);return this};function empty(){}XHR.prototype.post=function(data){var self=this;this.socket.setBuffer(true);function stateChange(){if(this.readyState==4){this.onreadystatechange=empty;self.posting=false;if(this.status==200){self.socket.setBuffer(false)}else{self.onClose()}}}function onload(){this.onload=empty;self.socket.setBuffer(false)}this.sendXHR=this.request("POST");if(global.XDomainRequest&&this.sendXHR instanceof XDomainRequest){this.sendXHR.onload=this.sendXHR.onerror=onload}else{this.sendXHR.onreadystatechange=stateChange}this.sendXHR.send(data)};XHR.prototype.close=function(){this.onClose();return this};XHR.prototype.request=function(method){var req=io.util.request(this.socket.isXDomain()),query=io.util.query(this.socket.options.query,"t="+ +new Date);req.open(method||"GET",this.prepareUrl()+query,true);if(method=="POST"){try{if(req.setRequestHeader){req.setRequestHeader("Content-type","text/plain;charset=UTF-8")}else{req.contentType="text/plain"}}catch(e){}}return req};XHR.prototype.scheme=function(){return this.socket.options.secure?"https":"http"};XHR.check=function(socket,xdomain){try{var request=io.util.request(xdomain),usesXDomReq=global.XDomainRequest&&request instanceof XDomainRequest,socketProtocol=socket&&socket.options&&socket.options.secure?"https:":"http:",isXProtocol=global.location&&socketProtocol!=global.location.protocol;if(request&&!(usesXDomReq&&isXProtocol)){return true}}catch(e){}return false};XHR.xdomainCheck=function(socket){return XHR.check(socket,true)}})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);(function(exports,io){exports.htmlfile=HTMLFile;function HTMLFile(socket){io.Transport.XHR.apply(this,arguments)}io.util.inherit(HTMLFile,io.Transport.XHR);HTMLFile.prototype.name="htmlfile";HTMLFile.prototype.get=function(){this.doc=new(window[["Active"].concat("Object").join("X")])("htmlfile");this.doc.open();this.doc.write("<html></html>");this.doc.close();this.doc.parentWindow.s=this;var iframeC=this.doc.createElement("div");iframeC.className="socketio";this.doc.body.appendChild(iframeC);this.iframe=this.doc.createElement("iframe");iframeC.appendChild(this.iframe);var self=this,query=io.util.query(this.socket.options.query,"t="+ +new Date);this.iframe.src=this.prepareUrl()+query;io.util.on(window,"unload",function(){self.destroy()})};HTMLFile.prototype._=function(data,doc){data=data.replace(/\\\//g,"/");this.onData(data);try{var script=doc.getElementsByTagName("script")[0];script.parentNode.removeChild(script)}catch(e){}};HTMLFile.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(e){}this.doc=null;this.iframe.parentNode.removeChild(this.iframe);this.iframe=null;CollectGarbage()}};HTMLFile.prototype.close=function(){this.destroy();return io.Transport.XHR.prototype.close.call(this)};HTMLFile.check=function(socket){if(typeof window!="undefined"&&["Active"].concat("Object").join("X")in window){try{var a=new(window[["Active"].concat("Object").join("X")])("htmlfile");return a&&io.Transport.XHR.check(socket)}catch(e){}}return false};HTMLFile.xdomainCheck=function(){return false};io.transports.push("htmlfile")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports);(function(exports,io,global){exports["xhr-polling"]=XHRPolling;function XHRPolling(){io.Transport.XHR.apply(this,arguments)}io.util.inherit(XHRPolling,io.Transport.XHR);io.util.merge(XHRPolling,io.Transport.XHR);XHRPolling.prototype.name="xhr-polling";XHRPolling.prototype.heartbeats=function(){return false};XHRPolling.prototype.open=function(){var self=this;io.Transport.XHR.prototype.open.call(self);return false};function empty(){}XHRPolling.prototype.get=function(){if(!this.isOpen)return;var self=this;function stateChange(){if(this.readyState==4){this.onreadystatechange=empty;if(this.status==200){self.onData(this.responseText);self.get()}else{self.onClose()}}}function onload(){this.onload=empty;this.onerror=empty;self.retryCounter=1;self.onData(this.responseText);self.get()}function onerror(){self.retryCounter++;if(!self.retryCounter||self.retryCounter>3){self.onClose()}else{self.get()}}this.xhr=this.request();if(global.XDomainRequest&&this.xhr instanceof XDomainRequest){this.xhr.onload=onload;this.xhr.onerror=onerror}else{this.xhr.onreadystatechange=stateChange}this.xhr.send(null)};XHRPolling.prototype.onClose=function(){io.Transport.XHR.prototype.onClose.call(this);if(this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=empty;try{this.xhr.abort()}catch(e){}this.xhr=null}};XHRPolling.prototype.ready=function(socket,fn){var self=this;io.util.defer(function(){fn.call(self)})};io.transports.push("xhr-polling")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);(function(exports,io,global){var indicator=global.document&&"MozAppearance"in global.document.documentElement.style;exports["jsonp-polling"]=JSONPPolling;function JSONPPolling(socket){io.Transport["xhr-polling"].apply(this,arguments);this.index=io.j.length;var self=this;io.j.push(function(msg){self._(msg)})}io.util.inherit(JSONPPolling,io.Transport["xhr-polling"]);JSONPPolling.prototype.name="jsonp-polling";JSONPPolling.prototype.post=function(data){var self=this,query=io.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);if(!this.form){var form=document.createElement("form"),area=document.createElement("textarea"),id=this.iframeId="socketio_iframe_"+this.index,iframe;form.className="socketio";form.style.position="absolute";form.style.top="0px";form.style.left="0px";form.style.display="none";form.target=id;form.method="POST";form.setAttribute("accept-charset","utf-8");area.name="d";form.appendChild(area);document.body.appendChild(form);this.form=form;this.area=area}this.form.action=this.prepareUrl()+query;function complete(){initIframe();self.socket.setBuffer(false)}function initIframe(){if(self.iframe){self.form.removeChild(self.iframe)}try{iframe=document.createElement('<iframe name="'+self.iframeId+'">')}catch(e){iframe=document.createElement("iframe");iframe.name=self.iframeId}iframe.id=self.iframeId;self.form.appendChild(iframe);self.iframe=iframe}initIframe();this.area.value=io.JSON.stringify(data);try{this.form.submit()}catch(e){}if(this.iframe.attachEvent){iframe.onreadystatechange=function(){if(self.iframe.readyState=="complete"){complete()}}}else{this.iframe.onload=complete}this.socket.setBuffer(true)};JSONPPolling.prototype.get=function(){var self=this,script=document.createElement("script"),query=io.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}script.async=true;script.src=this.prepareUrl()+query;script.onerror=function(){self.onClose()};var insertAt=document.getElementsByTagName("script")[0];insertAt.parentNode.insertBefore(script,insertAt);this.script=script;if(indicator){setTimeout(function(){var iframe=document.createElement("iframe");document.body.appendChild(iframe);document.body.removeChild(iframe)},100)}};JSONPPolling.prototype._=function(msg){this.onData(msg);if(this.isOpen){this.get()}return this};JSONPPolling.prototype.ready=function(socket,fn){var self=this;if(!indicator)return fn.call(this);io.util.load(function(){fn.call(self)})};JSONPPolling.check=function(){return"document"in global};JSONPPolling.xdomainCheck=function(){return true};io.transports.push("jsonp-polling")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);if(typeof define==="function"&&define.amd){define([],function(){return io})}})();BigInteger=function(){var dbits;var canary=0xdeadbeefcafe;var j_lm=(canary&16777215)==15715070;function BigInteger(a,b,c){if(a!=null)if("number"==typeof a)this.fromNumber(a,b,c);else if(b==null&&"string"!=typeof a)this.fromString(a,256);else this.fromString(a,b)}function nbi(){return new BigInteger(null)}function am1(i,x,w,j,c,n){while(--n>=0){var v=x*this[i++]+w[j]+c;c=Math.floor(v/67108864);w[j++]=v&67108863}return c}function am2(i,x,w,j,c,n){var xl=x&32767,xh=x>>15;while(--n>=0){var l=this[i]&32767;var h=this[i++]>>15;var m=xh*l+h*xl;l=xl*l+((m&32767)<<15)+w[j]+(c&1073741823);c=(l>>>30)+(m>>>15)+xh*h+(c>>>30);w[j++]=l&1073741823}return c}function am3(i,x,w,j,c,n){var xl=x&16383,xh=x>>14;while(--n>=0){var l=this[i]&16383;var h=this[i++]>>14;var m=xh*l+h*xl;l=xl*l+((m&16383)<<14)+w[j]+c;c=(l>>28)+(m>>14)+xh*h;w[j++]=l&268435455}return c}if(j_lm&&navigator.appName=="Microsoft Internet Explorer"){BigInteger.prototype.am=am2;dbits=30}else if(j_lm&&navigator.appName!="Netscape"){BigInteger.prototype.am=am1;dbits=26}else{BigInteger.prototype.am=am3;dbits=28}BigInteger.prototype.DB=dbits;BigInteger.prototype.DM=(1<<dbits)-1;BigInteger.prototype.DV=1<<dbits;var BI_FP=52;BigInteger.prototype.FV=Math.pow(2,BI_FP);BigInteger.prototype.F1=BI_FP-dbits;BigInteger.prototype.F2=2*dbits-BI_FP;var BI_RM="0123456789abcdefghijklmnopqrstuvwxyz";var BI_RC=new Array;var rr,vv;rr="0".charCodeAt(0);for(vv=0;vv<=9;++vv)BI_RC[rr++]=vv;rr="a".charCodeAt(0);for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;rr="A".charCodeAt(0);for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;function int2char(n){return BI_RM.charAt(n)}function intAt(s,i){var c=BI_RC[s.charCodeAt(i)];return c==null?-1:c}function bnpCopyTo(r){for(var i=this.t-1;i>=0;--i)r[i]=this[i];r.t=this.t;r.s=this.s}function bnpFromInt(x){this.t=1;this.s=x<0?-1:0;if(x>0)this[0]=x;else if(x<-1)this[0]=x+DV;else this.t=0}function nbv(i){var r=nbi();r.fromInt(i);return r}function bnpFromString(s,b){var k;if(b==16)k=4;else if(b==8)k=3;else if(b==256)k=8;else if(b==2)k=1;else if(b==32)k=5;else if(b==4)k=2;else{this.fromRadix(s,b);return}this.t=0;this.s=0;var i=s.length,mi=false,sh=0;while(--i>=0){var x=k==8?s[i]&255:intAt(s,i);if(x<0){if(s.charAt(i)=="-")mi=true;continue}mi=false;if(sh==0)this[this.t++]=x;else if(sh+k>this.DB){this[this.t-1]|=(x&(1<<this.DB-sh)-1)<<sh;this[this.t++]=x>>this.DB-sh}else this[this.t-1]|=x<<sh;sh+=k;if(sh>=this.DB)sh-=this.DB}if(k==8&&(s[0]&128)!=0){this.s=-1;if(sh>0)this[this.t-1]|=(1<<this.DB-sh)-1<<sh}this.clamp();if(mi)BigInteger.ZERO.subTo(this,this)}function bnpClamp(){var c=this.s&this.DM;while(this.t>0&&this[this.t-1]==c)--this.t}function bnToString(b){if(this.s<0)return"-"+this.negate().toString(b);var k;if(b==16)k=4;else if(b==8)k=3;else if(b==2)k=1;else if(b==32)k=5;else if(b==4)k=2;else return this.toRadix(b);var km=(1<<k)-1,d,m=false,r="",i=this.t;var p=this.DB-i*this.DB%k;if(i-->0){if(p<this.DB&&(d=this[i]>>p)>0){m=true;r=int2char(d)}while(i>=0){if(p<k){d=(this[i]&(1<<p)-1)<<k-p;d|=this[--i]>>(p+=this.DB-k)}else{d=this[i]>>(p-=k)&km;if(p<=0){p+=this.DB;--i}}if(d>0)m=true;if(m)r+=int2char(d)}}return m?r:"0"}function bnNegate(){var r=nbi();BigInteger.ZERO.subTo(this,r);return r}function bnAbs(){return this.s<0?this.negate():this}function bnCompareTo(a){var r=this.s-a.s;if(r!=0)return r;var i=this.t;r=i-a.t;if(r!=0)return this.s<0?-r:r;while(--i>=0)if((r=this[i]-a[i])!=0)return r;return 0}function nbits(x){var r=1,t;if((t=x>>>16)!=0){x=t;r+=16}if((t=x>>8)!=0){x=t;r+=8}if((t=x>>4)!=0){x=t;r+=4}if((t=x>>2)!=0){x=t;r+=2}if((t=x>>1)!=0){x=t;r+=1}return r}function bnBitLength(){if(this.t<=0)return 0;return this.DB*(this.t-1)+nbits(this[this.t-1]^this.s&this.DM)}function bnpDLShiftTo(n,r){var i;for(i=this.t-1;i>=0;--i)r[i+n]=this[i];for(i=n-1;i>=0;--i)r[i]=0;r.t=this.t+n;r.s=this.s}function bnpDRShiftTo(n,r){for(var i=n;i<this.t;++i)r[i-n]=this[i];r.t=Math.max(this.t-n,0);r.s=this.s}function bnpLShiftTo(n,r){var bs=n%this.DB;var cbs=this.DB-bs;var bm=(1<<cbs)-1;var ds=Math.floor(n/this.DB),c=this.s<<bs&this.DM,i;for(i=this.t-1;i>=0;--i){r[i+ds+1]=this[i]>>cbs|c;c=(this[i]&bm)<<bs}for(i=ds-1;i>=0;--i)r[i]=0;r[ds]=c;r.t=this.t+ds+1;r.s=this.s;r.clamp()}function bnpRShiftTo(n,r){r.s=this.s;var ds=Math.floor(n/this.DB);if(ds>=this.t){r.t=0;return}var bs=n%this.DB;var cbs=this.DB-bs;var bm=(1<<bs)-1;r[0]=this[ds]>>bs;for(var i=ds+1;i<this.t;++i){r[i-ds-1]|=(this[i]&bm)<<cbs;r[i-ds]=this[i]>>bs}if(bs>0)r[this.t-ds-1]|=(this.s&bm)<<cbs;r.t=this.t-ds;r.clamp()}function bnpSubTo(a,r){var i=0,c=0,m=Math.min(a.t,this.t);while(i<m){c+=this[i]-a[i];r[i++]=c&this.DM;c>>=this.DB}if(a.t<this.t){c-=a.s;while(i<this.t){c+=this[i];r[i++]=c&this.DM;c>>=this.DB}c+=this.s}else{c+=this.s;while(i<a.t){c-=a[i];r[i++]=c&this.DM;c>>=this.DB}c-=a.s}r.s=c<0?-1:0;if(c<-1)r[i++]=this.DV+c;else if(c>0)r[i++]=c;r.t=i;r.clamp()}function bnpMultiplyTo(a,r){var x=this.abs(),y=a.abs();var i=x.t;r.t=i+y.t;while(--i>=0)r[i]=0;for(i=0;i<y.t;++i)r[i+x.t]=x.am(0,y[i],r,i,0,x.t);r.s=0;r.clamp();if(this.s!=a.s)BigInteger.ZERO.subTo(r,r)}function bnpSquareTo(r){var x=this.abs();var i=r.t=2*x.t;while(--i>=0)r[i]=0;for(i=0;i<x.t-1;++i){var c=x.am(i,x[i],r,2*i,0,1);if((r[i+x.t]+=x.am(i+1,2*x[i],r,2*i+1,c,x.t-i-1))>=x.DV){r[i+x.t]-=x.DV;r[i+x.t+1]=1}}if(r.t>0)r[r.t-1]+=x.am(i,x[i],r,2*i,0,1);r.s=0;r.clamp()}function bnpDivRemTo(m,q,r){var pm=m.abs();if(pm.t<=0)return;var pt=this.abs();if(pt.t<pm.t){if(q!=null)q.fromInt(0);if(r!=null)this.copyTo(r);return}if(r==null)r=nbi();var y=nbi(),ts=this.s,ms=m.s;var nsh=this.DB-nbits(pm[pm.t-1]);if(nsh>0){pm.lShiftTo(nsh,y);pt.lShiftTo(nsh,r)}else{pm.copyTo(y);pt.copyTo(r)}var ys=y.t;var y0=y[ys-1];if(y0==0)return;var yt=y0*(1<<this.F1)+(ys>1?y[ys-2]>>this.F2:0);var d1=this.FV/yt,d2=(1<<this.F1)/yt,e=1<<this.F2;var i=r.t,j=i-ys,t=q==null?nbi():q;y.dlShiftTo(j,t);if(r.compareTo(t)>=0){r[r.t++]=1;r.subTo(t,r)}BigInteger.ONE.dlShiftTo(ys,t);t.subTo(y,y);while(y.t<ys)y[y.t++]=0;while(--j>=0){var qd=r[--i]==y0?this.DM:Math.floor(r[i]*d1+(r[i-1]+e)*d2);if((r[i]+=y.am(0,qd,r,j,0,ys))<qd){y.dlShiftTo(j,t);r.subTo(t,r);while(r[i]<--qd)r.subTo(t,r)}}if(q!=null){r.drShiftTo(ys,q);if(ts!=ms)BigInteger.ZERO.subTo(q,q)}r.t=ys;r.clamp();if(nsh>0)r.rShiftTo(nsh,r);if(ts<0)BigInteger.ZERO.subTo(r,r)}function bnMod(a){var r=nbi();this.abs().divRemTo(a,null,r);if(this.s<0&&r.compareTo(BigInteger.ZERO)>0)a.subTo(r,r);return r}function Classic(m){this.m=m}function cConvert(x){if(x.s<0||x.compareTo(this.m)>=0)return x.mod(this.m);else return x}function cRevert(x){return x}function cReduce(x){x.divRemTo(this.m,null,x)}function cMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r)}function cSqrTo(x,r){x.squareTo(r);this.reduce(r)}Classic.prototype.convert=cConvert;Classic.prototype.revert=cRevert;Classic.prototype.reduce=cReduce;Classic.prototype.mulTo=cMulTo;Classic.prototype.sqrTo=cSqrTo;function bnpInvDigit(){if(this.t<1)return 0;var x=this[0];if((x&1)==0)return 0;var y=x&3;y=y*(2-(x&15)*y)&15;y=y*(2-(x&255)*y)&255;y=y*(2-((x&65535)*y&65535))&65535;y=y*(2-x*y%this.DV)%this.DV;return y>0?this.DV-y:-y}function Montgomery(m){this.m=m;this.mp=m.invDigit();this.mpl=this.mp&32767;
this.mph=this.mp>>15;this.um=(1<<m.DB-15)-1;this.mt2=2*m.t}function montConvert(x){var r=nbi();x.abs().dlShiftTo(this.m.t,r);r.divRemTo(this.m,null,r);if(x.s<0&&r.compareTo(BigInteger.ZERO)>0)this.m.subTo(r,r);return r}function montRevert(x){var r=nbi();x.copyTo(r);this.reduce(r);return r}function montReduce(x){while(x.t<=this.mt2)x[x.t++]=0;for(var i=0;i<this.m.t;++i){var j=x[i]&32767;var u0=j*this.mpl+((j*this.mph+(x[i]>>15)*this.mpl&this.um)<<15)&x.DM;j=i+this.m.t;x[j]+=this.m.am(0,u0,x,i,0,this.m.t);while(x[j]>=x.DV){x[j]-=x.DV;x[++j]++}}x.clamp();x.drShiftTo(this.m.t,x);if(x.compareTo(this.m)>=0)x.subTo(this.m,x)}function montSqrTo(x,r){x.squareTo(r);this.reduce(r)}function montMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r)}Montgomery.prototype.convert=montConvert;Montgomery.prototype.revert=montRevert;Montgomery.prototype.reduce=montReduce;Montgomery.prototype.mulTo=montMulTo;Montgomery.prototype.sqrTo=montSqrTo;function bnpIsEven(){return(this.t>0?this[0]&1:this.s)==0}function bnpExp(e,z){if(e>4294967295||e<1)return BigInteger.ONE;var r=nbi(),r2=nbi(),g=z.convert(this),i=nbits(e)-1;g.copyTo(r);while(--i>=0){z.sqrTo(r,r2);if((e&1<<i)>0)z.mulTo(r2,g,r);else{var t=r;r=r2;r2=t}}return z.revert(r)}function bnModPowInt(e,m){var z;if(e<256||m.isEven())z=new Classic(m);else z=new Montgomery(m);return this.exp(e,z)}BigInteger.prototype.copyTo=bnpCopyTo;BigInteger.prototype.fromInt=bnpFromInt;BigInteger.prototype.fromString=bnpFromString;BigInteger.prototype.clamp=bnpClamp;BigInteger.prototype.dlShiftTo=bnpDLShiftTo;BigInteger.prototype.drShiftTo=bnpDRShiftTo;BigInteger.prototype.lShiftTo=bnpLShiftTo;BigInteger.prototype.rShiftTo=bnpRShiftTo;BigInteger.prototype.subTo=bnpSubTo;BigInteger.prototype.multiplyTo=bnpMultiplyTo;BigInteger.prototype.squareTo=bnpSquareTo;BigInteger.prototype.divRemTo=bnpDivRemTo;BigInteger.prototype.invDigit=bnpInvDigit;BigInteger.prototype.isEven=bnpIsEven;BigInteger.prototype.exp=bnpExp;BigInteger.prototype.toString=bnToString;BigInteger.prototype.negate=bnNegate;BigInteger.prototype.abs=bnAbs;BigInteger.prototype.compareTo=bnCompareTo;BigInteger.prototype.bitLength=bnBitLength;BigInteger.prototype.mod=bnMod;BigInteger.prototype.modPowInt=bnModPowInt;BigInteger.ZERO=nbv(0);BigInteger.ONE=nbv(1);function bnClone(){var r=nbi();this.copyTo(r);return r}function bnIntValue(){if(this.s<0){if(this.t==1)return this[0]-this.DV;else if(this.t==0)return-1}else if(this.t==1)return this[0];else if(this.t==0)return 0;return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function bnByteValue(){return this.t==0?this.s:this[0]<<24>>24}function bnShortValue(){return this.t==0?this.s:this[0]<<16>>16}function bnpChunkSize(r){return Math.floor(Math.LN2*this.DB/Math.log(r))}function bnSigNum(){if(this.s<0)return-1;else if(this.t<=0||this.t==1&&this[0]<=0)return 0;else return 1}function bnpToRadix(b){if(b==null)b=10;if(this.signum()==0||b<2||b>36)return"0";var cs=this.chunkSize(b);var a=Math.pow(b,cs);var d=nbv(a),y=nbi(),z=nbi(),r="";this.divRemTo(d,y,z);while(y.signum()>0){r=(a+z.intValue()).toString(b).substr(1)+r;y.divRemTo(d,y,z)}return z.intValue().toString(b)+r}function bnpFromRadix(s,b){this.fromInt(0);if(b==null)b=10;var cs=this.chunkSize(b);var d=Math.pow(b,cs),mi=false,j=0,w=0;for(var i=0;i<s.length;++i){var x=intAt(s,i);if(x<0){if(s.charAt(i)=="-"&&this.signum()==0)mi=true;continue}w=b*w+x;if(++j>=cs){this.dMultiply(d);this.dAddOffset(w,0);j=0;w=0}}if(j>0){this.dMultiply(Math.pow(b,j));this.dAddOffset(w,0)}if(mi)BigInteger.ZERO.subTo(this,this)}function bnpFromNumber(a,b,c){if("number"==typeof b){if(a<2)this.fromInt(1);else{this.fromNumber(a,c);if(!this.testBit(a-1))this.bitwiseTo(BigInteger.ONE.shiftLeft(a-1),op_or,this);if(this.isEven())this.dAddOffset(1,0);while(!this.isProbablePrime(b)){this.dAddOffset(2,0);if(this.bitLength()>a)this.subTo(BigInteger.ONE.shiftLeft(a-1),this)}}}else{var x=new Array,t=a&7;x.length=(a>>3)+1;b.nextBytes(x);if(t>0)x[0]&=(1<<t)-1;else x[0]=0;this.fromString(x,256)}}function bnToByteArray(){var i=this.t,r=new Array;r[0]=this.s;var p=this.DB-i*this.DB%8,d,k=0;if(i-->0){if(p<this.DB&&(d=this[i]>>p)!=(this.s&this.DM)>>p)r[k++]=d|this.s<<this.DB-p;while(i>=0){if(p<8){d=(this[i]&(1<<p)-1)<<8-p;d|=this[--i]>>(p+=this.DB-8)}else{d=this[i]>>(p-=8)&255;if(p<=0){p+=this.DB;--i}}if((d&128)!=0)d|=-256;if(k==0&&(this.s&128)!=(d&128))++k;if(k>0||d!=this.s)r[k++]=d}}return r}function bnEquals(a){return this.compareTo(a)==0}function bnMin(a){return this.compareTo(a)<0?this:a}function bnMax(a){return this.compareTo(a)>0?this:a}function bnpBitwiseTo(a,op,r){var i,f,m=Math.min(a.t,this.t);for(i=0;i<m;++i)r[i]=op(this[i],a[i]);if(a.t<this.t){f=a.s&this.DM;for(i=m;i<this.t;++i)r[i]=op(this[i],f);r.t=this.t}else{f=this.s&this.DM;for(i=m;i<a.t;++i)r[i]=op(f,a[i]);r.t=a.t}r.s=op(this.s,a.s);r.clamp()}function op_and(x,y){return x&y}function bnAnd(a){var r=nbi();this.bitwiseTo(a,op_and,r);return r}function op_or(x,y){return x|y}function bnOr(a){var r=nbi();this.bitwiseTo(a,op_or,r);return r}function op_xor(x,y){return x^y}function bnXor(a){var r=nbi();this.bitwiseTo(a,op_xor,r);return r}function op_andnot(x,y){return x&~y}function bnAndNot(a){var r=nbi();this.bitwiseTo(a,op_andnot,r);return r}function bnNot(){var r=nbi();for(var i=0;i<this.t;++i)r[i]=this.DM&~this[i];r.t=this.t;r.s=~this.s;return r}function bnShiftLeft(n){var r=nbi();if(n<0)this.rShiftTo(-n,r);else this.lShiftTo(n,r);return r}function bnShiftRight(n){var r=nbi();if(n<0)this.lShiftTo(-n,r);else this.rShiftTo(n,r);return r}function lbit(x){if(x==0)return-1;var r=0;if((x&65535)==0){x>>=16;r+=16}if((x&255)==0){x>>=8;r+=8}if((x&15)==0){x>>=4;r+=4}if((x&3)==0){x>>=2;r+=2}if((x&1)==0)++r;return r}function bnGetLowestSetBit(){for(var i=0;i<this.t;++i)if(this[i]!=0)return i*this.DB+lbit(this[i]);if(this.s<0)return this.t*this.DB;return-1}function cbit(x){var r=0;while(x!=0){x&=x-1;++r}return r}function bnBitCount(){var r=0,x=this.s&this.DM;for(var i=0;i<this.t;++i)r+=cbit(this[i]^x);return r}function bnTestBit(n){var j=Math.floor(n/this.DB);if(j>=this.t)return this.s!=0;return(this[j]&1<<n%this.DB)!=0}function bnpChangeBit(n,op){var r=BigInteger.ONE.shiftLeft(n);this.bitwiseTo(r,op,r);return r}function bnSetBit(n){return this.changeBit(n,op_or)}function bnClearBit(n){return this.changeBit(n,op_andnot)}function bnFlipBit(n){return this.changeBit(n,op_xor)}function bnpAddTo(a,r){var i=0,c=0,m=Math.min(a.t,this.t);while(i<m){c+=this[i]+a[i];r[i++]=c&this.DM;c>>=this.DB}if(a.t<this.t){c+=a.s;while(i<this.t){c+=this[i];r[i++]=c&this.DM;c>>=this.DB}c+=this.s}else{c+=this.s;while(i<a.t){c+=a[i];r[i++]=c&this.DM;c>>=this.DB}c+=a.s}r.s=c<0?-1:0;if(c>0)r[i++]=c;else if(c<-1)r[i++]=this.DV+c;r.t=i;r.clamp()}function bnAdd(a){var r=nbi();this.addTo(a,r);return r}function bnSubtract(a){var r=nbi();this.subTo(a,r);return r}function bnMultiply(a){var r=nbi();this.multiplyTo(a,r);return r}function bnSquare(){var r=nbi();this.squareTo(r);return r}function bnDivide(a){var r=nbi();this.divRemTo(a,r,null);return r}function bnRemainder(a){var r=nbi();this.divRemTo(a,null,r);return r}function bnDivideAndRemainder(a){var q=nbi(),r=nbi();this.divRemTo(a,q,r);return new Array(q,r)}function bnpDMultiply(n){this[this.t]=this.am(0,n-1,this,0,0,this.t);++this.t;this.clamp()}function bnpDAddOffset(n,w){if(n==0)return;while(this.t<=w)this[this.t++]=0;this[w]+=n;while(this[w]>=this.DV){this[w]-=this.DV;if(++w>=this.t)this[this.t++]=0;++this[w]}}function NullExp(){}function nNop(x){return x}function nMulTo(x,y,r){x.multiplyTo(y,r)}function nSqrTo(x,r){x.squareTo(r)}NullExp.prototype.convert=nNop;NullExp.prototype.revert=nNop;NullExp.prototype.mulTo=nMulTo;NullExp.prototype.sqrTo=nSqrTo;function bnPow(e){return this.exp(e,new NullExp)}function bnpMultiplyLowerTo(a,n,r){var i=Math.min(this.t+a.t,n);r.s=0;r.t=i;while(i>0)r[--i]=0;var j;for(j=r.t-this.t;i<j;++i)r[i+this.t]=this.am(0,a[i],r,i,0,this.t);for(j=Math.min(a.t,n);i<j;++i)this.am(0,a[i],r,i,0,n-i);r.clamp()}function bnpMultiplyUpperTo(a,n,r){--n;var i=r.t=this.t+a.t-n;r.s=0;while(--i>=0)r[i]=0;for(i=Math.max(n-this.t,0);i<a.t;++i)r[this.t+i-n]=this.am(n-i,a[i],r,0,0,this.t+i-n);r.clamp();r.drShiftTo(1,r)}function Barrett(m){this.r2=nbi();this.q3=nbi();BigInteger.ONE.dlShiftTo(2*m.t,this.r2);this.mu=this.r2.divide(m);this.m=m}function barrettConvert(x){if(x.s<0||x.t>2*this.m.t)return x.mod(this.m);else if(x.compareTo(this.m)<0)return x;else{var r=nbi();x.copyTo(r);this.reduce(r);return r}}function barrettRevert(x){return x}function barrettReduce(x){x.drShiftTo(this.m.t-1,this.r2);if(x.t>this.m.t+1){x.t=this.m.t+1;x.clamp()}this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3);this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);while(x.compareTo(this.r2)<0)x.dAddOffset(1,this.m.t+1);x.subTo(this.r2,x);while(x.compareTo(this.m)>=0)x.subTo(this.m,x)}function barrettSqrTo(x,r){x.squareTo(r);this.reduce(r)}function barrettMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r)}Barrett.prototype.convert=barrettConvert;Barrett.prototype.revert=barrettRevert;Barrett.prototype.reduce=barrettReduce;Barrett.prototype.mulTo=barrettMulTo;Barrett.prototype.sqrTo=barrettSqrTo;function bnModPow(e,m){var i=e.bitLength(),k,r=nbv(1),z;if(i<=0)return r;else if(i<18)k=1;else if(i<48)k=3;else if(i<144)k=4;else if(i<768)k=5;else k=6;if(i<8)z=new Classic(m);else if(m.isEven())z=new Barrett(m);else z=new Montgomery(m);var g=new Array,n=3,k1=k-1,km=(1<<k)-1;g[1]=z.convert(this);if(k>1){var g2=nbi();z.sqrTo(g[1],g2);while(n<=km){g[n]=nbi();z.mulTo(g2,g[n-2],g[n]);n+=2}}var j=e.t-1,w,is1=true,r2=nbi(),t;i=nbits(e[j])-1;while(j>=0){if(i>=k1)w=e[j]>>i-k1&km;else{w=(e[j]&(1<<i+1)-1)<<k1-i;if(j>0)w|=e[j-1]>>this.DB+i-k1}n=k;while((w&1)==0){w>>=1;--n}if((i-=n)<0){i+=this.DB;--j}if(is1){g[w].copyTo(r);is1=false}else{while(n>1){z.sqrTo(r,r2);z.sqrTo(r2,r);n-=2}if(n>0)z.sqrTo(r,r2);else{t=r;r=r2;r2=t}z.mulTo(r2,g[w],r)}while(j>=0&&(e[j]&1<<i)==0){z.sqrTo(r,r2);t=r;r=r2;r2=t;if(--i<0){i=this.DB-1;--j}}}return z.revert(r)}function bnGCD(a){var x=this.s<0?this.negate():this.clone();var y=a.s<0?a.negate():a.clone();if(x.compareTo(y)<0){var t=x;x=y;y=t}var i=x.getLowestSetBit(),g=y.getLowestSetBit();if(g<0)return x;if(i<g)g=i;if(g>0){x.rShiftTo(g,x);y.rShiftTo(g,y)}while(x.signum()>0){if((i=x.getLowestSetBit())>0)x.rShiftTo(i,x);if((i=y.getLowestSetBit())>0)y.rShiftTo(i,y);if(x.compareTo(y)>=0){x.subTo(y,x);x.rShiftTo(1,x)}else{y.subTo(x,y);y.rShiftTo(1,y)}}if(g>0)y.lShiftTo(g,y);return y}function bnpModInt(n){if(n<=0)return 0;var d=this.DV%n,r=this.s<0?n-1:0;if(this.t>0)if(d==0)r=this[0]%n;else for(var i=this.t-1;i>=0;--i)r=(d*r+this[i])%n;return r}function bnModInverse(m){var ac=m.isEven();if(this.isEven()&&ac||m.signum()==0)return BigInteger.ZERO;var u=m.clone(),v=this.clone();var a=nbv(1),b=nbv(0),c=nbv(0),d=nbv(1);while(u.signum()!=0){while(u.isEven()){u.rShiftTo(1,u);if(ac){if(!a.isEven()||!b.isEven()){a.addTo(this,a);b.subTo(m,b)}a.rShiftTo(1,a)}else if(!b.isEven())b.subTo(m,b);b.rShiftTo(1,b)}while(v.isEven()){v.rShiftTo(1,v);if(ac){if(!c.isEven()||!d.isEven()){c.addTo(this,c);d.subTo(m,d)}c.rShiftTo(1,c)}else if(!d.isEven())d.subTo(m,d);d.rShiftTo(1,d)}if(u.compareTo(v)>=0){u.subTo(v,u);if(ac)a.subTo(c,a);b.subTo(d,b)}else{v.subTo(u,v);if(ac)c.subTo(a,c);d.subTo(b,d)}}if(v.compareTo(BigInteger.ONE)!=0)return BigInteger.ZERO;if(d.compareTo(m)>=0)return d.subtract(m);if(d.signum()<0)d.addTo(m,d);else return d;if(d.signum()<0)return d.add(m);else return d}var lowprimes=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997];var lplim=(1<<26)/lowprimes[lowprimes.length-1];function bnIsProbablePrime(t){var i,x=this.abs();if(x.t==1&&x[0]<=lowprimes[lowprimes.length-1]){for(i=0;i<lowprimes.length;++i)if(x[0]==lowprimes[i])return true;return false}if(x.isEven())return false;i=1;while(i<lowprimes.length){var m=lowprimes[i],j=i+1;while(j<lowprimes.length&&m<lplim)m*=lowprimes[j++];m=x.modInt(m);while(i<j)if(m%lowprimes[i++]==0)return false}return x.millerRabin(t)}function bnpMillerRabin(t){var n1=this.subtract(BigInteger.ONE);var k=n1.getLowestSetBit();if(k<=0)return false;var r=n1.shiftRight(k);t=t+1>>1;if(t>lowprimes.length)t=lowprimes.length;var a=nbi();for(var i=0;i<t;++i){a.fromInt(lowprimes[Math.floor(Math.random()*lowprimes.length)]);var y=a.modPow(r,this);if(y.compareTo(BigInteger.ONE)!=0&&y.compareTo(n1)!=0){var j=1;while(j++<k&&y.compareTo(n1)!=0){y=y.modPowInt(2,this);if(y.compareTo(BigInteger.ONE)==0)return false}if(y.compareTo(n1)!=0)return false}}return true}BigInteger.prototype.chunkSize=bnpChunkSize;BigInteger.prototype.toRadix=bnpToRadix;BigInteger.prototype.fromRadix=bnpFromRadix;BigInteger.prototype.fromNumber=bnpFromNumber;BigInteger.prototype.bitwiseTo=bnpBitwiseTo;BigInteger.prototype.changeBit=bnpChangeBit;BigInteger.prototype.addTo=bnpAddTo;BigInteger.prototype.dMultiply=bnpDMultiply;BigInteger.prototype.dAddOffset=bnpDAddOffset;BigInteger.prototype.multiplyLowerTo=bnpMultiplyLowerTo;BigInteger.prototype.multiplyUpperTo=bnpMultiplyUpperTo;BigInteger.prototype.modInt=bnpModInt;BigInteger.prototype.millerRabin=bnpMillerRabin;BigInteger.prototype.clone=bnClone;BigInteger.prototype.intValue=bnIntValue;BigInteger.prototype.byteValue=bnByteValue;BigInteger.prototype.shortValue=bnShortValue;BigInteger.prototype.signum=bnSigNum;BigInteger.prototype.toByteArray=bnToByteArray;BigInteger.prototype.equals=bnEquals;BigInteger.prototype.min=bnMin;BigInteger.prototype.max=bnMax;BigInteger.prototype.and=bnAnd;BigInteger.prototype.or=bnOr;BigInteger.prototype.xor=bnXor;BigInteger.prototype.andNot=bnAndNot;BigInteger.prototype.not=bnNot;BigInteger.prototype.shiftLeft=bnShiftLeft;BigInteger.prototype.shiftRight=bnShiftRight;BigInteger.prototype.getLowestSetBit=bnGetLowestSetBit;BigInteger.prototype.bitCount=bnBitCount;BigInteger.prototype.testBit=bnTestBit;BigInteger.prototype.setBit=bnSetBit;BigInteger.prototype.clearBit=bnClearBit;BigInteger.prototype.flipBit=bnFlipBit;BigInteger.prototype.add=bnAdd;BigInteger.prototype.subtract=bnSubtract;BigInteger.prototype.multiply=bnMultiply;BigInteger.prototype.divide=bnDivide;BigInteger.prototype.remainder=bnRemainder;BigInteger.prototype.divideAndRemainder=bnDivideAndRemainder;BigInteger.prototype.modPow=bnModPow;BigInteger.prototype.modInverse=bnModInverse;BigInteger.prototype.pow=bnPow;BigInteger.prototype.gcd=bnGCD;BigInteger.prototype.isProbablePrime=bnIsProbablePrime;BigInteger.prototype.square=bnSquare;return BigInteger}();SRPClient=function(){var hex_chr="0123456789abcdef";function hex(num){var str="";for(var j=7;j>=0;j--)str+=hex_chr.charAt(num>>j*4&15);return str}function str2blks_SHA1(str){var nblk=(str.length+8>>6)+1;var blks=new Array(nblk*16);for(var i=0;i<nblk*16;i++)blks[i]=0;for(i=0;i<str.length;i++)blks[i>>2]|=str.charCodeAt(i)<<24-i%4*8;blks[i>>2]|=128<<24-i%4*8;blks[nblk*16-1]=str.length*8;return blks}function hex2blks_SHA1(hex){var len=hex.length+1>>1;var nblk=(len+8>>6)+1;var blks=new Array(nblk*16);for(var i=0;i<nblk*16;i++)blks[i]=0;for(i=0;i<len;i++)blks[i>>2]|=parseInt(hex.substr(2*i,2),16)<<24-i%4*8;blks[i>>2]|=128<<24-i%4*8;blks[nblk*16-1]=len*8;return blks}function ba2blks_SHA1(ba,off,len){var nblk=(len+8>>6)+1;var blks=new Array(nblk*16);for(var i=0;i<nblk*16;i++)blks[i]=0;for(i=0;i<len;i++)blks[i>>2]|=(ba[off+i]&255)<<24-i%4*8;blks[i>>2]|=128<<24-i%4*8;blks[nblk*16-1]=len*8;return blks}function add(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535}function rol(num,cnt){return num<<cnt|num>>>32-cnt}function ft(t,b,c,d){if(t<20)return b&c|~b&d;if(t<40)return b^c^d;if(t<60)return b&c|b&d|c&d;return b^c^d}function kt(t){return t<20?1518500249:t<40?1859775393:t<60?-1894007588:-899497514}function calcSHA1(str){return calcSHA1Blks(str2blks_SHA1(str))}function calcSHA1Hex(str){return calcSHA1Blks(hex2blks_SHA1(str))}function calcSHA1BA(ba){return calcSHA1Blks(ba2blks_SHA1(ba,0,ba.length))}function calcSHA1BAEx(ba,off,len){return calcSHA1Blks(ba2blks_SHA1(ba,off,len))}function calcSHA1Blks(x){var s=calcSHA1Raw(x);return hex(s[0])+hex(s[1])+hex(s[2])+hex(s[3])+hex(s[4])}function calcSHA1Raw(x){var w=new Array(80);var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;var e=-1009589776;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;var olde=e;for(var j=0;j<80;j++){var t;if(j<16)w[j]=x[i+j];else w[j]=rol(w[j-3]^w[j-8]^w[j-14]^w[j-16],1);t=add(add(rol(a,5),ft(j,b,c,d)),add(add(e,w[j]),kt(j)));e=d;d=c;c=rol(b,30);b=a;a=t}a=add(a,olda);b=add(b,oldb);c=add(c,oldc);d=add(d,oldd);e=add(e,olde)}return new Array(a,b,c,d,e)}function core_sha1(x,len){x[len>>5]|=128<<24-len%32;x[(len+64>>9<<4)+15]=len;return calcSHA1Raw(x)}SRPClient=function(username,password,group,hashFn){if(!username)throw"Username cannot be empty.";this.username=username;this.password=password;this.hashFn=hashFn||"sha-1";var group=group||1024;var initVal=this.initVals[group];this.N=new BigInteger(initVal.N,16);this.g=new BigInteger(initVal.g,16);this.gBn=new BigInteger(initVal.g,16);this.k=this.k();this.one=new BigInteger("1",16);this.two=new BigInteger("2",16)};var bcrypt=dcodeIO.bcrypt;SRPClient.prototype={k:function(){var toHash=[this.N.toString(16),this.g.toString(16)];return this.paddedHash(toHash)},calculateX:function(saltHex){if(!saltHex)throw"Missing parameter.";if(!this.username||!this.password)throw"Username and password cannot be empty.";var usernamePassword=this.username+":"+this.password;var usernamePasswordHash=bcrypt.hashSync(usernamePassword,saltHex);var spad=saltHex.length%2!=0?"0":"";var X=this.hexHash(spad+saltHex+usernamePasswordHash);return new BigInteger(X,16)},calculateV:function(salt){if(!salt)throw"Missing parameter.";var x=this.calculateX(salt);return this.g.modPow(x,this.N)},calculateU:function(A,B){if(!A||!B)throw"Missing parameter(s).";if(A.mod(this.N).toString()=="0"||B.mod(this.N).toString()=="0")throw"ABORT: illegal_parameter";var toHash=[A.toString(16),B.toString(16)];return this.paddedHash(toHash)},calculateA:function(a){if(!a)throw"Missing parameter.";if(Math.ceil(a.bitLength()/8)<256/8)throw"Client key length is less than 256 bits.";var A=this.g.modPow(a,this.N);if(A.mod(this.N).toString()=="0")throw"ABORT: illegal_parameter";return A},calculateM:function(A,B_or_M,K){if(!A||!B_or_M||!K)throw"Missing parameter(s).";if(A.mod(this.N).toString()=="0"||B_or_M.mod(this.N).toString()=="0")throw"ABORT: illegal_parameter";var aHex=A.toString(16);var bHex=B_or_M.toString(16);var array=[aHex,bHex,K];return this.paddedHash(array)},calculateMozillaM1:function(A,B,S){if(!A||!B||!S)throw"Missing parameter(s).";if(A.mod(this.N).toString()=="0"||B.mod(this.N).toString()=="0")throw"ABORT: illegal_parameter";var aHex=A.toString(16);var bHex=B.toString(16);var sHex=S.toString(16);return this.paddedHash([aHex,bHex,sHex])},calculateMozillaM2:function(A,M,K){if(!A||!M||!K)throw"Missing parameter(s).";if(A.mod(this.N).toString()=="0")throw"ABORT: illegal_parameter";var aHex=A.toString(16);var mHex=M.toString(16);var kHex=K.toString(16);aHex=this.nZeros(512-aHex.length)+aHex;mHex=this.nZeros(64-mHex.length)+mHex;kHex=this.nZeros(64-kHex.length)+kHex;return this.hexHash(aHex+mHex+kHex)},calculateS:function(B,salt,uu,aa){if(!B||!salt||!uu||!aa)throw"Missing parameters.";if(B.mod(this.N).toString()=="0")throw"ABORT: illegal_parameter";var x=this.calculateX(salt);var bx=this.g.modPow(x,this.N);var btmp=B.add(this.N.multiply(this.k)).subtract(bx.multiply(this.k)).mod(this.N);return btmp.modPow(x.multiply(uu).add(aa),this.N)},calculateK:function(S){var sHex=S.toString(16);sHex=this.nZeros(512-sHex.length)+sHex;return this.hexHash(sHex)},srpRandom:function(){var words=sjcl.random.randomWords(8,0);var hex=sjcl.codec.hex.fromBits(words);if(hex.length!=64)throw"Invalid random number size.";var r=new BigInteger(hex,16);if(r.compareTo(this.N)>=0)r=a.mod(this.N.subtract(this.one));if(r.compareTo(this.two)<0)r=two;return r},randomHexSalt:function(){return bcrypt.genSaltSync()},paddedHash:function(array){var nlen=2*(this.N.toString(16).length*4+7>>3);var toHash="";for(var i=0;i<array.length;i++){toHash+=this.nZeros(nlen-array[i].length)+array[i]}var hash=new BigInteger(this.hexHash(toHash),16);return hash.mod(this.N)},hash:function(str){switch(this.hashFn.toLowerCase()){case"sha-256":var s=sjcl.codec.hex.fromBits(sjcl.hash.sha256.hash(str));return this.nZeros(64-s.length)+s;case"sha-1":default:return calcSHA1(str)}},hexHash:function(str){switch(this.hashFn.toLowerCase()){case"sha-256":var s=sjcl.codec.hex.fromBits(sjcl.hash.sha256.hash(sjcl.codec.hex.toBits(str)));return this.nZeros(64-s.length)+s;case"sha-1":default:return this.hash(this.pack(str))}},pack:function(hex){if(hex.length%2!=0)hex="0"+hex;i=0;ascii="";while(i<hex.length/2){ascii=ascii+String.fromCharCode(parseInt(hex.substr(i*2,2),16));i++}return ascii},nZeros:function(n){if(n<1)return"";var t=this.nZeros(n>>1);return(n&1)==0?t+t:t+t+"0"},initVals:{1024:{N:"EEAF0AB9ADB38DD69C33F80AFA8FC5E86072618775FF3C0B9EA2314C"+"9C256576D674DF7496EA81D3383B4813D692C6E0E0D5D8E250B98BE4"+"8E495C1D6089DAD15DC7D7B46154D6B6CE8EF4AD69B15D4982559B29"+"7BCF1885C529F566660E57EC68EDBC3C05726CC02FD4CBF4976EAA9A"+"FD5138FE8376435B9FC61D2FC0EB06E3",g:"2"},1536:{N:"9DEF3CAFB939277AB1F12A8617A47BBBDBA51DF499AC4C80BEEEA961"+"4B19CC4D5F4F5F556E27CBDE51C6A94BE4607A291558903BA0D0F843"+"80B655BB9A22E8DCDF028A7CEC67F0D08134B1C8B97989149B609E0B"+"E3BAB63D47548381DBC5B1FC764E3F4B53DD9DA1158BFD3E2B9C8CF5"+"6EDF019539349627DB2FD53D24B7C48665772E437D6C7F8CE442734A"+"F7CCB7AE837C264AE3A9BEB87F8A2FE9B8B5292E5A021FFF5E91479E"+"8CE7A28C2442C6F315180F93499A234DCF76E3FED135F9BB",g:"2"},2048:{N:"AC6BDB41324A9A9BF166DE5E1389582FAF72B6651987EE07FC319294"+"3DB56050A37329CBB4A099ED8193E0757767A13DD52312AB4B03310D"+"CD7F48A9DA04FD50E8083969EDB767B0CF6095179A163AB3661A05FB"+"D5FAAAE82918A9962F0B93B855F97993EC975EEAA80D740ADBF4FF74"+"7359D041D5C33EA71D281E446B14773BCA97B43A23FB801676BD207A"+"436C6481F1D2B9078717461A5B9D32E688F87748544523B524B0D57D"+"5EA77A2775D2ECFA032CFBDBF52FB3786160279004E57AE6AF874E73"+"03CE53299CCC041C7BC308D82A5698F3A8D0C38271AE35F8E9DBFBB6"+"94B5C803D89F7AE435DE236D525F54759B65E372FCD68EF20FA7111F"+"9E4AFF73",g:"2"},3072:{N:"FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E08"+"8A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B"+"302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9"+"A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE6"+"49286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8"+"FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D"+"670C354E4ABC9804F1746C08CA18217C32905E462E36CE3BE39E772C"+"180E86039B2783A2EC07A28FB5C55DF06F4C52C9DE2BCBF695581718"+"3995497CEA956AE515D2261898FA051015728E5A8AAAC42DAD33170D"+"04507A33A85521ABDF1CBA64ECFB850458DBEF0A8AEA71575D060C7D"+"B3970F85A6E1E4C7ABF5AE8CDB0933D71E8C94E04A25619DCEE3D226"+"1AD2EE6BF12FFA06D98A0864D87602733EC86A64521F2B18177B200C"+"BBE117577A615D6C770988C0BAD946E208E24FA074E5AB3143DB5BFC"+"E0FD108E4B82D120A93AD2CAFFFFFFFFFFFFFFFF",g:"5"},4096:{N:"FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E08"+"8A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B"+"302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9"+"A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE6"+"49286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8"+"FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D"+"670C354E4ABC9804F1746C08CA18217C32905E462E36CE3BE39E772C"+"180E86039B2783A2EC07A28FB5C55DF06F4C52C9DE2BCBF695581718"+"3995497CEA956AE515D2261898FA051015728E5A8AAAC42DAD33170D"+"04507A33A85521ABDF1CBA64ECFB850458DBEF0A8AEA71575D060C7D"+"B3970F85A6E1E4C7ABF5AE8CDB0933D71E8C94E04A25619DCEE3D226"+"1AD2EE6BF12FFA06D98A0864D87602733EC86A64521F2B18177B200C"+"BBE117577A615D6C770988C0BAD946E208E24FA074E5AB3143DB5BFC"+"E0FD108E4B82D120A92108011A723C12A787E6D788719A10BDBA5B26"+"99C327186AF4E23C1A946834B6150BDA2583E9CA2AD44CE8DBBBC2DB"+"04DE8EF92E8EFC141FBECAA6287C59474E6BC05D99B2964FA090C3A2"+"233BA186515BE7ED1F612970CEE2D7AFB81BDD762170481CD0069127"+"D5B05AA993B4EA988D8FDDC186FFB7DC90A6C08F4DF435C934063199"+"FFFFFFFFFFFFFFFF",g:"5"},6144:{N:"FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E08"+"8A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B"+"302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9"+"A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE6"+"49286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8"+"FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D"+"670C354E4ABC9804F1746C08CA18217C32905E462E36CE3BE39E772C"+"180E86039B2783A2EC07A28FB5C55DF06F4C52C9DE2BCBF695581718"+"3995497CEA956AE515D2261898FA051015728E5A8AAAC42DAD33170D"+"04507A33A85521ABDF1CBA64ECFB850458DBEF0A8AEA71575D060C7D"+"B3970F85A6E1E4C7ABF5AE8CDB0933D71E8C94E04A25619DCEE3D226"+"1AD2EE6BF12FFA06D98A0864D87602733EC86A64521F2B18177B200C"+"BBE117577A615D6C770988C0BAD946E208E24FA074E5AB3143DB5BFC"+"E0FD108E4B82D120A92108011A723C12A787E6D788719A10BDBA5B26"+"99C327186AF4E23C1A946834B6150BDA2583E9CA2AD44CE8DBBBC2DB"+"04DE8EF92E8EFC141FBECAA6287C59474E6BC05D99B2964FA090C3A2"+"233BA186515BE7ED1F612970CEE2D7AFB81BDD762170481CD0069127"+"D5B05AA993B4EA988D8FDDC186FFB7DC90A6C08F4DF435C934028492"+"36C3FAB4D27C7026C1D4DCB2602646DEC9751E763DBA37BDF8FF9406"+"AD9E530EE5DB382F413001AEB06A53ED9027D831179727B0865A8918"+"DA3EDBEBCF9B14ED44CE6CBACED4BB1BDB7F1447E6CC254B33205151"+"2BD7AF426FB8F401378CD2BF5983CA01C64B92ECF032EA15D1721D03"+"F482D7CE6E74FEF6D55E702F46980C82B5A84031900B1C9E59E7C97F"+"BEC7E8F323A97A7E36CC88BE0F1D45B7FF585AC54BD407B22B4154AA"+"CC8F6D7EBF48E1D814CC5ED20F8037E0A79715EEF29BE32806A1D58B"+"B7C5DA76F550AA3D8A1FBFF0EB19CCB1A313D55CDA56C9EC2EF29632"+"387FE8D76E3C0468043E8F663F4860EE12BF2D5B0B7474D6E694F91E"+"6DCC4024FFFFFFFFFFFFFFFF",g:"5"},8192:{N:"FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E08"+"8A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B"+"302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9"+"A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE6"+"49286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8"+"FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D"+"670C354E4ABC9804F1746C08CA18217C32905E462E36CE3BE39E772C"+"180E86039B2783A2EC07A28FB5C55DF06F4C52C9DE2BCBF695581718"+"3995497CEA956AE515D2261898FA051015728E5A8AAAC42DAD33170D"+"04507A33A85521ABDF1CBA64ECFB850458DBEF0A8AEA71575D060C7D"+"B3970F85A6E1E4C7ABF5AE8CDB0933D71E8C94E04A25619DCEE3D226"+"1AD2EE6BF12FFA06D98A0864D87602733EC86A64521F2B18177B200C"+"BBE117577A615D6C770988C0BAD946E208E24FA074E5AB3143DB5BFC"+"E0FD108E4B82D120A92108011A723C12A787E6D788719A10BDBA5B26"+"99C327186AF4E23C1A946834B6150BDA2583E9CA2AD44CE8DBBBC2DB"+"04DE8EF92E8EFC141FBECAA6287C59474E6BC05D99B2964FA090C3A2"+"233BA186515BE7ED1F612970CEE2D7AFB81BDD762170481CD0069127"+"D5B05AA993B4EA988D8FDDC186FFB7DC90A6C08F4DF435C934028492"+"36C3FAB4D27C7026C1D4DCB2602646DEC9751E763DBA37BDF8FF9406"+"AD9E530EE5DB382F413001AEB06A53ED9027D831179727B0865A8918"+"DA3EDBEBCF9B14ED44CE6CBACED4BB1BDB7F1447E6CC254B33205151"+"2BD7AF426FB8F401378CD2BF5983CA01C64B92ECF032EA15D1721D03"+"F482D7CE6E74FEF6D55E702F46980C82B5A84031900B1C9E59E7C97F"+"BEC7E8F323A97A7E36CC88BE0F1D45B7FF585AC54BD407B22B4154AA"+"CC8F6D7EBF48E1D814CC5ED20F8037E0A79715EEF29BE32806A1D58B"+"B7C5DA76F550AA3D8A1FBFF0EB19CCB1A313D55CDA56C9EC2EF29632"+"387FE8D76E3C0468043E8F663F4860EE12BF2D5B0B7474D6E694F91E"+"6DBE115974A3926F12FEE5E438777CB6A932DF8CD8BEC4D073B931BA"+"3BC832B68D9DD300741FA7BF8AFC47ED2576F6936BA424663AAB639C"+"5AE4F5683423B4742BF1C978238F16CBE39D652DE3FDB8BEFC848AD9"+"22222E04A4037C0713EB57A81A23F0C73473FC646CEA306B4BCBC886"+"2F8385DDFA9D4B7FA2C087E879683303ED5BDD3A062B3CF5B3A278A6"+"6D2A13F83F44F82DDF310EE074AB6A364597E899A0255DC164F31CC5"+"0846851DF9AB48195DED7EA1B1D510BD7EE74D73FAF36BC31ECFA268"+"359046F4EB879F924009438B481C6CD7889A002ED5EE382BC9190DA6"+"FC026E479558E4475677E9AA9E3050E2765694DFC81F56E880B96E71"+"60C980DD98EDD3DFFFFFFFFFFFFFFFFF",g:"19"}},calculateB:function(b,v){if(!b||!v)throw"Missing parameters.";var bb=this.g.modPow(b,this.N);var B=bb.add(v.multiply(this.k)).mod(this.N);return B},calculateServerS:function(A,v,u,B){if(!A||!v||!u||!B)throw"Missing parameters.";if(A.mod(this.N).toString()=="0"||B.mod(this.N).toString()=="0")throw"ABORT: illegal_parameter";return v.modPow(u,this.N).multiply(A).mod(this.N).modPow(B,this.N)}};return SRPClient}();